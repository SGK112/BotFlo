<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatFlow Pro - Advanced Visual Chatbot Builder</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="./css/shared.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f8fafc;
            min-height: 100vh;
            margin: 0;
        }

        .page-content {
            margin-top: 70px;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-secondary {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Main Builder Container */
        .builder-container {
            display: grid;
            grid-template-columns: 320px 1fr 380px;
            height: calc(100vh - 70px);
            gap: 1.5rem;
            padding: 1.5rem;
            max-width: 100%;
        }

        /* Data Sources Panel */
        .data-sources {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
        }

        .data-sources h3 {
            margin-bottom: 1rem;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.1rem;
        }

        .data-input-group {
            margin-bottom: 1.5rem;
        }

        .data-input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
            font-size: 0.9rem;
        }

        .data-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: border-color 0.2s;
        }

        .data-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .data-btn {
            width: 100%;
            padding: 0.75rem;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
            margin-top: 0.5rem;
        }

        .data-btn:hover {
            background: #5a67d8;
        }

        .data-preview {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            font-size: 0.85rem;
            max-height: 150px;
            overflow-y: auto;
        }

        /* Sidebar - Templates & Components */
        .sidebar {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            overflow-y: auto;
        }

        .sidebar h3 {
            margin-bottom: 1rem;
            color: #333;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .template-grid {
            display: grid;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }

        .template-card {
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .template-card:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .template-card.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .component-list {
            display: grid;
            gap: 0.5rem;
        }

        .component-item {
            padding: 0.75rem;
            background: #f8f9fa;
            border-radius: 6px;
            cursor: grab;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .component-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .component-item:active {
            cursor: grabbing;
        }

        /* Main Canvas */
        .canvas {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .canvas-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e5e7eb;
        }

        .flow-container {
            min-height: 400px;
            border: 2px dashed #e5e7eb;
            border-radius: 8px;
            position: relative;
            background: #fafafa;
        }

        .flow-container.drag-over {
            border-color: #667eea;
            background: #f8f9ff;
        }

        /* Properties Panel */
        .properties-panel {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            overflow-y: auto;
        }

        .property-group {
            margin-bottom: 2rem;
        }

        .property-group h4 {
            margin-bottom: 1rem;
            color: #333;
            font-size: 1.1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
        }

        /* Chatbot Preview */
        .chatbot-preview {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            z-index: 100;
            transition: all 0.3s ease;
        }

        .chatbot-preview.minimized {
            height: 60px;
            width: 300px;
        }

        .preview-header {
            background: #667eea;
            color: white;
            padding: 1rem;
            border-radius: 16px 16px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .preview-content {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
        }

        .chat-message {
            margin-bottom: 1rem;
            animation: slideIn 0.3s ease;
        }

        .message-bot {
            background: #f1f3f4;
            padding: 0.75rem;
            border-radius: 12px 12px 12px 4px;
            max-width: 80%;
        }

        .message-user {
            background: #667eea;
            color: white;
            padding: 0.75rem;
            border-radius: 12px 12px 4px 12px;
            max-width: 80%;
            margin-left: auto;
        }

        .chat-input {
            padding: 1rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 0.5rem;
        }

        .chat-input input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #e5e7eb;
            border-radius: 20px;
            outline: none;
        }

        .chat-input button {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
        }

        /* Visual Flow Nodes */
        .flow-node {
            position: absolute;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            min-width: 200px;
            max-width: 250px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: move;
        }

        .flow-node:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px -3px rgba(0, 0, 0, 0.15);
            border-color: #667eea;
        }

        .flow-node.selected {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .node-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            background: #f8fafc;
            border-bottom: 1px solid #e5e7eb;
            border-radius: 10px 10px 0 0;
        }

        .node-icon {
            font-size: 1.2rem;
            margin-right: 0.5rem;
        }

        .node-title {
            font-weight: 600;
            color: #374151;
            font-size: 0.9rem;
        }

        .node-delete {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 4px;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .node-content {
            padding: 1rem;
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .reply-option {
            background: #f3f4f6;
            padding: 0.5rem;
            margin: 0.25rem 0;
            border-radius: 6px;
            font-size: 0.8rem;
            border-left: 3px solid #667eea;
        }

        .node-connector {
            position: absolute;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            height: 12px;
            background: #667eea;
            border-radius: 50%;
            cursor: crosshair;
        }

        .flow-connections {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 1;
        }

        .canvas-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Welcome Node Specific */
        .welcome-node {
            border-color: #10b981;
        }

        .welcome-node .node-header {
            background: linear-gradient(135deg, #ecfdf5, #d1fae5);
        }

        /* Reply Node Specific */
        .reply-node {
            border-color: #f59e0b;
        }

        .reply-node .node-header {
            background: linear-gradient(135deg, #fffbeb, #fef3c7);
        }

        /* Success States */
        .success-message {
            background: #10b981;
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            text-align: center;
        }

        .premium-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .premium-modal {
            background: white;
            padding: 2rem;
            border-radius: 16px;
            text-align: center;
            max-width: 500px;
            margin: 1rem;
        }

        .premium-modal h2 {
            color: #667eea;
            margin-bottom: 1rem;
        }

        .price-tag {
            font-size: 2rem;
            font-weight: bold;
            color: #10b981;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="main-nav">
        <div class="nav-container">
            <a href="./" class="nav-logo">
                <i class="fas fa-robot"></i>
                ChatFlow
            </a>
            
            <ul class="nav-menu">
                <li class="nav-item"><a href="./easy-chatbot-builder.html">Easy Builder</a></li>
                <li class="nav-item"><a href="./chatbot-builder-pro.html" class="active">Pro Builder</a></li>
                <li class="nav-item"><a href="./demo.html">Demo</a></li>
                <li class="nav-item"><a href="./tutorial.html">Tutorial</a></li>
                <li class="nav-item"><a href="./pricing.html">Pricing</a></li>
                <li class="nav-item"><a href="./about.html">About</a></li>
            </ul>

            <div class="nav-cta">
                <button class="btn btn-secondary btn-sm" onclick="saveProject()">ÔøΩ Save</button>
                <button class="btn btn-primary btn-sm" onclick="exportChatbot()">üì§ Export</button>
            </div>

            <button class="mobile-menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <!-- Main Builder -->
    <div class="builder-container page-content">
        <!-- Data Sources Panel -->
        <div class="data-sources">
            <h3>ÔøΩ Data Sources</h3>
            
            <div class="data-input-group">
                <label for="website-url">Website URL</label>
                <input type="url" id="website-url" class="data-input" placeholder="https://yourwebsite.com" />
                <button class="data-btn" onclick="scrapeWebsite()">üìÑ Import Content</button>
            </div>

            <div class="data-input-group">
                <label for="csv-url">CSV Link</label>
                <input type="url" id="csv-url" class="data-input" placeholder="https://docs.google.com/spreadsheets/..." />
                <button class="data-btn" onclick="importCSV()">üìä Import CSV</button>
            </div>

            <div class="data-input-group">
                <label for="knowledge-base">Knowledge Base</label>
                <textarea id="knowledge-base" class="data-input" rows="4" placeholder="Paste your FAQ, product info, or knowledge base content here..."></textarea>
                <button class="data-btn" onclick="addKnowledge()">üß† Add Knowledge</button>
            </div>

            <div class="data-input-group">
                <label for="api-endpoint">API Endpoint</label>
                <input type="url" id="api-endpoint" class="data-input" placeholder="https://api.example.com/data" />
                <button class="data-btn" onclick="connectAPI()">üîå Connect API</button>
            </div>

            <div class="data-preview" id="data-preview">
                <strong>üìã Imported Data:</strong><br>
                No data imported yet. Add data sources above to train your chatbot.
            </div>

            <h3 style="margin-top: 2rem;">üìö Templates</h3>
            <div class="template-grid">
                <div class="template-card" onclick="loadTemplate('customer-service')">
                    <div>üéß Customer Service</div>
                    <small>FAQ + Support</small>
                </div>
                <div class="template-card" onclick="loadTemplate('lead-generation')">
                    <div>üéØ Lead Gen</div>
                    <small>Capture + Qualify</small>
                </div>
                <div class="template-card" onclick="loadTemplate('ecommerce')">
                    <div>ÔøΩ E-commerce</div>
                    <small>Shop + Buy</small>
                </div>
            </div>
        </div>
            <div class="component-list">
                <div class="component-item" draggable="true" data-type="welcome">
                    üëã Welcome Message
                </div>
                <div class="component-item" draggable="true" data-type="question">
                    ‚ùì Question
                </div>
                <div class="component-item" draggable="true" data-type="menu">
                    üìã Menu Options
                </div>
                <div class="component-item" draggable="true" data-type="form">
                    üìù Form Input
                </div>
                <div class="component-item" draggable="true" data-type="condition">
                    üîÄ Conditional Logic
                </div>
                <div class="component-item" draggable="true" data-type="api">
                    üîå API Integration
                </div>
                <div class="component-item" draggable="true" data-type="sheet">
                    üìä Google Sheets
                </div>
                <div class="component-item" draggable="true" data-type="excel">
                    üìà Excel Connection
                </div>
                <div class="component-item" draggable="true" data-type="pdf">
                    üìÑ PDF Reader
                </div>
                <div class="component-item" draggable="true" data-type="email">
                    üìß Send Email
                </div>
            </div>
        </div>

        <!-- Visual Flow Builder -->
        <div class="canvas">
            <div class="canvas-header">
                <h2>üé® Visual Flow Builder</h2>
                <div class="canvas-actions">
                    <button class="btn btn-secondary" onclick="clearCanvas()">üóëÔ∏è Clear</button>
                    <button class="btn btn-secondary" onclick="undoAction()">‚Ü∂ Undo</button>
                    <button class="btn btn-secondary" onclick="autoLayout()">üìê Auto Layout</button>
                </div>
            </div>
            <div class="flow-container" id="flowContainer">
                <!-- Welcome Node -->
                <div class="flow-node welcome-node" style="top: 50px; left: 50px;" data-id="welcome-1">
                    <div class="node-header">
                        <span class="node-icon">üëã</span>
                        <span class="node-title">Welcome Message</span>
                        <button class="node-delete" onclick="deleteNode('welcome-1')">√ó</button>
                    </div>
                    <div class="node-content">
                        <p>Hello! Welcome to our chatbot. How can I help you today?</p>
                    </div>
                    <div class="node-connector"></div>
                </div>
                
                <!-- Example Quick Reply Node -->
                <div class="flow-node reply-node" style="top: 200px; left: 50px;" data-id="reply-1">
                    <div class="node-header">
                        <span class="node-icon">‚ö°</span>
                        <span class="node-title">Quick Replies</span>
                        <button class="node-delete" onclick="deleteNode('reply-1')">√ó</button>
                    </div>
                    <div class="node-content">
                        <div class="reply-option">üí¨ Ask a Question</div>
                        <div class="reply-option">üìû Contact Support</div>
                        <div class="reply-option">üõí View Products</div>
                    </div>
                    <div class="node-connector"></div>
                </div>
                
                <!-- Connection Lines -->
                <svg class="flow-connections" width="100%" height="100%">
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#667eea" />
                        </marker>
                    </defs>
                    <line x1="150" y1="130" x2="150" y2="200" stroke="#667eea" stroke-width="2" marker-end="url(#arrowhead)"/>
                </svg>
            </div>
        </div>

        <!-- Properties Panel -->
        <div class="properties-panel">
            <h3>‚öôÔ∏è Properties</h3>
            <div id="propertiesContent">
                <div style="text-align: center; color: #999; margin-top: 2rem;">
                    <div style="font-size: 2rem; margin-bottom: 1rem;">üìù</div>
                    <p>Select a component to edit its properties</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Chatbot Preview -->
    <div class="chatbot-preview" id="chatbotPreview">
        <div class="preview-header" onclick="togglePreview()">
            <span>ü§ñ Live Preview</span>
            <span id="previewToggle">‚àí</span>
        </div>
        <div class="preview-content" id="previewContent">
            <div class="chat-message">
                <div class="message-bot">
                    üëã Hi! I'm your chatbot. Start building me by adding components to the canvas!
                </div>
            </div>
        </div>
        <div class="chat-input">
            <input type="text" placeholder="Type a message..." id="chatInput">
            <button onclick="sendMessage()">‚ñ∂</button>
        </div>
    </div>

    <script>
        // Global state
        let currentFlow = [];
        let selectedNode = null;
        let nodeCounter = 0;
        let draggedComponent = null;
        let connections = [];
        let importedData = [];

        // Data Integration Functions
        function scrapeWebsite() {
            const url = document.getElementById('website-url').value;
            if (!url) {
                alert('Please enter a website URL');
                return;
            }
            
            // Simulate website scraping
            const preview = document.getElementById('data-preview');
            preview.innerHTML = `
                <strong>üìÑ Website Content Imported:</strong><br>
                <em>Analyzing: ${url}</em><br>
                ‚Ä¢ Found 15 pages<br>
                ‚Ä¢ Extracted FAQ section<br>
                ‚Ä¢ Imported product descriptions<br>
                ‚Ä¢ Added contact information<br>
                <span style="color: #10b981;">‚úÖ Ready to use in chatbot</span>
            `;
            
            importedData.push({
                type: 'website',
                url: url,
                content: 'Website content and FAQ data'
            });
            
            addChatMessage(`üåê Website data imported from ${url}. Your chatbot can now answer questions about your website content!`, 'bot');
        }

        function importCSV() {
            const url = document.getElementById('csv-url').value;
            if (!url) {
                alert('Please enter a CSV URL');
                return;
            }
            
            // Simulate CSV import
            const preview = document.getElementById('data-preview');
            preview.innerHTML = `
                <strong>üìä CSV Data Imported:</strong><br>
                <em>Source: ${url}</em><br>
                ‚Ä¢ 150 rows processed<br>
                ‚Ä¢ Product catalog loaded<br>
                ‚Ä¢ Pricing data available<br>
                ‚Ä¢ Inventory status updated<br>
                <span style="color: #10b981;">‚úÖ Connected to live data</span>
            `;
            
            importedData.push({
                type: 'csv',
                url: url,
                content: 'Product catalog and pricing data'
            });
            
            addChatMessage(`üìä CSV data connected! Your chatbot can now provide real-time product information and pricing.`, 'bot');
        }

        function addKnowledge() {
            const knowledge = document.getElementById('knowledge-base').value;
            if (!knowledge.trim()) {
                alert('Please enter some knowledge base content');
                return;
            }
            
            const preview = document.getElementById('data-preview');
            preview.innerHTML = `
                <strong>üß† Knowledge Base Added:</strong><br>
                ‚Ä¢ ${knowledge.split('\n').length} entries processed<br>
                ‚Ä¢ FAQ patterns recognized<br>
                ‚Ä¢ Context understanding enabled<br>
                <span style="color: #10b981;">‚úÖ Knowledge integrated</span><br><br>
                <em>Sample: "${knowledge.substring(0, 100)}..."</em>
            `;
            
            importedData.push({
                type: 'knowledge',
                content: knowledge
            });
            
            addChatMessage(`üß† Knowledge base updated! Your chatbot is now smarter and can handle more specific questions.`, 'bot');
        }

        function connectAPI() {
            const endpoint = document.getElementById('api-endpoint').value;
            if (!endpoint) {
                alert('Please enter an API endpoint');
                return;
            }
            
            const preview = document.getElementById('data-preview');
            preview.innerHTML = `
                <strong>üîå API Connected:</strong><br>
                <em>Endpoint: ${endpoint}</em><br>
                ‚Ä¢ Connection established<br>
                ‚Ä¢ Real-time data access enabled<br>
                ‚Ä¢ Dynamic responses activated<br>
                <span style="color: #10b981;">‚úÖ Live API integration</span>
            `;
            
            importedData.push({
                type: 'api',
                endpoint: endpoint,
                content: 'Live API data connection'
            });
            
            addChatMessage(`üîå API connected! Your chatbot can now fetch live data and provide dynamic responses.`, 'bot');
        }

        // Initialize the builder
        document.addEventListener('DOMContentLoaded', function() {
            initializeDragAndDrop();
            showWelcomeMessage();
        });

        function showWelcomeMessage() {
            setTimeout(() => {
                addChatMessage("Welcome to ChatFlo Pro! üéâ Start by selecting a template or dragging components to build your chatbot.", 'bot');
            }, 1000);
        }

        function initializeDragAndDrop() {
            const components = document.querySelectorAll('.component-item');
            const flowContainer = document.getElementById('flowContainer');

            components.forEach(component => {
                component.addEventListener('dragstart', function(e) {
                    draggedComponent = this.dataset.type;
                    e.dataTransfer.effectAllowed = 'copy';
                });
            });

            flowContainer.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'copy';
                this.classList.add('drag-over');
            });

            flowContainer.addEventListener('dragleave', function(e) {
                if (!this.contains(e.relatedTarget)) {
                    this.classList.remove('drag-over');
                }
            });

            flowContainer.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                
                if (draggedComponent) {
                    const rect = this.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    createNode(draggedComponent, x, y);
                    draggedComponent = null;
                }
            });
        }

        function createNode(type, x, y) {
            nodeCounter++;
            const nodeId = `node_${nodeCounter}`;
            
            const node = document.createElement('div');
            node.className = 'flow-node';
            node.id = nodeId;
            node.style.left = x + 'px';
            node.style.top = y + 'px';
            
            const nodeConfig = getNodeConfig(type);
            node.innerHTML = `
                <div class="node-header">
                    <span class="node-type">${nodeConfig.icon} ${nodeConfig.name}</span>
                    <button class="node-delete" onclick="deleteNode('${nodeId}')">√ó</button>
                </div>
                <div class="node-content">
                    <strong>${nodeConfig.title}</strong>
                    <p>${nodeConfig.description}</p>
                </div>
                <div class="connection-point connection-input"></div>
                <div class="connection-point connection-output"></div>
            `;
            
            // Add click handler
            node.addEventListener('click', function(e) {
                e.stopPropagation();
                selectNode(nodeId, type);
            });
            
            // Add drag functionality
            makeDraggable(node);
            
            document.getElementById('flowContainer').appendChild(node);
            
            // Add to flow
            currentFlow.push({
                id: nodeId,
                type: type,
                x: x,
                y: y,
                config: nodeConfig
            });
            
            // Auto-select the new node
            selectNode(nodeId, type);
            
            // Show success message
            addChatMessage(`Great! You added a ${nodeConfig.name} component. Configure it in the properties panel.`, 'bot');
            
            // Clear the empty state
            clearEmptyState();
        }

        function getNodeConfig(type) {
            const configs = {
                welcome: {
                    icon: 'üëã',
                    name: 'Welcome',
                    title: 'Welcome Message',
                    description: 'Greet your users',
                    properties: {
                        message: 'Hello! Welcome to our chatbot.',
                        style: 'friendly'
                    }
                },
                question: {
                    icon: '‚ùì',
                    name: 'Question',
                    title: 'Ask Question',
                    description: 'Get user input',
                    properties: {
                        question: 'What can I help you with?',
                        inputType: 'text'
                    }
                },
                menu: {
                    icon: 'üìã',
                    name: 'Menu',
                    title: 'Menu Options',
                    description: 'Show multiple choices',
                    properties: {
                        title: 'Choose an option:',
                        options: ['Option 1', 'Option 2', 'Option 3']
                    }
                },
                form: {
                    icon: 'üìù',
                    name: 'Form',
                    title: 'Form Input',
                    description: 'Collect user data',
                    properties: {
                        fields: ['Name', 'Email', 'Message']
                    }
                },
                condition: {
                    icon: 'üîÄ',
                    name: 'Condition',
                    title: 'Conditional Logic',
                    description: 'Branch conversation',
                    properties: {
                        condition: 'if user says "yes"',
                        trueAction: 'Continue',
                        falseAction: 'Ask again'
                    }
                },
                api: {
                    icon: 'üîå',
                    name: 'API',
                    title: 'API Integration',
                    description: 'Connect external services',
                    properties: {
                        endpoint: 'https://api.example.com',
                        method: 'GET'
                    }
                },
                sheet: {
                    icon: 'üìä',
                    name: 'Google Sheets',
                    title: 'Google Sheets',
                    description: 'Read/write spreadsheet data',
                    properties: {
                        sheetId: '',
                        action: 'read'
                    }
                },
                excel: {
                    icon: 'üìà',
                    name: 'Excel',
                    title: 'Excel Connection',
                    description: 'Connect to Excel files',
                    properties: {
                        filePath: '',
                        worksheet: 'Sheet1'
                    }
                },
                pdf: {
                    icon: 'üìÑ',
                    name: 'PDF Reader',
                    title: 'PDF Reader',
                    description: 'Extract text from PDFs',
                    properties: {
                        pdfUrl: '',
                        searchQuery: ''
                    }
                },
                email: {
                    icon: 'üìß',
                    name: 'Email',
                    title: 'Send Email',
                    description: 'Send notifications',
                    properties: {
                        to: '',
                        subject: 'New message from chatbot',
                        template: 'default'
                    }
                }
            };
            
            return configs[type] || configs.welcome;
        }

        function selectNode(nodeId, type) {
            // Remove previous selection
            document.querySelectorAll('.flow-node').forEach(node => {
                node.classList.remove('selected');
            });
            
            // Select current node
            const node = document.getElementById(nodeId);
            if (node) {
                node.classList.add('selected');
                selectedNode = { id: nodeId, type: type };
                showProperties(nodeId, type);
            }
        }

        function showProperties(nodeId, type) {
            const config = getNodeConfig(type);
            const propertiesContent = document.getElementById('propertiesContent');
            
            let html = `
                <div class="property-group">
                    <h4>${config.icon} ${config.name} Properties</h4>
            `;
            
            // Generate form fields based on node type
            for (const [key, value] of Object.entries(config.properties)) {
                if (Array.isArray(value)) {
                    html += `
                        <div class="form-group">
                            <label>${key}:</label>
                            <textarea class="form-control" rows="3" onchange="updateNodeProperty('${nodeId}', '${key}', this.value)">${value.join('\\n')}</textarea>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="form-group">
                            <label>${key}:</label>
                            <input type="text" class="form-control" value="${value}" onchange="updateNodeProperty('${nodeId}', '${key}', this.value)">
                        </div>
                    `;
                }
            }
            
            html += `</div>`;
            
            // Add integration options for data sources
            if (['sheet', 'excel', 'pdf'].includes(type)) {
                html += `
                    <div class="property-group">
                        <h4>üîó Integration Setup</h4>
                        <div class="form-group">
                            <button class="btn btn-primary" style="width: 100%; margin-bottom: 0.5rem;" onclick="setupIntegration('${type}')">
                                Connect ${config.name}
                            </button>
                            <small style="color: #666;">
                                ${type === 'sheet' ? 'Connect to Google Sheets for real-time data' : 
                                  type === 'excel' ? 'Upload Excel files for data processing' : 
                                  'Upload PDFs for content extraction'}
                            </small>
                        </div>
                    </div>
                `;
            }
            
            propertiesContent.innerHTML = html;
        }

        function updateNodeProperty(nodeId, property, value) {
            // Update the flow data
            const nodeData = currentFlow.find(node => node.id === nodeId);
            if (nodeData) {
                if (property === 'options' || property === 'fields') {
                    nodeData.config.properties[property] = value.split('\\n').filter(item => item.trim());
                } else {
                    nodeData.config.properties[property] = value;
                }
                
                // Update preview
                updateChatbotPreview();
                
                addChatMessage(`Updated ${property} for your ${nodeData.type} component!`, 'bot');
            }
        }

        function updateChatbotPreview() {
            if (currentFlow.length > 0) {
                const welcomeNode = currentFlow.find(node => node.type === 'welcome');
                if (welcomeNode) {
                    addChatMessage(welcomeNode.config.properties.message, 'bot');
                }
            }
        }

        function loadTemplate(templateType) {
            clearCanvas();
            
            const templates = {
                'customer-service': [
                    { type: 'welcome', x: 100, y: 50 },
                    { type: 'menu', x: 100, y: 150 },
                    { type: 'question', x: 300, y: 100 },
                    { type: 'email', x: 500, y: 150 }
                ],
                'lead-generation': [
                    { type: 'welcome', x: 100, y: 50 },
                    { type: 'question', x: 100, y: 150 },
                    { type: 'form', x: 300, y: 100 },
                    { type: 'sheet', x: 500, y: 150 }
                ],
                'ecommerce': [
                    { type: 'welcome', x: 100, y: 50 },
                    { type: 'menu', x: 100, y: 150 },
                    { type: 'condition', x: 300, y: 100 },
                    { type: 'api', x: 500, y: 150 }
                ],
                'booking': [
                    { type: 'welcome', x: 100, y: 50 },
                    { type: 'question', x: 100, y: 150 },
                    { type: 'form', x: 300, y: 100 },
                    { type: 'excel', x: 500, y: 150 }
                ],
                'survey': [
                    { type: 'welcome', x: 100, y: 50 },
                    { type: 'question', x: 100, y: 150 },
                    { type: 'question', x: 300, y: 100 },
                    { type: 'sheet', x: 500, y: 150 }
                ]
            };
            
            const template = templates[templateType];
            if (template) {
                template.forEach(node => {
                    createNode(node.type, node.x, node.y);
                });
                
                addChatMessage(`üéâ Loaded ${templateType.replace('-', ' ')} template! Your chatbot is ready to customize.`, 'bot');
            }
        }

        function clearCanvas() {
            document.getElementById('flowContainer').innerHTML = `
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #999;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üéØ</div>
                    <h3>Start Building Your Chatbot</h3>
                    <p>Drag components from the left sidebar or choose a template</p>
                </div>
            `;
            currentFlow = [];
            selectedNode = null;
            document.getElementById('propertiesContent').innerHTML = `
                <div style="text-align: center; color: #999; margin-top: 2rem;">
                    <div style="font-size: 2rem; margin-bottom: 1rem;">üìù</div>
                    <p>Select a component to edit its properties</p>
                </div>
            `;
        }

        function clearEmptyState() {
            const flowContainer = document.getElementById('flowContainer');
            const emptyState = flowContainer.querySelector('div[style*="position: absolute"]');
            if (emptyState) {
                emptyState.remove();
            }
        }

        function deleteNode(nodeId) {
            const node = document.getElementById(nodeId);
            if (node) {
                node.remove();
                currentFlow = currentFlow.filter(n => n.id !== nodeId);
                
                if (selectedNode && selectedNode.id === nodeId) {
                    selectedNode = null;
                    document.getElementById('propertiesContent').innerHTML = `
                        <div style="text-align: center; color: #999; margin-top: 2rem;">
                            <div style="font-size: 2rem; margin-bottom: 1rem;">üìù</div>
                            <p>Select a component to edit its properties</p>
                        </div>
                    `;
                }
                
                if (currentFlow.length === 0) {
                    clearCanvas();
                }
            }
        }

        function makeDraggable(element) {
            let isDragging = false;
            let currentX;
            let currentY;
            let initialX;
            let initialY;
            let xOffset = 0;
            let yOffset = 0;

            element.addEventListener("mousedown", dragStart);
            document.addEventListener("mouseup", dragEnd);
            document.addEventListener("mousemove", drag);

            function dragStart(e) {
                if (e.target.classList.contains('node-delete')) return;
                
                initialX = e.clientX - xOffset;
                initialY = e.clientY - yOffset;

                if (e.target === element || element.contains(e.target)) {
                    isDragging = true;
                }
            }

            function dragEnd(e) {
                initialX = currentX;
                initialY = currentY;
                isDragging = false;
            }

            function drag(e) {
                if (isDragging) {
                    e.preventDefault();
                    currentX = e.clientX - initialX;
                    currentY = e.clientY - initialY;
                    xOffset = currentX;
                    yOffset = currentY;

                    element.style.transform = `translate3d(${currentX}px, ${currentY}px, 0)`;
                }
            }
        }

        function addChatMessage(message, type) {
            const previewContent = document.getElementById('previewContent');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message fade-in';
            
            const messageContent = document.createElement('div');
            messageContent.className = type === 'bot' ? 'message-bot' : 'message-user';
            messageContent.textContent = message;
            
            messageDiv.appendChild(messageContent);
            previewContent.appendChild(messageDiv);
            
            // Scroll to bottom
            previewContent.scrollTop = previewContent.scrollHeight;
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message) {
                addChatMessage(message, 'user');
                input.value = '';
                
                // Simulate bot response
                setTimeout(() => {
                    const responses = [
                        "I understand! Keep building your chatbot to make me smarter.",
                        "That's interesting! Add more components to expand my capabilities.",
                        "Great question! Your chatbot is getting better with each component you add.",
                        "I'm learning from your design choices. This chatbot will be amazing!"
                    ];
                    addChatMessage(responses[Math.floor(Math.random() * responses.length)], 'bot');
                }, 1000);
            }
        }

        function togglePreview() {
            const preview = document.getElementById('chatbotPreview');
            const toggle = document.getElementById('previewToggle');
            
            if (preview.classList.contains('minimized')) {
                preview.classList.remove('minimized');
                toggle.textContent = '‚àí';
            } else {
                preview.classList.add('minimized');
                toggle.textContent = '+';
            }
        }

        function setupIntegration(type) {
            const integrationInfo = {
                sheet: {
                    title: "Google Sheets Integration",
                    description: "Connect to Google Sheets for real-time data reading and writing. Perfect for collecting form submissions, managing inventories, or creating dynamic responses.",
                    features: ["Read/Write spreadsheet data", "Real-time sync", "Multiple sheets support", "Conditional formatting"]
                },
                excel: {
                    title: "Excel File Integration", 
                    description: "Upload and process Excel files for data-driven chatbot responses. Great for product catalogs, pricing sheets, and complex data analysis.",
                    features: ["Upload .xlsx files", "Multiple worksheets", "Formula support", "Data filtering"]
                },
                pdf: {
                    title: "PDF Document Reader",
                    description: "Extract and search content from PDF documents. Perfect for FAQ documents, manuals, and knowledge bases.",
                    features: ["Text extraction", "Content search", "Multiple PDF support", "Semantic search"]
                }
            };
            
            const info = integrationInfo[type];
            addChatMessage(`üîó Setting up ${info.title}! This integration will allow your chatbot to ${info.description}`, 'bot');
            
            setTimeout(() => {
                addChatMessage(`‚úÖ ${info.title} is now ready! You can configure the connection details in the properties panel.`, 'bot');
            }, 2000);
        }

        function saveProject() {
            const projectData = {
                flow: currentFlow,
                connections: connections,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('chatflo_project', JSON.stringify(projectData));
            addChatMessage("üíæ Project saved successfully! You can continue working on it anytime.", 'bot');
            
            // Show success message
            const successDiv = document.createElement('div');
            successDiv.className = 'success-message';
            successDiv.textContent = '‚úÖ Project Saved Successfully!';
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                successDiv.remove();
            }, 3000);
        }

        function previewChatbot() {
            if (currentFlow.length === 0) {
                addChatMessage("‚ö†Ô∏è Add some components to your chatbot before previewing!", 'bot');
                return;
            }
            
            addChatMessage("üëÅÔ∏è Preview mode activated! This is how your chatbot will behave with users.", 'bot');
            
            // Simulate a full conversation flow
            setTimeout(() => {
                const welcomeNode = currentFlow.find(node => node.type === 'welcome');
                if (welcomeNode) {
                    addChatMessage(welcomeNode.config.properties.message, 'bot');
                }
            }, 1000);
        }

        function exportChatbot() {
            if (currentFlow.length === 0) {
                addChatMessage("‚ö†Ô∏è Build your chatbot first before exporting!", 'bot');
                return;
            }
            
            // Show premium modal for code export
            showPremiumModal();
        }

        function showPremiumModal() {
            const overlay = document.createElement('div');
            overlay.className = 'premium-overlay';
            overlay.innerHTML = `
                <div class="premium-modal">
                    <h2>üöÄ Export Your Chatbot</h2>
                    <p>Great work! Your chatbot is ready to go live. Get the complete production-ready code to deploy anywhere.</p>
                    
                    <div class="price-tag">$9.99</div>
                    
                    <div style="text-align: left; margin: 1.5rem 0;">
                        <h4>‚ú® What you get:</h4>
                        <ul style="margin-left: 1rem;">
                            <li>üì± Mobile-responsive HTML/CSS/JS code</li>
                            <li>üîß Complete integration setup files</li>
                            <li>üìä Google Sheets & Excel connectors</li>
                            <li>üìÑ PDF processing scripts</li>
                            <li>üöÄ Deployment instructions</li>
                            <li>üíé Commercial license</li>
                            <li>üõü 30-day support</li>
                        </ul>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; justify-content: center;">
                        <button class="btn btn-primary" onclick="purchaseCode()">üí≥ Purchase Code</button>
                        <button class="btn btn-secondary" onclick="closePremiumModal()">Cancel</button>
                    </div>
                    
                    <small style="color: #666; margin-top: 1rem; display: block;">
                        Building is always free ‚Ä¢ Pay only when you're ready to deploy
                    </small>
                </div>
            `;
            
            document.body.appendChild(overlay);
        }

        function closePremiumModal() {
            const overlay = document.querySelector('.premium-overlay');
            if (overlay) {
                overlay.remove();
            }
        }

        function purchaseCode() {
            // Simulate purchase process
            closePremiumModal();
            addChatMessage("üéâ Thank you for your purchase! Your chatbot code will be generated and sent to your email within 5 minutes.", 'bot');
            
            setTimeout(() => {
                addChatMessage("üìß Code generation complete! Check your email for the download link and deployment instructions.", 'bot');
            }, 3000);
        }

        function undoAction() {
            if (currentFlow.length > 0) {
                const lastNode = currentFlow[currentFlow.length - 1];
                deleteNode(lastNode.id);
                addChatMessage("‚Ü∂ Undid last action", 'bot');
            }
        }

        // Handle enter key in chat input
        document.getElementById('chatInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Auto-save functionality
        setInterval(() => {
            if (currentFlow.length > 0) {
                saveProject();
            }
        }, 30000); // Auto-save every 30 seconds
    </script>
</body>
</html>
