<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Quickly estimate countertop projects with Surprise Granite's interactive calculator.">
    <meta name="keywords" content="countertops, granite, quartz, quote, estimation, Surprise Granite">
    <meta name="author" content="Surprise Granite">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="Surprise Granite Countertop Estimator">
    <meta property="og:description" content="Quickly estimate countertop projects with Surprise Granite's interactive calculator.">
    <meta property="og:image" content="https://cdn.prod.website-files.com/6456ce4476abb25581fbad0c/64a70d4b30e87feb388f004f_surprise-granite-profile-logo.svg">
    <meta property="og:url" content="https://surprise-granite-connections-dev.onrender.com">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="theme-color" content="#1e2749">
    <title>Surprise Granite Countertop Estimator</title>
    <link rel="canonical" href="https://surprise-granite-connections-dev.onrender.com">
    <link rel="icon" href="https://cdn.prod.website-files.com/6456ce4476abb25581fbad0c/64a70d4b30e87feb388f004f_surprise-granite-profile-logo.svg" type="image/svg+xml">
    <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0/dist/fuse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.22.5/babel.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #f5f5f5;
            --bg-secondary: #ffffff;
            --bg-table-header: #f3f4f6;
            --text-primary: #1f2937;
            --text-secondary: #4b5563;
            --text-header: #374151;
            --border-color: #e5e7eb;
            --accent-color: #2563eb;
            --error-color: #b91c1c;
            --success-color: #10b981;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --gold-icon: #feda00;
            --brand-dark: #1e2749;
            --highlight-color: rgba(37, 99, 235, 0.1);
            --text-white: #ffffff;
        }
        [data-theme="dark"] {
            --bg-primary: #1e2749;
            --bg-secondary: #2d3748;
            --bg-table-header: #4b5563;
            --text-primary: #d1d5db;
            --text-secondary: #9ca3af;
            --text-header: #d1d5db;
            --border-color: #4b5563;
            --accent-color: #3b82f6;
            --error-color: #ef4444;
            --success-color: #34d399;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --gold-icon: #feda00;
            --brand-dark: #f5f5f5;
            --highlight-color: rgba(59, 130, 246, 0.1);
            --text-white: #ffffff;
        }
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow-x: hidden;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-family: 'Inter', system-ui, sans-serif;
            box-sizing: border-box;
            font-size: 14px;
        }
        *, *:before, *:after {
            box-sizing: inherit;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltip-text {
            visibility: hidden;
            width: 8rem;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            text-align: center;
            border-radius: 0.375rem;
            padding: 0.25rem;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            border: 1px solid var(--border-color);
            font-size: 0.75rem;
        }
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 0.375rem;
            max-height: 120px;
            overflow-y: auto;
            z-index: 10;
            transition: all 0.3s ease;
        }
        .autocomplete-item {
            padding: 0.5rem 0.75rem;
            cursor: pointer;
            color: var(--text-primary);
            font-size: 0.875rem;
        }
        .autocomplete-item:hover, .autocomplete-item.selected {
            background-color: var(--highlight-color);
        }
        input, select, button {
            transition: all 0.2s ease;
            min-height: 48px;
            font-size: 0.875rem;
        }
        input:focus, select:focus, button:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px var(--highlight-color);
            outline: none;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        .modal-content {
            background: var(--bg-secondary);
            padding: 0.75rem;
            border-radius: 0.5rem;
            width: 100vw;
            height: 100vh;
            overflow-y: auto;
        }
        .card {
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px var(--shadow-color);
        }
        .filter-bar {
            position: sticky;
            top: 0;
            z-index: 20;
            background: var(--bg-secondary);
            padding: 0.5rem 0;
        }
        @media (min-width: 576px) {
            .modal-content {
                width: 90vw;
                max-width: 500px;
                height: auto;
                max-height: 80vh;
                padding: 1rem;
            }
            html, body {
                font-size: 16px;
            }
            input, select, button {
                font-size: 1rem;
                padding: 0.75rem;
            }
        }
        @media (max-width: 576px) {
            html, body {
                font-size: 12px;
            }
            input, select, button {
                padding: 0.5rem;
            }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        .availability-in-stock { color: var(--success-color); }
        .availability-low-stock { color: #d97706; }
        .availability-out-of-stock { color: var(--error-color); }
    </style>
</head>
<body>
    <div id="root"></div>
    <div id="error" class="error-message hidden text-center text-red-500 p-2"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback, useRef } = React;

        const vendorCsvMap = {
            'All Vendors': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRWyYuTQxC8_fKNBg9_aJiB7NMFztw6mgdhN35lo8sRL45MvncRg4D217lopZxuw39j5aJTN6TP4Elh/pub?output=csv',
            'MSI': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRWyYuTQxC8_fKNBg9_aJiB7NMFztw6mgdhN35lo8sRL45MvncRg4D217lopZxuw39j5aJTN6TP4Elh/pub?output=csv',
            'Vendor2': 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRWyYuTQxC8_fKNBg9_aJiB7NMFztw6mgdhN35lo8sRL45MvncRg4D217lopZxuw39j5aJTN6TP4Elh/pub?output=csv'
        };

        const fallbackCsvData = [
            { "Color Name": "Arctic White", "Material": "Granite", "Vendor Name": "MSI", "Thickness": "2cm", "Cost/SqFt": "30", "Total/SqFt": "100", "Image URL": "https://example.com/images/arctic_white.jpg", "Availability": "In Stock" },
            { "Color Name": "Blue Pearl", "Material": "Quartz", "Vendor Name": "Vendor2", "Thickness": "3cm", "Cost/SqFt": "40", "Total/SqFt": "80", "Image URL": "https://example.com/images/blue_pearl.jpg", "Availability": "Low Stock" },
            { "Color Name": "Calacatta Gold", "Material": "Quartzite", "Vendor Name": "MSI", "Thickness": "2cm", "Cost/SqFt": "50", "Total/SqFt": "120", "Image URL": "https://example.com/images/calacatta_gold.jpg", "Availability": "Out of Stock" }
        ];

        function App() {
            const [priceData, setPriceData] = useState([]);
            const [searchQuery, setSearchQuery] = useState('');
            const [searchResults, setSearchResults] = useState([]);
            const [isLoading, setIsLoading] = useState(false);
            const [isSearchLoading, setIsSearchLoading] = useState(false);
            const [zipCode, setZipCode] = useState('');
            const [regionMultiplier, setRegionMultiplier] = useState(1.0);
            const [regionName, setRegionName] = useState('National Average');
            const [filters, setFilters] = useState({
                vendor: 'All Vendors',
                material: 'All Materials',
                thickness: 'All Thicknesses'
            });
            const [sortBy, setSortBy] = useState('popularity');
            const [toast, setToast] = useState({ message: '', show: false, isError: false });
            const [suggestions, setSuggestions] = useState([]);
            const [cart, setCart] = useState([]);
            const [theme, setTheme] = useState(localStorage.getItem('theme') || 'light');
            const [usingFallbackData, setUsingFallbackData] = useState(false);
            const [headerHeight, setHeaderHeight] = useState(0);
            const [showCart, setShowCart] = useState(false);
            const [suggestionIndex, setSuggestionIndex] = useState(-1);
            const searchInputRef = useRef(null);
            const cartRef = useRef(null);

            const slabArea = (127 * 64) / 144; // 127" x 64" slab in square feet

            const calculateSlabsNeeded = (sqFt) => {
                if (!sqFt || isNaN(sqFt)) return 0;
                const wasteFactor = sqFt < 25 ? 1.30 : sqFt <= 50 ? 1.20 : 1.15;
                const totalAreaWithWaste = sqFt * wasteFactor;
                return Math.ceil(totalAreaWithWaste / slabArea);
            };

            const calculateRawCostPerSqFt = (item) => {
                return item.installedPricePerSqFt * regionMultiplier;
            };

            const calculateInstalledCostPerSqFt = (item) => {
                const baseCost = item.installedPricePerSqFt || 0;
                const fixedCost = (material => {
                    const m = (material || '').toLowerCase();
                    if (m.includes('granite') || m.includes('quartz')) return 26;
                    if (m.includes('quartzite') || m.includes('marble')) return 35;
                    if (m.includes('dekton') || m.includes('porcelain')) return 55;
                    return 26;
                })(item.material);
                return (baseCost * 3.25 + fixedCost) * regionMultiplier;
            };

            const calculateCartTotal = useCallback(() => {
                return cart.reduce((total, item) => total + parseFloat(item.totalCost), 0).toFixed(2);
            }, [cart]);

            const calculateCartSlabs = useCallback(() => {
                return cart.reduce((total, item) => total + item.slabsNeeded, 0);
            }, [cart]);

            const generateCustomerWriteup = useCallback(() => {
                if (cart.length === 0) {
                    return '';
                }
                const itemsDescription = cart.map(item => 
                    `${item.colorName} (${item.material}, ${item.thickness}) from ${item.vendorName} for ${item.sqFt} sq ft, ${item.availability}, at $${item.costPerSqFt.toFixed(2)}/sq ft installed`
                ).join('; ');
                return `Dear Contractor,\n\nThank you for using Surprise Granite's Estimator for your countertop project. Below is the proposed estimate based on your selections:\n\n${itemsDescription}.\n\nTotal Estimated Cost: $${calculateCartTotal()}\nTotal Slabs Required: ${calculateCartSlabs()}\n\nThese estimates include professional installation and are based on your region (${regionName}). Please verify availability, as some items may require lead time. Contact us to finalize details or adjust the project scope.\n\nBest regards,\nSurprise Granite Team`;
            }, [cart, regionName, calculateCartTotal, calculateCartSlabs]);

            useEffect(() => {
                document.documentElement.setAttribute('data-theme', theme);
                localStorage.setItem('theme', theme);
            }, [theme]);

            useEffect(() => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const mockZip = '85001';
                            setZipCode(mockZip);
                            const region = mockZip.startsWith('85') ? { name: 'Southwest', multiplier: 1.0 } :
                                           mockZip.startsWith('1') ? { name: 'Northeast', multiplier: 1.25 } :
                                           mockZip.startsWith('9') ? { name: 'West Coast', multiplier: 1.2 } :
                                           mockZip.startsWith('6') ? { name: 'Midwest', multiplier: 1.1 } :
                                           { name: 'Southeast', multiplier: 1.05 };
                            setRegionName(region.name);
                            setRegionMultiplier(region.multiplier);
                            fetchPriceList();
                        },
                        (error) => {
                            setRegionName('National Average');
                            setRegionMultiplier(1.0);
                            fetchPriceList();
                        }
                    );
                } else {
                    setRegionName('National Average');
                    setRegionMultiplier(1.0);
                    fetchPriceList();
                }
            }, []);

            useEffect(() => {
                const updateHeaderHeight = () => {
                    const header = document.querySelector('header');
                    if (header) {
                        setHeaderHeight(header.offsetHeight);
                    }
                };

                updateHeaderHeight();
                window.addEventListener('resize', updateHeaderHeight);
                return () => window.removeEventListener('resize', updateHeaderHeight);
            }, []);

            const showToast = (message, isError = false) => {
                setToast({ message, show: true, isError });
                setTimeout(() => setToast({ message: '', show: false, isError: false }), 3000);
                if ('vibrate' in navigator) {
                    navigator.vibrate(50);
                }
            };

            const toggleTheme = () => {
                setTheme(theme === 'light' ? 'dark' : 'light');
            };

            const fetchPriceList = async (retries = 3, delay = 1000) => {
                setIsLoading(true);
                setUsingFallbackData(false);

                const csvUrl = vendorCsvMap[filters.vendor] || vendorCsvMap['All Vendors'];
                try {
                    const response = await fetch(csvUrl, { cache: 'no-store' });
                    if (!response.ok) {
                        throw new Error(`HTTP error: ${response.status}`);
                    }
                    const contentType = response.headers.get('content-type');
                    if (!contentType || !contentType.includes('text/csv')) {
                        throw new Error('Unexpected content type: ' + contentType);
                    }
                    const csvText = await response.text();

                    Papa.parse(csvText, {
                        header: true,
                        skipEmptyLines: true,
                        complete: async function(results) {
                            const rawData = results.data;
                            const processedData = processData(rawData);
                            if (processedData.length === 0) {
                                showToast('No valid countertop data available in CSV.', true);
                                setPriceData([]);
                                setIsLoading(false);
                                return;
                            }
                            setPriceData(processedData);
                            setIsLoading(false);
                        },
                        error: function(error) {
                            showToast('Failed to parse countertop data from CSV.', true);
                            setPriceData([]);
                            setIsLoading(false);
                        }
                    });
                } catch (err) {
                    if (retries > 0) {
                        setTimeout(() => fetchPriceList(retries - 1, delay * 2), delay);
                    } else {
                        showToast('Failed to load countertop data from CSV. Using fallback data.', true);
                        setUsingFallbackData(true);
                        setPriceData(fallbackCsvData.map((item, index) => processData([item])[0]));
                        setIsLoading(false);
                    }
                }
            };

            const processData = (rawData) => {
                if (!Array.isArray(rawData)) {
                    return [];
                }
                return rawData.map((item, index) => {
                    if (!item || typeof item !== 'object') {
                        return null;
                    }
                    const costKeys = ['Cost/SqFt', 'Cost per Sq Ft', 'Cost', 'Price/SqFt'];
                    const totalKeys = ['Total/SqFt', 'Total Sq Ft', 'Available SqFt'];
                    const colorKeys = ['Color Name', 'Color', 'Name'];
                    const vendorKeys = ['Vendor Name', 'Vendor', 'Supplier'];
                    const materialKeys = ['Material', 'Type'];
                    const thicknessKeys = ['Thickness', 'Size'];
                    const imageKeys = ['Image URL', 'Image', 'Photo URL'];
                    const popularityKeys = ['Popularity', 'Rank'];
                    const isNewKeys = ['Is New', 'New'];
                    const availabilityKeys = ['Availability', 'Stock'];

                    const getValue = (keys) => {
                        for (let key of keys) {
                            if (item[key] !== undefined && item[key] !== '') {
                                return item[key];
                            }
                        }
                        return null;
                    };

                    const costSqFt = parseFloat(getValue(costKeys));
                    if (isNaN(costSqFt)) {
                        return null;
                    }
                    const thickness = getValue(thicknessKeys) ? String(getValue(thicknessKeys)) : 'Unknown';
                    const availability = getValue(availabilityKeys) || 'Unknown';
                    return {
                        id: `${getValue(colorKeys) || 'Unknown'}-${getValue(vendorKeys) || 'Unknown'}-${thickness}-${index}`,
                        colorName: getValue(colorKeys) || 'Unknown',
                        vendorName: getValue(vendorKeys) || 'Unknown',
                        thickness: thickness,
                        material: getValue(materialKeys) || 'Unknown',
                        installedPricePerSqFt: costSqFt,
                        availableSqFt: parseFloat(getValue(totalKeys)) || 0,
                        imageUrl: getValue(imageKeys) || 'https://cdn.prod.website-files.com/6456ce4476abb25581fbad0c/64a70d4b30e87feb388f004f_surprise-granite-profile-logo.svg',
                        popularity: parseFloat(getValue(popularityKeys)) || Math.random(),
                        isNew: getValue(isNewKeys) === 'true' || Math.random() > 0.8,
                        availability: availability
                    };
                }).filter(item => item !== null);
            };

            useEffect(() => {
                if (searchQuery && priceData.length > 0) {
                    setIsSearchLoading(true);
                    const sanitizedQuery = searchQuery.trim().toLowerCase();
                    const filteredData = priceData.filter(item => 
                        filters.vendor === 'All Vendors' || item.vendorName === filters.vendor
                    );
                    const fuse = new Fuse(filteredData, {
                        keys: [
                            { name: 'colorName', weight: 0.4 },
                            { name: 'material', weight: 0.3 },
                            { name: 'vendorName', weight: 0.2 },
                            { name: 'thickness', weight: 0.1 }
                        ],
                        threshold: 0.2,
                        includeScore: true,
                        minMatchCharLength: 1,
                        tokenize: true,
                        matchAllTokens: true
                    });
                    const results = fuse.search(sanitizedQuery).map(result => result.item);
                    setSearchResults(results);
                    setSuggestions(results.slice(0, 5).map(item => ({
                        label: `${item.colorName} (${item.material}, ${item.vendorName})`,
                        item
                    })));
                    setTimeout(() => setIsSearchLoading(false), 100);
                } else {
                    setSearchResults([]);
                    setSuggestions([]);
                    setIsSearchLoading(false);
                }
            }, [searchQuery, priceData, filters.vendor]);

            useEffect(() => {
                fetchPriceList();
            }, [filters.vendor]);

            const clearSearch = () => {
                setSearchQuery('');
                setSearchResults([]);
                setSuggestions([]);
                setSuggestionIndex(-1);
            };

            const handleSuggestionClick = (suggestion) => {
                setSearchQuery(suggestion.label);
                setSuggestions([]);
                setSuggestionIndex(-1);
                searchInputRef.current.focus();
            };

            const handleSearchKeyDown = (e) => {
                if (suggestions.length === 0) return;
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    setSuggestionIndex(prev => Math.min(prev + 1, suggestions.length - 1));
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    setSuggestionIndex(prev => Math.max(prev - 1, -1));
                } else if (e.key === 'Enter' && suggestionIndex >= 0) {
                    e.preventDefault();
                    handleSuggestionClick(suggestions[suggestionIndex]);
                }
            };

            const addToCart = (item, sqFt = 10) => {
                if (cart.length >= 6) {
                    showToast('Cannot add more than 6 countertops to compare.', true);
                    return;
                }
                const parsedSqFt = parseFloat(sqFt);
                if (!parsedSqFt || parsedSqFt <= 0) {
                    showToast('Please enter a valid square footage.', true);
                    return;
                }
                const newItem = {
                    ...item,
                    sqFt: parsedSqFt,
                    slabsNeeded: calculateSlabsNeeded(parsedSqFt),
                    rawCostPerSqFt: calculateRawCostPerSqFt(item),
                    costPerSqFt: calculateInstalledCostPerSqFt(item),
                    rawTotalCost: (calculateRawCostPerSqFt(item) * parsedSqFt * calculateSlabsNeeded(parsedSqFt)).toFixed(2),
                    totalCost: (calculateInstalledCostPerSqFt(item) * parsedSqFt * calculateSlabsNeeded(parsedSqFt)).toFixed(2)
                };
                setCart(prev => [...prev, newItem]);
                setShowCart(true);
                showToast('Countertop added to cart.');
                setTimeout(() => {
                    if (cartRef.current) {
                        cartRef.current.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }, 100);
            };

            const updateCartItem = (id, sqFt) => {
                const parsedSqFt = parseFloat(sqFt);
                if (!parsedSqFt || parsedSqFt <= 0) {
                    showToast('Please enter a valid square footage.', true);
                    return;
                }
                setCart(prev => prev.map(item => {
                    if (item.id === id) {
                        return {
                            ...item,
                            sqFt: parsedSqFt,
                            slabsNeeded: calculateSlabsNeeded(parsedSqFt),
                            rawTotalCost: (item.rawCostPerSqFt * parsedSqFt * calculateSlabsNeeded(parsedSqFt)).toFixed(2),
                            totalCost: (item.costPerSqFt * parsedSqFt * calculateSlabsNeeded(parsedSqFt)).toFixed(2)
                        };
                    }
                    return item;
                }));
                showToast('Item updated.');
            };

            const removeFromCart = (id) => {
                setCart(prev => prev.filter(item => item.id !== id));
                showToast('Countertop removed from cart.');
                if (cart.length === 1) setShowCart(false);
            };

            const clearCart = () => {
                setCart([]);
                setShowCart(false);
                showToast('Cart cleared.');
            };

            const vendors = useMemo(() => {
                return ['All Vendors', ...new Set(priceData.map(item => item.vendorName))].sort();
            }, [priceData]);

            const availableMaterials = useMemo(() => {
                if (!filters.vendor || filters.vendor === 'All Vendors') return ['All Materials', ...new Set(priceData.map(item => item.material))].sort();
                return ['All Materials', ...new Set(priceData
                    .filter(item => item.vendorName === filters.vendor)
                    .map(item => item.material))].sort();
            }, [priceData, filters.vendor]);

            const availableThicknesses = useMemo(() => {
                if (!filters.vendor || !filters.material || filters.vendor === 'All Vendors' || filters.material === 'All Materials') {
                    return ['All Thicknesses', ...new Set(priceData.map(item => item.thickness))].sort();
                }
                return ['All Thicknesses', ...new Set(priceData
                    .filter(item => item.vendorName === filters.vendor && item.material === filters.material)
                    .map(item => item.thickness))].sort();
            }, [priceData, filters.vendor, filters.material]);

            const filteredResults = useMemo(() => {
                let results = searchQuery ? searchResults : priceData;
                results = results
                    .filter(item => {
                        const matchesVendor = filters.vendor === 'All Vendors' || item.vendorName === filters.vendor;
                        const matchesMaterial = filters.material === 'All Materials' || item.material === filters.material;
                        const matchesThickness = filters.thickness === 'All Thicknesses' || item.thickness === filters.thickness;
                        return matchesVendor && matchesMaterial && matchesThickness;
                    })
                    .map(item => ({
                        ...item,
                        rawCostPerSqFt: calculateRawCostPerSqFt(item),
                        costPerSqFt: calculateInstalledCostPerSqFt(item)
                    }));
                if (sortBy === 'cost-asc') {
                    return results.sort((a, b) => a.costPerSqFt - b.costPerSqFt);
                } else if (sortBy === 'cost-desc') {
                    return results.sort((a, b) => b.costPerSqFt - a.costPerSqFt);
                }
                return results.sort((a, b) => b.popularity - a.popularity);
            }, [searchQuery, searchResults, filters, priceData, sortBy]);

            const debouncedSetSearchQuery = useCallback((value) => {
                setTimeout(() => setSearchQuery(value), 150);
            }, []);

            const submitQuote = async () => {
                if (cart.length === 0) {
                    showToast('Please add at least one countertop to the cart.', true);
                    return;
                }

                const formData = new FormData();
                formData.append('region', regionName);
                formData.append('zip_code', zipCode);
                formData.append('customer_writeup', generateCustomerWriteup());
                formData.append('selected_items', cart.map(item => 
                    `Color: ${item.colorName}, Material: ${item.material}, Vendor: ${item.vendorName}, Thickness: ${item.thickness}, Sq Ft: ${item.sqFt}, Slabs Needed: ${item.slabsNeeded}, Availability: ${item.availability}, Raw Cost/Sq Ft: $${item.rawCostPerSqFt.toFixed(2)}, Installed Cost/Sq Ft: $${item.costPerSqFt.toFixed(2)}, Raw Total Cost: $${item.rawTotalCost}, Installed Total Cost: $${item.totalCost}`
                ).join('\n'));

                try {
                    const response = await fetch('https://usebasin.com/f/0e1679dd8d79', {
                        method: 'POST',
                        body: formData,
                        headers: { 'Accept': 'application/json' }
                    });
                    if (response.status !== 200 && response.status !== 202) {
                        throw new Error(`Submission failed: ${response.status}`);
                    }
                    showToast('Quote submitted successfully');
                    setCart([]);
                    setShowCart(false);
                } catch (err) {
                    showToast('Failed to submit quote. Please try again.', true);
                }
            };

            const exportToPDF = async () => {
                if (cart.length === 0) {
                    showToast('Please add at least one countertop to the cart.', true);
                    return;
                }

                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                // Add logo
                const logoUrl = 'https://cdn.prod.website-files.com/6456ce4476abb25581fbad0c/64a70d4b30e87feb388f004f_surprise-granite-profile-logo.svg';
                const img = new Image();
                img.crossOrigin = 'Anonymous';
                img.src = logoUrl;

                await new Promise(resolve => {
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0);
                        const imgData = canvas.toDataURL('image/png');
                        doc.addImage(imgData, 'PNG', 20, 10, 40, 20);
                        resolve();
                    };
                    img.onerror = () => {
                        doc.text('Surprise Granite', 20, 20);
                        resolve();
                    };
                });

                doc.setFontSize(16);
                doc.text('Countertop Project Estimate', 20, 40);
                doc.setFontSize(12);
                doc.text(`Date: ${new Date().toLocaleDateString()}`, 20, 50);
                doc.text(`Region: ${regionName}`, 20, 60);
                doc.text(`Total Estimated Cost: $${calculateCartTotal()}`, 20, 70);
                doc.text(`Total Slabs Required: ${calculateCartSlabs()}`, 20, 80);

                doc.setFontSize(14);
                doc.text('Selected Countertops:', 20, 100);

                const tableData = cart.map(item => [
                    item.colorName,
                    item.material,
                    item.vendorName,
                    item.thickness,
                    item.sqFt.toString(),
                    item.slabsNeeded.toString(),
                    item.availability,
                    `$${item.rawCostPerSqFt.toFixed(2)}`,
                    `$${item.costPerSqFt.toFixed(2)}`,
                    `$${item.rawTotalCost}`,
                    `$${item.totalCost}`
                ]);

                doc.autoTable({
                    startY: 110,
                    head: [['Color', 'Material', 'Vendor', 'Thickness', 'Sq Ft', 'Slabs', 'Availability', 'Raw Cost/Sq Ft', 'Inst. Cost/Sq Ft', 'Raw Total', 'Inst. Total']],
                    body: tableData,
                    theme: 'grid',
                    styles: { fontSize: 10, cellPadding: 2 },
                    headStyles: { fillColor: [37, 99, 235] },
                    alternateRowStyles: { fillColor: [240, 240, 240] }
                });

                const finalY = doc.lastAutoTable.finalY + 20;
                doc.setFontSize(12);
                doc.text('Estimate Summary:', 20, finalY);
                const writeupLines = doc.splitTextToSize(generateCustomerWriteup(), 170);
                doc.text(writeupLines, 20, finalY + 10);

                doc.save(`Surprise_Granite_Estimate_${new Date().toISOString().split('T')[0]}.pdf`);
                showToast('Estimate exported as PDF.');
            };

            return (
                <div className="min-h-screen flex flex-col" style={{ backgroundColor: 'var(--bg-primary)', color: 'var(--text-primary)' }}>
                    <header className="fixed top-0 left-0 right-0 z-20 p-2 sm:p-4 flex flex-col gap-2 shadow-md" style={{ backgroundColor: 'var(--bg-secondary)' }}>
                        <div className="max-w-6xl mx-auto w-full flex items-center justify-between">
                            <div className="flex items-center gap-2">
                                <img
                                    src="https://cdn.prod.website-files.com/6456ce4476abb25581fbad0c/64a70d4b30e87feb388f004f_surprise-granite-profile-logo.svg"
                                    alt="Surprise Granite Logo"
                                    className="h-8 sm:h-10"
                                />
                                <h1 className="text-lg sm:text-xl font-semibold">Countertop Estimator</h1>
                            </div>
                            <div className="flex items-center gap-2">
                                {cart.length > 0 && (
                                    <button
                                        onClick={() => {
                                            setShowCart(true);
                                            cartRef.current.scrollIntoView({ behavior: 'smooth', block: 'start' });
                                        }}
                                        className="px-2 sm:px-3 py-1 sm:py-2 rounded-lg text-xs sm:text-sm font-medium transition-colors duration-200"
                                        style={{ backgroundColor: 'var(--accent-color)', color: 'var(--text-white)' }}
                                        aria-label="View cart"
                                    >
                                        Cart ({cart.length}/6)
                                    </button>
                                )}
                                <button
                                    onClick={toggleTheme}
                                    className="px-2 sm:px-3 py-1 sm:py-2 rounded-lg hover:bg-gray-200 transition-colors duration-200"
                                    aria-label="Switch theme"
                                >
                                    {theme === 'light' ? (
                                        <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                                        </svg>
                                    ) : (
                                        <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                                        </svg>
                                    )}
                                </button>
                            </div>
                        </div>
                        <div className="max-w-6xl mx-auto w-full">
                            <div className="relative flex items-center">
                                <input
                                    ref={searchInputRef}
                                    type="search"
                                    value={searchQuery}
                                    onChange={(e) => {
                                        setSearchQuery(e.target.value);
                                        debouncedSetSearchQuery(e.target.value);
                                    }}
                                    onKeyDown={handleSearchKeyDown}
                                    placeholder="Search countertops..."
                                    className="w-full p-2 pl-10 border rounded-lg text-sm focus:outline-none"
                                    aria-label="Search countertops"
                                    style={{ borderColor: 'var(--border-color)', backgroundColor: 'var(--bg-secondary)', color: 'var(--text-primary)' }}
                                />
                                <svg
                                    className="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                    stroke="currentColor"
                                    style={{ color: 'var(--text-secondary)' }}
                                >
                                    <path
                                        strokeLinecap="round"
                                        strokeLinejoin="round"
                                        strokeWidth="2"
                                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                                    />
                                </svg>
                                {searchQuery && (
                                    <button
                                        onClick={clearSearch}
                                        className="absolute right-2 top-1/2 transform -translate-y-1/2 text-sm text-blue-600 hover:underline"
                                        aria-label="Clear search"
                                    >
                                        Clear
                                    </button>
                                )}
                                {suggestions.length > 0 && (
                                    <div className="autocomplete-dropdown">
                                        {suggestions.map((suggestion, index) => (
                                            <div
                                                key={index}
                                                className={`autocomplete-item ${index === suggestionIndex ? 'selected' : ''}`}
                                                onClick={() => handleSuggestionClick(suggestion)}
                                            >
                                                {suggestion.label}
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    </header>

                    <main className="flex-1 pb-16 px-2 sm:px-4 max-w-6xl mx-auto w-full" style={{ paddingTop: `calc(${headerHeight}px + 24px)` }}>
                        {usingFallbackData && (
                            <p className="text-center text-yellow-600 my-4 text-sm">
                                Note: Using fallback data because the price list CSV could not be loaded. Contact support if this persists.
                            </p>
                        )}
                        <div className="filter-bar shadow-md">
                            <div className="max-w-6xl mx-auto w-full flex flex-wrap gap-2 sm:gap-4">
                                <div className="flex-1 min-w-[120px]">
                                    <select
                                        value={filters.vendor}
                                        onChange={(e) => setFilters({ ...filters, vendor: e.target.value, material: 'All Materials', thickness: 'All Thicknesses' })}
                                        className="w-full p-2 border rounded-lg text-sm focus:outline-none"
                                        aria-label="Filter by vendor"
                                        style={{ borderColor: 'var(--border-color)', backgroundColor: 'var(--bg-secondary)', color: 'var(--text-primary)' }}
                                    >
                                        {vendors.map(vendor => (
                                            <option key={vendor} value={vendor}>{vendor}</option>
                                        ))}
                                    </select>
                                </div>
                                <div className="flex-1 min-w-[120px]">
                                    <select
                                        value={filters.material}
                                        onChange={(e) => setFilters({ ...filters, material: e.target.value, thickness: 'All Thicknesses' })}
                                        className="w-full p-2 border rounded-lg text-sm focus:outline-none"
                                        aria-label="Filter by material"
                                        style={{ borderColor: 'var(--border-color)', backgroundColor: 'var(--bg-secondary)', color: 'var(--text-primary)' }}
                                    >
                                        {availableMaterials.map(material => (
                                            <option key={material} value={material}>{material}</option>
                                        ))}
                                    </select>
                                </div>
                                <div className="flex-1 min-w-[120px]">
                                    <select
                                        value={filters.thickness}
                                        onChange={(e) => setFilters({ ...filters, thickness: e.target.value })}
                                        className="w-full p-2 border rounded-lg text-sm focus:outline-none"
                                        aria-label="Filter by thickness"
                                        style={{ borderColor: 'var(--border-color)', backgroundColor: 'var(--bg-secondary)', color: 'var(--text-primary)' }}
                                    >
                                        {availableThicknesses.map(thickness => (
                                            <option key={thickness} value={thickness}>{thickness}</option>
                                        ))}
                                    </select>
                                </div>
                                <div className="flex-1 min-w-[120px]">
                                    <select
                                        value={sortBy}
                                        onChange={(e) => setSortBy(e.target.value)}
                                        className="w-full p-2 border rounded-lg text-sm focus:outline-none"
                                        aria-label="Sort by"
                                        style={{ borderColor: 'var(--border-color)', backgroundColor: 'var(--bg-secondary)', color: 'var(--text-primary)' }}
                                    >
                                        <option value="popularity">Popularity</option>
                                        <option value="cost-asc">Cost (Low to High)</option>
                                        <option value="cost-desc">Cost (High to Low)</option>
                                    </select>
                                </div>
                                <div className="flex-1 min-w-[120px]">
                                    <button
                                        onClick={() => {
                                            const newZip = prompt('Enter your ZIP code:', zipCode || '');
                                            if (newZip && /^\d{5}$/.test(newZip)) {
                                                setZipCode(newZip);
                                                const region = newZip.startsWith('85') ? { name: 'Southwest', multiplier: 1.0 } :
                                                               newZip.startsWith('1') ? { name: 'Northeast', multiplier: 1.25 } :
                                                               newZip.startsWith('9') ? { name: 'West Coast', multiplier: 1.2 } :
                                                               newZip.startsWith('6') ? { name: 'Midwest', multiplier: 1.1 } :
                                                               { name: 'Southeast', multiplier: 1.05 };
                                                setRegionName(region.name);
                                                setRegionMultiplier(region.multiplier);
                                                fetchPriceList();
                                                showToast(`Region set to ${region.name}`);
                                            } else if (newZip) {
                                                showToast('Invalid ZIP code', true);
                                            }
                                        }}
                                        className="w-full p-2 border rounded-lg text-sm text-left"
                                        style={{ borderColor: 'var(--border-color)', backgroundColor: 'var(--bg-secondary)', color: 'var(--text-primary)' }}
                                        aria-label="Set ZIP code"
                                    >
                                        {zipCode ? `Region: ${regionName}` : 'Set ZIP Code'}
                                    </button>
                                </div>
                            </div>
                        </div>
                        {isLoading ? (
                            <div className="text-center my-6">
                                <svg className="animate-spin h-8 w-8 mx-auto" viewBox="0 0 24 24">
                                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                    <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8h8a8 8 0 01-8 8v-8H4z"></path>
                                </svg>
                                <p style={{ color: 'var(--text-secondary)' }} className="text-sm">Loading countertops...</p>
                            </div>
                        ) : (
                            <div className="my-4">
                                <h2 className="text-lg font-semibold mb-4" style={{ color: 'var(--text-primary)' }}>
                                    Price Sheet ({filteredResults.length} options)
                                </h2>
                                {isSearchLoading ? (
                                    <div className="text-center">
                                        <svg className="animate-spin h-8 w-8 mx-auto" viewBox="0 0 24 24">
                                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8h8a8 8 0 01-8 8v-8H4z"></path>
                                        </svg>
                                        <p style={{ color: 'var(--text-secondary)' }} className="text-sm">Searching...</p>
                                    </div>
                                ) : filteredResults.length === 0 ? (
                                    <p className="text-center text-sm" style={{ color: 'var(--text-secondary)' }}>
                                        No countertops found
                                    </p>
                                ) : (
                                    <div className="space-y-2">
                                        {filteredResults.map(item => (
                                            <div key={item.id} className="card bg-white p-2 sm:p-3 rounded-lg shadow flex items-center gap-3 fade-in">
                                                <img
                                                    src={item.imageUrl}
                                                    alt={`${item.colorName} preview`}
                                                    className="w-10 sm:w-12 h-10 sm:h-12 rounded-full object-cover"
                                                    onError={(e) => e.target.src = 'https://cdn.prod.website-files.com/6456ce4476abb25581fbad0c/64a70d4b30e87feb388f004f_surprise-granite-profile-logo.svg'}
                                                />
                                                <div className="flex-1">
                                                    <p className="text-sm font-medium" style={{ color: 'var(--text-primary)' }}>{item.colorName}</p>
                                                    <p className="text-xs" style={{ color: 'var(--text-secondary)' }}>
                                                        {item.material}, {item.vendorName}, {item.thickness}
                                                    </p>
                                                    <p className="text-xs" style={{ color: 'var(--text-secondary)' }}>
                                                        Raw: ${item.rawCostPerSqFt.toFixed(2)}/sq ft, Installed: ${item.costPerSqFt.toFixed(2)}/sq ft
                                                    </p>
                                                    <p className={`text-xs availability-${item.availability.toLowerCase().replace(' ', '-')}`}>
                                                        {item.availability}
                                                    </p>
                                                </div>
                                                <button
                                                    onClick={() => addToCart(item)}
                                                    className="px-3 sm:px-4 py-1 sm:py-2 rounded-lg text-xs sm:text-sm font-medium transition-colors duration-200"
                                                    style={{ backgroundColor: 'var(--accent-color)', color: 'var(--text-white)' }}
                                                    disabled={cart.some(cartItem => cartItem.id === item.id)}
                                                    aria-label={`Add ${item.colorName} to cart`}
                                                >
                                                    {cart.some(cartItem => cartItem.id === item.id) ? 'In Cart' : 'Add'}
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                        {showCart && cart.length > 0 && (
                            <div id="cart-section" ref={cartRef} className="mt-6 bg-white shadow-md rounded-lg p-3 sm:p-4 fade-in">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-lg font-semibold" style={{ color: 'var(--text-primary)' }}>
                                        Project Estimate ({cart.length}/6)
                                    </h2>
                                    <button
                                        onClick={() => setShowCart(false)}
                                        className="text-sm text-blue-600 hover:underline"
                                        aria-label="Hide cart"
                                    >
                                        Hide
                                    </button>
                                </div>
                                <p className="text-sm font-medium mb-2 fade-in" style={{ color: 'var(--text-primary)' }}>
                                    Total: ${calculateCartTotal()} | Slabs: {calculateCartSlabs()}
                                </p>
                                <div className="overflow-x-auto">
                                    <table className="min-w-full divide-y" style={{ borderColor: 'var(--border-color)' }}>
                                        <thead style={{ backgroundColor: 'var(--bg-table-header)' }}>
                                            <tr>
                                                <th className="px-2 sm:px-3 py-2 text-left text-xs sm:text-sm font-medium" style={{ color: 'var(--text-header)' }}>Color</th>
                                                <th className="px-2 sm:px-3 py-2 text-left text-xs sm:text-sm font-medium" style={{ color: 'var(--text-header)' }}>Material</th>
                                                <th className="px-2 sm:px-3 py-2 text-left text-xs sm:text-sm font-medium" style={{ color: 'var(--text-header)' }}>Vendor</th>
                                                <th className="px-2 sm:px-3 py-2 text-left text-xs sm:text-sm font-medium" style={{ color: 'var(--text-header)' }}>Thickness</th>
                                                <th className="px-2 sm:px-3 py-2 text-left text-xs sm:text-sm font-medium" style={{ color: 'var(--text-header)' }}>
                                                    <span className="tooltip">
                                                        Sq Ft
                                                        <span className="tooltip-text">Square footage.</span>
                                                    </span>
                                                </th>
                                                <th className="px-2 sm:px-3 py-2 text-left text-xs sm:text-sm font-medium" style={{ color: 'var(--text-header)' }}>
                                                    <span className="tooltip">
                                                        Slabs
                                                        <span className="tooltip-text">Number of slabs.</span>
                                                    </span>
                                                </th>
                                                <th className="px-2 sm:px-3 py-2 text-left text-xs sm:text-sm font-medium" style={{ color: 'var(--text-header)' }}>
                                                    <span className="tooltip">
                                                        Avail.
                                                        <span className="tooltip-text">Stock status.</span>
                                                    </span>
                                                </th>
                                                <th className="px-2 sm:px-3 py-2 text-left text-xs sm:text-sm font-medium" style={{ color: 'var(--text-header)' }}>
                                                    <span className="tooltip">
                                                        Raw
                                                        <span className="tooltip-text">Raw cost/sq ft.</span>
                                                    </span>
                                                </th>
                                                <th className="px-2 sm:px-3 py-2 text-left text-xs sm:text-sm font-medium" style={{ color: 'var(--text-header)' }}>
                                                    <span className="tooltip">
                                                        Inst.
                                                        <span className="tooltip-text">Installed cost/sq ft.</span>
                                                    </span>
                                                </th>
                                                <th className="px-2 sm:px-3 py-2 text-left text-xs sm:text-sm font-medium" style={{ color: 'var(--text-header)' }}>
                                                    <span className="tooltip">
                                                        Total
                                                        <span className="tooltip-text">Total installed cost.</span>
                                                    </span>
                                                </th>
                                                <th className="px-2 sm:px-3 py-2 text-left text-xs sm:text-sm font-medium" style={{ color: 'var(--text-header)' }}>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y" style={{ borderColor: 'var(--border-color)', backgroundColor: 'var(--bg-secondary)' }}>
                                            {cart.map(item => (
                                                <tr key={item.id} className="fade-in">
                                                    <td className="px-2 sm:px-3 py-2 whitespace-nowrap text-xs sm:text-sm" style={{ color: 'var(--text-primary)' }}>{item.colorName}</td>
                                                    <td className="px-2 sm:px-3 py-2 whitespace-nowrap text-xs sm:text-sm" style={{ color: 'var(--text-secondary)' }}>{item.material}</td>
                                                    <td className="px-2 sm:px-3 py-2 whitespace-nowrap text-xs sm:text-sm" style={{ color: 'var(--text-secondary)' }}>{item.vendorName}</td>
                                                    <td className="px-2 sm:px-3 py-2 whitespace-nowrap text-xs sm:text-sm" style={{ color: 'var(--text-secondary)' }}>{item.thickness}</td>
                                                    <td className="px-2 sm:px-3 py-2 whitespace-nowrap">
                                                        <input
                                                            type="number"
                                                            value={item.sqFt}
                                                            onChange={(e) => updateCartItem(item.id, e.target.value)}
                                                            className="w-16 p-1 border rounded-lg text-xs sm:text-sm focus:outline-none"
                                                            min="0"
                                                            step="0.01"
                                                            aria-label={`Square footage for ${item.colorName}`}
                                                            style={{ borderColor: 'var(--border-color)', backgroundColor: 'var(--bg-secondary)', color: 'var(--text-primary)' }}
                                                        />
                                                    </td>
                                                    <td className="px-2 sm:px-3 py-2 whitespace-nowrap text-xs sm:text-sm" style={{ color: 'var(--text-secondary)' }}>{item.slabsNeeded}</td>
                                                    <td className={`px-2 sm:px-3 py-2 whitespace-nowrap text-xs sm:text-sm availability-${item.availability.toLowerCase().replace(' ', '-')}`}>
                                                        {item.availability}
                                                    </td>
                                                    <td className="px-2 sm:px-3 py-2 whitespace-nowrap text-xs sm:text-sm" style={{ color: 'var(--text-secondary)' }}>${item.rawCostPerSqFt.toFixed(2)}</td>
                                                    <td className="px-2 sm:px-3 py-2 whitespace-nowrap text-xs sm:text-sm" style={{ color: 'var(--text-secondary)' }}>${item.costPerSqFt.toFixed(2)}</td>
                                                    <td className="px-2 sm:px-3 py-2 whitespace-nowrap text-xs sm:text-sm" style={{ color: 'var(--text-secondary)' }}>${item.totalCost}</td>
                                                    <td className="px-2 sm:px-3 py-2 whitespace-nowrap">
                                                        <button
                                                            onClick={() => removeFromCart(item.id)}
                                                            className="px-2 sm:px-3 py-1 rounded-lg text-xs sm:text-sm font-medium transition-colors duration-200 bg-red-500"
                                                            style={{ color: 'var(--text-white)' }}
                                                            aria-label={`Remove ${item.colorName} from cart`}
                                                        >
                                                            Remove
                                                        </button>
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                                <div className="flex gap-4 mt-4 justify-between">
                                    <button
                                        onClick={() => {
                                            if (confirm('Clear all items from cart?')) clearCart();
                                        }}
                                        className="px-4 sm:px-6 py-2 rounded-lg text-xs sm:text-sm font-medium transition-colors duration-200 bg-gray-300"
                                        style={{ color: 'var(--text-primary)' }}
                                        aria-label="Clear cart"
                                    >
                                        Clear Cart
                                    </button>
                                    <div className="flex gap-4">
                                        <button
                                            onClick={submitQuote}
                                            className="px-4 sm:px-6 py-2 rounded-lg text-xs sm:text-sm font-medium transition-colors duration-200"
                                            style={{ backgroundColor: 'var(--accent-color)', color: 'var(--text-white)' }}
                                            aria-label="Submit quote"
                                        >
                                            Submit Quote
                                        </button>
                                        <button
                                            onClick={exportToPDF}
                                            className="px-4 sm:px-6 py-2 rounded-lg text-xs sm:text-sm font-medium transition-colors duration-200"
                                            style={{ backgroundColor: 'var(--accent-color)', color: 'var(--text-white)' }}
                                            aria-label="Export estimate to PDF"
                                        >
                                            Export Estimate
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    <div
                        className={`fixed bottom-4 left-4 right-4 sm:left-1/2 sm:right-auto sm:transform sm:-translate-x-1/2 px-4 py-2 rounded-lg text-xs sm:text-sm ${toast.isError ? 'bg-red-500' : 'bg-green-500'} ${toast.show ? 'opacity-100' : 'opacity-0'} transition-opacity`}
                        style={{ zIndex: 1000, color: 'var(--text-white)' }}
                    >
                        {toast.message}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
