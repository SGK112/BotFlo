<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BotFlo.ai - Bot Builder & Customizer</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #5a6fd8;
            --secondary: #764ba2;
            --accent: #f093fb;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --sidebar-width: 300px;
        }

        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--gray-50);
            overflow: hidden;
        }

        /* Header */
        .header {
            background: white;
            border-bottom: 1px solid var(--gray-200);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
            z-index: 1000;
            position: relative;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .bot-name {
            background: var(--gray-100);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            color: var(--gray-700);
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        /* Main Layout */
        .main-container {
            display: flex;
            height: calc(100vh - 70px);
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: white;
            border-right: 1px solid var(--gray-200);
            overflow-y: auto;
        }

        .sidebar-section {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
        }

        .sidebar-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 1rem;
        }

        /* Workspace */
        .workspace {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .workspace-header {
            background: white;
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .workspace-content {
            flex: 1;
            display: flex;
        }

        /* Canvas */
        .canvas {
            flex: 1;
            background: var(--gray-50);
            position: relative;
            overflow: auto;
        }

        /* Properties Panel */
        .properties-panel {
            width: 350px;
            background: white;
            border-left: 1px solid var(--gray-200);
            overflow-y: auto;
        }

        /* Bot Preview */
        .bot-preview {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 1rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid var(--gray-200);
        }

        .bot-preview.minimized {
            height: 60px;
            width: 200px;
        }

        .bot-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .bot-messages {
            flex: 1;
            background: var(--gray-50);
            padding: 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .bot-input {
            padding: 1rem;
            border-top: 1px solid var(--gray-200);
            background: white;
            display: flex;
            gap: 0.5rem;
        }

        /* Message Bubbles */
        .message {
            max-width: 80%;
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            line-height: 1.4;
        }

        .message.bot {
            background: var(--primary);
            color: white;
            align-self: flex-start;
        }

        .message.user {
            background: white;
            color: var(--gray-800);
            align-self: flex-end;
            border: 1px solid var(--gray-200);
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 0.5rem;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--gray-300);
            border-radius: 0.5rem;
            font-size: 0.875rem;
            transition: border-color 0.2s;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            font-size: 0.875rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: var(--gray-200);
            color: var(--gray-700);
        }

        .btn-secondary:hover {
            background: var(--gray-300);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
        }

        /* Color Picker */
        .color-picker {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }

        .color-option {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .color-option.selected {
            border-color: var(--gray-700);
            transform: scale(1.1);
        }

        /* Flow Builder Elements */
        .flow-node {
            background: white;
            border: 2px solid var(--gray-200);
            border-radius: 0.75rem;
            padding: 1rem;
            margin: 1rem;
            width: 200px;
            cursor: move;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .flow-node:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.2);
        }

        .flow-node.selected {
            border-color: var(--primary);
            background: #f0f4ff;
        }

        .node-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .node-icon {
            width: 24px;
            height: 24px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }

        .node-title {
            font-weight: 600;
            color: var(--gray-800);
            font-size: 0.875rem;
        }

        .node-content {
            font-size: 0.75rem;
            color: var(--gray-600);
            line-height: 1.3;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--gray-200);
        }

        .tab {
            padding: 0.75rem 1rem;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: var(--gray-600);
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            padding: 1.5rem;
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .quick-action {
            padding: 0.5rem 1rem;
            background: var(--gray-100);
            border: 1px solid var(--gray-300);
            border-radius: 1rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-action:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .quick-action.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Checkbox Labels */
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            cursor: pointer;
            padding: 0.5rem 0;
        }

        .checkbox-label input[type="checkbox"] {
            margin: 0;
        }

        /* Analytics Summary */
        .analytics-summary {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            background: var(--gray-50);
            border-radius: 0.5rem;
        }

        .metric-label {
            font-size: 0.75rem;
            color: var(--gray-600);
        }

        .metric-value {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-800);
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--gray-800);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-400);
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: var(--gray-100);
            color: var(--gray-600);
        }

        /* Enhanced Node Styles */
        .flow-node.ai-node {
            border-color: var(--accent);
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .flow-node.webhook-node {
            border-color: var(--warning);
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .node-connector {
            position: absolute;
            width: 12px;
            height: 12px;
            background: var(--primary);
            border: 2px solid white;
            border-radius: 50%;
            cursor: pointer;
        }

        .node-connector.input {
            top: 50%;
            left: -6px;
            transform: translateY(-50%);
        }

        .node-connector.output {
            top: 50%;
            right: -6px;
            transform: translateY(-50%);
        }

        /* Connection Lines */
        .connection-line {
            position: absolute;
            border: 2px solid var(--primary);
            pointer-events: none;
            z-index: 1;
        }

        /* Advanced Settings Sections */
        .settings-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: white;
            border-radius: 0.75rem;
            border: 1px solid var(--gray-200);
        }

        .settings-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Metric Cards */
        .metric-card {
            background: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            border: 1px solid var(--gray-200);
            text-align: center;
        }

        .metric-card h4 {
            font-size: 0.875rem;
            color: var(--gray-600);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .metric-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }

        /* Integration Modal */
        .integration-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-indicator.active {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .status-indicator.inactive {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }

        /* Test Results */
        .test-result {
            background: var(--gray-50);
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 0.5rem 0;
            border-left: 4px solid var(--gray-300);
        }

        .test-result.success {
            border-left-color: var(--success);
            background: rgba(16, 185, 129, 0.05);
        }

        .test-result.error {
            border-left-color: var(--error);
            background: rgba(239, 68, 68, 0.05);
        }

        .test-result.warning {
            border-left-color: var(--warning);
            background: rgba(245, 158, 11, 0.05);
        }

        /* Embed Code Display */
        .embed-code {
            background: var(--gray-900);
            color: var(--gray-100);
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.875rem;
            overflow-x: auto;
            margin: 1rem 0;
        }

        /* AI Training Interface */
        .training-progress {
            background: var(--gray-200);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .training-progress-bar {
            background: linear-gradient(90deg, var(--primary), var(--accent));
            height: 100%;
            transition: width 0.3s ease;
            width: 0%;
        }

        .training-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 1rem 0;
            font-size: 0.875rem;
        }

        .training-log {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: 0.5rem;
            padding: 1rem;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.75rem;
            line-height: 1.4;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .properties-panel {
                width: 300px;
            }
            .bot-preview {
                width: 300px;
                height: 400px;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 250px;
            }
            .header {
                padding: 1rem;
            }
            .properties-panel {
                display: none;
            }
        }

        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide-in {
            animation: slideIn 0.3s ease;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: var(--success);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            animation: slideIn 0.3s ease;
        }

        .notification.error {
            background: var(--error);
        }

        .notification.warning {
            background: var(--warning);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div style="display: flex; align-items: center; gap: 2rem;">
            <div class="logo">
                <i class="fas fa-robot"></i>
                BotFlo.ai
            </div>
            <div class="bot-name" id="botName">Restaurant Bot</div>
        </div>
        <div class="header-actions">
            <button class="btn btn-secondary" onclick="testBot()">
                <i class="fas fa-play"></i> Test
            </button>
            <button class="btn btn-primary" onclick="saveBot()">
                <i class="fas fa-save"></i> Save
            </button>
            <button class="btn btn-success" onclick="exportBot()">
                <i class="fas fa-download"></i> Export
            </button>
            <button class="btn btn-secondary" onclick="goBack()">
                <i class="fas fa-arrow-left"></i> Back
            </button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Left Sidebar -->
        <div class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">Bot Type</div>
                <select class="form-select" id="botType" onchange="changeBotType()">
                    <option value="restaurant">üçï Restaurant Bot</option>
                    <option value="support">üéß Support Bot</option>
                    <option value="realestate">üè† Real Estate Bot</option>
                    <option value="custom">‚öôÔ∏è Custom Bot</option>
                </select>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Quick Setup</div>
                <div class="quick-actions" id="quickSetup">
                    <div class="quick-action selected" onclick="selectQuickAction(this, 'basic')">Basic Info</div>
                    <div class="quick-action" onclick="selectQuickAction(this, 'messages')">Messages</div>
                    <div class="quick-action" onclick="selectQuickAction(this, 'actions')">Actions</div>
                    <div class="quick-action" onclick="selectQuickAction(this, 'style')">Styling</div>
                </div>
            </div>

            <div class="sidebar-section" id="templateSection">
                <div class="sidebar-title">Templates</div>
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                    <button class="btn btn-secondary btn-small" onclick="loadTemplate('welcome')">
                        <i class="fas fa-hand-wave"></i> Welcome Flow
                    </button>
                    <button class="btn btn-secondary btn-small" onclick="loadTemplate('support')">
                        <i class="fas fa-headset"></i> Support Flow
                    </button>
                    <button class="btn btn-secondary btn-small" onclick="loadTemplate('sales')">
                        <i class="fas fa-shopping-cart"></i> Sales Flow
                    </button>
                </div>
            </div>

            <div class="sidebar-section" id="nodeLibrary">
                <div class="sidebar-title">Add Components</div>
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                    <button class="btn btn-secondary btn-small" onclick="addNode('message')">
                        <i class="fas fa-comment"></i> Message
                    </button>
                    <button class="btn btn-secondary btn-small" onclick="addNode('question')">
                        <i class="fas fa-question"></i> Question
                    </button>
                    <button class="btn btn-secondary btn-small" onclick="addNode('action')">
                        <i class="fas fa-cog"></i> Action
                    </button>
                    <button class="btn btn-secondary btn-small" onclick="addNode('condition')">
                        <i class="fas fa-code-branch"></i> Condition
                    </button>
                    <button class="btn btn-secondary btn-small" onclick="addNode('ai')">
                        <i class="fas fa-brain"></i> AI Response
                    </button>
                    <button class="btn btn-secondary btn-small" onclick="addNode('webhook')">
                        <i class="fas fa-plug"></i> Webhook
                    </button>
                </div>
            </div>

            <div class="sidebar-section" id="aiSection">
                <div class="sidebar-title">AI Features</div>
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                    <label class="checkbox-label">
                        <input type="checkbox" id="enableAI" onchange="toggleAI(this.checked)">
                        <span>Enable AI Responses</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="enableNLP" onchange="toggleNLP(this.checked)">
                        <span>Natural Language Processing</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="sentimentAnalysis" onchange="toggleSentiment(this.checked)">
                        <span>Sentiment Analysis</span>
                    </label>
                    <button class="btn btn-secondary btn-small" onclick="trainBot()">
                        <i class="fas fa-graduation-cap"></i> Train Bot
                    </button>
                </div>
            </div>

            <div class="sidebar-section" id="integrationsSection">
                <div class="sidebar-title">Integrations</div>
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                    <button class="btn btn-secondary btn-small" onclick="openIntegrationModal('slack')">
                        <i class="fab fa-slack"></i> Slack
                    </button>
                    <button class="btn btn-secondary btn-small" onclick="openIntegrationModal('email')">
                        <i class="fas fa-envelope"></i> Email
                    </button>
                    <button class="btn btn-secondary btn-small" onclick="openIntegrationModal('webhook')">
                        <i class="fas fa-link"></i> Webhooks
                    </button>
                    <button class="btn btn-secondary btn-small" onclick="openIntegrationModal('analytics')">
                        <i class="fas fa-chart-bar"></i> Analytics
                    </button>
                </div>
            </div>

            <div class="sidebar-section" id="analyticsSection">
                <div class="sidebar-title">Performance</div>
                <div class="analytics-summary">
                    <div class="metric">
                        <span class="metric-label">Conversations</span>
                        <span class="metric-value" id="totalConversations">0</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Avg. Session</span>
                        <span class="metric-value" id="avgSession">0m</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Satisfaction</span>
                        <span class="metric-value" id="satisfaction">0%</span>
                    </div>
                    <button class="btn btn-secondary btn-small" onclick="viewDetailedAnalytics()">
                        <i class="fas fa-chart-line"></i> View Details
                    </button>
                </div>
            </div>
        </div>

        <!-- Workspace -->
        <div class="workspace">
            <div class="workspace-header">
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('visual')">Visual Builder</button>
                    <button class="tab" onclick="switchTab('conversation')">Conversation Flow</button>
                    <button class="tab" onclick="switchTab('settings')">Bot Settings</button>
                    <button class="tab" onclick="switchTab('analytics')">Analytics</button>
                    <button class="tab" onclick="switchTab('integrations')">Integrations</button>
                    <button class="tab" onclick="switchTab('testing')">Testing & Deploy</button>
                </div>
            </div>

            <div class="workspace-content">
                <!-- Canvas -->
                <div class="canvas" id="canvas">
                    <div class="tab-content active" id="visual-tab">
                        <!-- Visual flow builder will be here -->
                        <div style="padding: 2rem; text-align: center; color: var(--gray-500);">
                            <i class="fas fa-mouse-pointer" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                            <h3>Drag components from the sidebar to start building</h3>
                            <p>Click on components to customize them</p>
                        </div>
                    </div>

                    <div class="tab-content" id="conversation-tab">
                        <div style="padding: 2rem;">
                            <h3>Conversation Flow</h3>
                            <div id="conversationFlow"></div>
                        </div>
                    </div>

                    <div class="tab-content" id="settings-tab">
                        <div style="padding: 2rem;">
                            <h3>Bot Settings</h3>
                            <div id="botSettings"></div>
                        </div>
                    </div>

                    <div class="tab-content" id="analytics-tab">
                        <div style="padding: 2rem;">
                            <div class="settings-section">
                                <div class="settings-title">
                                    <i class="fas fa-chart-line"></i>
                                    Performance Analytics
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                                    <div class="metric-card">
                                        <h4>Total Conversations</h4>
                                        <div class="metric-number" id="analyticsConversations">0</div>
                                    </div>
                                    <div class="metric-card">
                                        <h4>Avg. Session Length</h4>
                                        <div class="metric-number" id="analyticsSessionLength">0m</div>
                                    </div>
                                    <div class="metric-card">
                                        <h4>Success Rate</h4>
                                        <div class="metric-number" id="analyticsSuccessRate">0%</div>
                                    </div>
                                    <div class="metric-card">
                                        <h4>User Satisfaction</h4>
                                        <div class="metric-number" id="analyticsSatisfaction">0%</div>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 1rem;">
                                    <button class="btn btn-primary" onclick="refreshAnalytics()">
                                        <i class="fas fa-sync"></i> Refresh Data
                                    </button>
                                    <button class="btn btn-secondary" onclick="exportAnalytics()">
                                        <i class="fas fa-download"></i> Export Report
                                    </button>
                                </div>
                            </div>
                            
                            <div class="settings-section">
                                <div class="settings-title">
                                    <i class="fas fa-comments"></i>
                                    Recent Conversations
                                </div>
                                <div id="recentConversations">
                                    <p style="color: var(--gray-500); text-align: center; padding: 2rem;">
                                        No conversations yet. Start testing your bot to see analytics here.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="integrations-tab">
                        <div style="padding: 2rem;">
                            <div class="settings-section">
                                <div class="settings-title">
                                    <i class="fab fa-slack"></i>
                                    Slack Integration
                                </div>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="slackEnabled" onchange="toggleIntegration('slack', this.checked)">
                                    <span>Enable Slack Integration</span>
                                </label>
                                <div class="form-group" style="margin-top: 1rem;">
                                    <label class="form-label">Webhook URL</label>
                                    <input type="url" class="form-input" id="slackWebhook" placeholder="https://hooks.slack.com/services/...">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Channel</label>
                                    <input type="text" class="form-input" id="slackChannel" placeholder="#general">
                                </div>
                            </div>

                            <div class="settings-section">
                                <div class="settings-title">
                                    <i class="fas fa-envelope"></i>
                                    Email Notifications
                                </div>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="emailEnabled" onchange="toggleIntegration('email', this.checked)">
                                    <span>Enable Email Notifications</span>
                                </label>
                                <div class="form-group" style="margin-top: 1rem;">
                                    <label class="form-label">SMTP Server</label>
                                    <input type="text" class="form-input" id="emailSMTP" placeholder="smtp.gmail.com">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Notification Email</label>
                                    <input type="email" class="form-input" id="notificationEmail" placeholder="admin@company.com">
                                </div>
                            </div>

                            <div class="settings-section">
                                <div class="settings-title">
                                    <i class="fas fa-link"></i>
                                    Webhook Integration
                                </div>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="webhookEnabled" onchange="toggleIntegration('webhook', this.checked)">
                                    <span>Enable Webhook</span>
                                </label>
                                <div class="form-group" style="margin-top: 1rem;">
                                    <label class="form-label">Webhook URL</label>
                                    <input type="url" class="form-input" id="webhookURL" placeholder="https://api.yourcompany.com/webhook">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Method</label>
                                    <select class="form-select" id="webhookMethod">
                                        <option value="POST">POST</option>
                                        <option value="PUT">PUT</option>
                                        <option value="PATCH">PATCH</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="testing-tab">
                        <div style="padding: 2rem;">
                            <div class="settings-section">
                                <div class="settings-title">
                                    <i class="fas fa-vial"></i>
                                    Test Your Bot
                                </div>
                                <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                                    <button class="btn btn-primary" onclick="testBot()">
                                        <i class="fas fa-play"></i> Start Test
                                    </button>
                                    <button class="btn btn-secondary" onclick="validateBot()">
                                        <i class="fas fa-check-double"></i> Validate Bot
                                    </button>
                                    <button class="btn btn-secondary" onclick="previewBot()">
                                        <i class="fas fa-eye"></i> Preview
                                    </button>
                                </div>
                                <div id="testResults" style="display: none;">
                                    <h4>Test Results</h4>
                                    <div id="testOutput"></div>
                                </div>
                            </div>

                            <div class="settings-section">
                                <div class="settings-title">
                                    <i class="fas fa-rocket"></i>
                                    Deploy Bot
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Deployment Environment</label>
                                    <select class="form-select" id="deployEnvironment">
                                        <option value="staging">Staging</option>
                                        <option value="production">Production</option>
                                    </select>
                                </div>
                                <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                                    <button class="btn btn-success" onclick="deployBot()">
                                        <i class="fas fa-cloud-upload-alt"></i> Deploy Bot
                                    </button>
                                    <button class="btn btn-secondary" onclick="generateEmbedCode()">
                                        <i class="fas fa-code"></i> Get Embed Code
                                    </button>
                                </div>
                            </div>

                            <div class="settings-section">
                                <div class="settings-title">
                                    <i class="fas fa-download"></i>
                                    Export & Import
                                </div>
                                <div style="display: flex; gap: 1rem;">
                                    <button class="btn btn-secondary" onclick="exportBot()">
                                        <i class="fas fa-file-export"></i> Export Bot
                                    </button>
                                    <button class="btn btn-secondary" onclick="importBot()">
                                        <i class="fas fa-file-import"></i> Import Bot
                                    </button>
                                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleBotImport(this)">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Properties Panel -->
                <div class="properties-panel">
                    <div style="padding: 1.5rem; border-bottom: 1px solid var(--gray-200);">
                        <h3>Properties</h3>
                        <p style="font-size: 0.875rem; color: var(--gray-600); margin-top: 0.5rem;">
                            Select a component to edit its properties
                        </p>
                    </div>
                    <div id="propertiesContent" style="padding: 1.5rem;">
                        <!-- Properties will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bot Preview -->
    <div class="bot-preview" id="botPreview">
        <div class="bot-header">
            <div style="display: flex; align-items: center; gap: 0.75rem;">
                <div style="width: 32px; height: 32px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                    <span id="previewIcon">üçï</span>
                </div>
                <div>
                    <div style="font-weight: 600;" id="previewBotName">RestaurantBot</div>
                    <div style="font-size: 0.75rem; opacity: 0.9;">Online ‚Ä¢ Preview Mode</div>
                </div>
            </div>
            <button onclick="togglePreview()" style="background: none; border: none; color: white; cursor: pointer;">
                <i class="fas fa-minimize" id="previewToggle"></i>
            </button>
        </div>
        <div class="bot-messages" id="previewMessages">
            <div class="message bot">
                Welcome to our restaurant! üçΩÔ∏è How can I help you today?
            </div>
        </div>
        <div class="bot-input">
            <input type="text" placeholder="Type a message..." style="flex: 1; padding: 0.5rem; border: 1px solid var(--gray-300); border-radius: 1rem; outline: none;" id="previewInput" onkeypress="if(event.key==='Enter') sendPreviewMessage()">
            <button onclick="sendPreviewMessage()" style="background: var(--primary); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer;">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Integration Modal -->
    <div class="modal" id="integrationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="integrationModalTitle">Integration Settings</h3>
                <button class="modal-close" onclick="closeIntegrationModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="integrationModalContent">
                <!-- Integration content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- AI Training Modal -->
    <div class="modal" id="aiTrainingModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">AI Training Center</h3>
                <button class="modal-close" onclick="closeModal('aiTrainingModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div style="padding: 1rem;">
                <div class="training-status">
                    <i class="fas fa-brain"></i>
                    <span id="trainingStatusText">Ready to train</span>
                </div>
                <div class="training-progress">
                    <div class="training-progress-bar" id="trainingProgressBar"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Training Data Source</label>
                    <select class="form-select" id="trainingSource">
                        <option value="conversations">Past Conversations</option>
                        <option value="faq">FAQ Data</option>
                        <option value="custom">Custom Dataset</option>
                    </select>
                </div>
                <div class="training-log" id="trainingLog">
                    Waiting for training to start...
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                    <button class="btn btn-primary" onclick="startTraining()">
                        <i class="fas fa-play"></i> Start Training
                    </button>
                    <button class="btn btn-secondary" onclick="resetTraining()">
                        <i class="fas fa-undo"></i> Reset
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Analytics Detail Modal -->
    <div class="modal" id="analyticsModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title">Detailed Analytics</h3>
                <button class="modal-close" onclick="closeModal('analyticsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div style="padding: 1rem;">
                <div id="analyticsCharts">
                    <!-- Charts and detailed analytics will be rendered here -->
                    <div style="text-align: center; padding: 2rem; color: var(--gray-500);">
                        <i class="fas fa-chart-line" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                        <h4>Analytics Dashboard</h4>
                        <p>Deploy your bot to start collecting analytics data</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Embed Code Modal -->
    <div class="modal" id="embedModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Embed Your Bot</h3>
                <button class="modal-close" onclick="closeModal('embedModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div style="padding: 1rem;">
                <p style="margin-bottom: 1rem;">Copy the code below to embed your bot on any website:</p>
                <div class="embed-code" id="embedCode">
                    <!-- Embed code will be generated here -->
                </div>
                <button class="btn btn-primary" onclick="copyEmbedCode()">
                    <i class="fas fa-copy"></i> Copy Code
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentBot = {
            type: 'restaurant',
            name: 'RestaurantBot',
            icon: 'üçï',
            welcome: 'Welcome to our restaurant! üçΩÔ∏è How can I help you today?',
            quickActions: ['View Menu', 'Make Reservation', 'Order Delivery', 'Contact Us'],
            responses: {
                'menu': 'Here\'s our delicious menu! üçï Pizza from $12, üçù Pasta from $8, ü•ó Salads from $6. What sounds good?',
                'reservation': 'I\'d love to help you book a table! üìÖ What date and time work for you?',
                'order': 'Great! Let\'s get your order started. üöö Would you like pickup or delivery?',
                'contact': 'You can reach us at (555) 123-4567 or visit us at 123 Main St. We\'re open 11am-10pm daily! üìû'
            },
            style: {
                primaryColor: '#667eea',
                accentColor: '#764ba2',
                textColor: '#374151',
                backgroundColor: '#f9fafb'
            },
            nodes: [],
            connections: [],
            settings: {
                aiEnabled: false,
                webhookUrl: '',
                analytics: true,
                fallbackMessage: 'I didn\'t understand that. Can you please rephrase?',
                typingIndicator: true,
                maxRetries: 3,
                language: 'en',
                timezone: 'UTC',
                autoSave: true,
                enableNLP: false,
                sentimentAnalysis: false
            },
            integrations: {
                slack: { enabled: false, webhook: '', channel: '' },
                email: { enabled: false, smtp: '', notifications: true },
                analytics: { enabled: true, trackingId: '', events: [] },
                webhook: { enabled: false, url: '', method: 'POST' },
                database: { enabled: false, connectionString: '' }
            },
            analytics: {
                totalConversations: 0,
                avgSessionLength: 0,
                topQuestions: [],
                userSatisfaction: 0,
                lastUpdated: new Date().toISOString()
            }
        };

        let selectedNode = null;
        let isDragging = false;
        let dragOffset = { x: 0, y: 0 };

        // Bot type configurations
        const BOT_CONFIGS = {
            restaurant: {
                icon: 'üçï',
                name: 'RestaurantBot',
                welcome: 'Welcome to our restaurant! üçΩÔ∏è How can I help you today?',
                quickActions: ['View Menu', 'Make Reservation', 'Order Delivery', 'Contact Us'],
                responses: {
                    'menu': 'Here\'s our delicious menu! üçï Pizza from $12, üçù Pasta from $8, ü•ó Salads from $6. What sounds good?',
                    'reservation': 'I\'d love to help you book a table! üìÖ What date and time work for you?',
                    'order': 'Great! Let\'s get your order started. üöö Would you like pickup or delivery?',
                    'contact': 'You can reach us at (555) 123-4567 or visit us at 123 Main St. We\'re open 11am-10pm daily! üìû'
                }
            },
            support: {
                icon: 'üéß',
                name: 'SupportBot',
                welcome: 'Hi there! üëã I\'m here to help with any questions or issues you might have.',
                quickActions: ['Get Help', 'Check Status', 'Report Issue', 'Live Agent'],
                responses: {
                    'help': 'I can help with account issues, billing questions, technical problems, and more! üõ†Ô∏è What do you need assistance with?',
                    'status': 'Let me check that for you... ‚úÖ All systems are operational. Is there a specific service you\'re asking about?',
                    'issue': 'Sorry to hear you\'re having trouble! üîß Can you describe the issue you\'re experiencing?',
                    'agent': 'I\'ll connect you with a live agent right away! üë®‚Äçüíº Average wait time is currently 2 minutes.'
                }
            },
            realestate: {
                icon: 'üè†',
                name: 'PropertyBot',
                welcome: 'Welcome to your real estate assistant! üè° Looking to buy, sell, or just browse properties?',
                quickActions: ['Search Homes', 'Schedule Tour', 'Get Valuation', 'Contact Agent'],
                responses: {
                    'search': 'Perfect! üîç What\'s your ideal location and budget range? I can show you the best properties available.',
                    'tour': 'I\'d love to schedule a tour for you! üö∂‚Äç‚ôÄÔ∏è Which property interests you, and when works best?',
                    'valuation': 'I can help estimate your property value! üí∞ What\'s the address you\'d like me to analyze?',
                    'agent': 'Let me connect you with one of our expert agents! üë®‚Äçüíº They\'ll be in touch within 24 hours.'
                }
            },
            custom: {
                icon: '‚öôÔ∏è',
                name: 'Custom Bot',
                welcome: 'Hello! How can I assist you today?',
                quickActions: ['Help', 'Info', 'Contact'],
                responses: {
                    'help': 'I\'m here to help! What do you need assistance with?',
                    'info': 'Let me provide you with some information.',
                    'contact': 'You can contact us for more details.'
                }
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeBotBuilder();
            loadBotFromURL();
            updatePreview();
            showNotification('Bot Builder loaded successfully!', 'success');
        });

        function initializeBotBuilder() {
            // Set up drag and drop
            setupDragAndDrop();
            
            // Load initial settings
            loadBotSettings();
            
            // Update UI
            updateBotName();
        }

        function loadBotFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const botType = urlParams.get('bot');
            const customize = urlParams.get('customize');
            
            if (botType && BOT_CONFIGS[botType]) {
                currentBot = { ...currentBot, ...BOT_CONFIGS[botType], type: botType };
                document.getElementById('botType').value = botType;
                updatePreview();
                updateBotName();
                
                if (customize === 'true') {
                    showNotification(`Customizing ${currentBot.name}`, 'info');
                }
            }
        }

        function changeBotType() {
            const botType = document.getElementById('botType').value;
            const config = BOT_CONFIGS[botType];
            
            if (config) {
                currentBot = { ...currentBot, ...config, type: botType };
                updatePreview();
                updateBotName();
                loadBotSettings();
                showNotification(`Switched to ${config.name}`, 'success');
            }
        }

        function updateBotName() {
            document.getElementById('botName').textContent = currentBot.name;
            document.getElementById('previewBotName').textContent = currentBot.name;
            document.getElementById('previewIcon').textContent = currentBot.icon;
        }

        function updatePreview() {
            const messages = document.getElementById('previewMessages');
            messages.innerHTML = `
                <div class="message bot">
                    ${currentBot.welcome}
                </div>
            `;
        }

        function selectQuickAction(element, action) {
            // Remove selected class from all quick actions
            document.querySelectorAll('.quick-action').forEach(el => el.classList.remove('selected'));
            
            // Add selected class to clicked element
            element.classList.add('selected');
            
            // Load corresponding content
            loadQuickActionContent(action);
        }

        function loadQuickActionContent(action) {
            const content = document.getElementById('propertiesContent');
            
            switch(action) {
                case 'basic':
                    content.innerHTML = `
                        <div class="form-group">
                            <label class="form-label">Bot Name</label>
                            <input type="text" class="form-input" value="${currentBot.name}" onchange="updateBotProperty('name', this.value)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Bot Icon</label>
                            <input type="text" class="form-input" value="${currentBot.icon}" onchange="updateBotProperty('icon', this.value)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Welcome Message</label>
                            <textarea class="form-textarea" onchange="updateBotProperty('welcome', this.value)">${currentBot.welcome}</textarea>
                        </div>
                    `;
                    break;
                    
                case 'messages':
                    content.innerHTML = `
                        <div class="form-group">
                            <label class="form-label">Quick Actions</label>
                            <div id="quickActionsEditor">
                                ${currentBot.quickActions.map((action, index) => `
                                    <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                                        <input type="text" class="form-input" value="${action}" onchange="updateQuickAction(${index}, this.value)" style="flex: 1;">
                                        <button class="btn btn-secondary btn-small" onclick="removeQuickAction(${index})">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                `).join('')}
                            </div>
                            <button class="btn btn-secondary btn-small" onclick="addQuickAction()">
                                <i class="fas fa-plus"></i> Add Action
                            </button>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Response Templates</label>
                            <div id="responsesEditor">
                                ${Object.keys(currentBot.responses).map(key => `
                                    <div class="form-group">
                                        <label class="form-label">${key.charAt(0).toUpperCase() + key.slice(1)}</label>
                                        <textarea class="form-textarea" onchange="updateResponse('${key}', this.value)">${currentBot.responses[key]}</textarea>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'actions':
                    content.innerHTML = `
                        <div class="form-group">
                            <label class="form-label">Bot Actions</label>
                            <p style="font-size: 0.875rem; color: var(--gray-600); margin-bottom: 1rem;">
                                Configure what your bot can do
                            </p>
                            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" checked> Send emails
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" checked> Make appointments
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" checked> Collect leads
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox"> Process payments
                                </label>
                            </div>
                        </div>
                    `;
                    break;
                    
                case 'style':
                    content.innerHTML = `
                        <div class="form-group">
                            <label class="form-label">Primary Color</label>
                            <div class="color-picker">
                                <div class="color-option selected" style="background: #667eea;" onclick="selectColor('#667eea')"></div>
                                <div class="color-option" style="background: #764ba2;" onclick="selectColor('#764ba2')"></div>
                                <div class="color-option" style="background: #10b981;" onclick="selectColor('#10b981')"></div>
                                <div class="color-option" style="background: #f59e0b;" onclick="selectColor('#f59e0b')"></div>
                                <div class="color-option" style="background: #ef4444;" onclick="selectColor('#ef4444')"></div>
                                <div class="color-option" style="background: #8b5cf6;" onclick="selectColor('#8b5cf6')"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Bot Size</label>
                            <select class="form-select">
                                <option>Small (300px)</option>
                                <option selected>Medium (350px)</option>
                                <option>Large (400px)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Position</label>
                            <select class="form-select">
                                <option>Bottom Left</option>
                                <option selected>Bottom Right</option>
                                <option>Top Left</option>
                                <option>Top Right</option>
                            </select>
                        </div>
                    `;
                    break;
            }
        }

        function updateBotProperty(property, value) {
            currentBot[property] = value;
            updatePreview();
            updateBotName();
            showNotification(`Updated ${property}`, 'success');
        }

        function updateQuickAction(index, value) {
            currentBot.quickActions[index] = value;
            showNotification('Quick action updated', 'success');
        }

        function addQuickAction() {
            currentBot.quickActions.push('New Action');
            loadQuickActionContent('messages');
            showNotification('Quick action added', 'success');
        }

        function removeQuickAction(index) {
            currentBot.quickActions.splice(index, 1);
            loadQuickActionContent('messages');
            showNotification('Quick action removed', 'success');
        }

        function updateResponse(key, value) {
            currentBot.responses[key] = value;
            showNotification('Response updated', 'success');
        }

        function selectColor(color) {
            document.querySelectorAll('.color-option').forEach(el => el.classList.remove('selected'));
            event.target.classList.add('selected');
            currentBot.style.primaryColor = color;
            document.documentElement.style.setProperty('--primary', color);
            showNotification('Color updated', 'success');
        }

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Load tab-specific content
            if (tabName === 'settings') {
                loadBotSettings();
            }
        }

        function loadBotSettings() {
            const settings = document.getElementById('botSettings');
            settings.innerHTML = `
                <div style="max-width: 600px;">
                    <div class="form-group">
                        <label class="form-label">Bot Configuration</label>
                        <textarea class="form-textarea" style="min-height: 200px; font-family: monospace;" readonly>${JSON.stringify(currentBot, null, 2)}</textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Deployment Settings</label>
                        <div style="display: flex; flex-direction: column; gap: 1rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" checked> Enable analytics
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" checked> Allow file uploads
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox"> Require user registration
                            </label>
                        </div>
                    </div>
                </div>
            `;
        }

        function setupDragAndDrop() {
            // This would set up the visual flow builder drag and drop functionality
            console.log('Drag and drop initialized');
        }

        function addNode(type) {
            const node = {
                id: Date.now(),
                type: type,
                x: Math.random() * 300 + 100,
                y: Math.random() * 200 + 100,
                content: `New ${type}`
            };
            
            currentBot.nodes.push(node);
            renderNode(node);
            showNotification(`${type} node added`, 'success');
        }

        function renderNode(node) {
            const canvas = document.getElementById('visual-tab');
            const nodeElement = document.createElement('div');
            nodeElement.className = 'flow-node';
            nodeElement.style.position = 'absolute';
            nodeElement.style.left = node.x + 'px';
            nodeElement.style.top = node.y + 'px';
            nodeElement.innerHTML = `
                <div class="node-header">
                    <div class="node-icon">
                        <i class="fas fa-${getNodeIcon(node.type)}"></i>
                    </div>
                    <div class="node-title">${node.content}</div>
                </div>
                <div class="node-content">
                    Click to edit
                </div>
            `;
            
            nodeElement.onclick = () => selectNode(node);
            canvas.appendChild(nodeElement);
        }

        function getNodeIcon(type) {
            const icons = {
                message: 'comment',
                question: 'question',
                action: 'cog',
                condition: 'code-branch'
            };
            return icons[type] || 'circle';
        }

        function selectNode(node) {
            selectedNode = node;
            document.querySelectorAll('.flow-node').forEach(el => el.classList.remove('selected'));
            event.target.closest('.flow-node').classList.add('selected');
            
            // Load node properties
            const content = document.getElementById('propertiesContent');
            content.innerHTML = `
                <div class="form-group">
                    <label class="form-label">Node Type</label>
                    <select class="form-select" value="${node.type}">
                        <option value="message">Message</option>
                        <option value="question">Question</option>
                        <option value="action">Action</option>
                        <option value="condition">Condition</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Content</label>
                    <textarea class="form-textarea" onchange="updateNodeContent(this.value)">${node.content}</textarea>
                </div>
            `;
        }

        function updateNodeContent(value) {
            if (selectedNode) {
                selectedNode.content = value;
                showNotification('Node updated', 'success');
            }
        }

        function loadTemplate(templateType) {
            const templates = {
                welcome: {
                    nodes: [
                        { id: 1, type: 'message', content: 'Welcome!', x: 100, y: 100 },
                        { id: 2, type: 'question', content: 'How can I help?', x: 300, y: 100 }
                    ]
                },
                support: {
                    nodes: [
                        { id: 1, type: 'message', content: 'Support available', x: 100, y: 100 },
                        { id: 2, type: 'action', content: 'Create ticket', x: 300, y: 100 }
                    ]
                },
                sales: {
                    nodes: [
                        { id: 1, type: 'message', content: 'Interested in our products?', x: 100, y: 100 },
                        { id: 2, type: 'question', content: 'What\'s your budget?', x: 300, y: 100 }
                    ]
                }
            };
            
            const template = templates[templateType];
            if (template) {
                currentBot.nodes = template.nodes;
                
                // Clear and re-render canvas
                const canvas = document.getElementById('visual-tab');
                canvas.innerHTML = '';
                template.nodes.forEach(renderNode);
                
                showNotification(`${templateType} template loaded`, 'success');
            }
        }

        function testBot() {
            const preview = document.getElementById('botPreview');
            preview.style.display = 'flex';
            preview.classList.remove('minimized');
            
            const messages = document.getElementById('previewMessages');
            messages.innerHTML = `
                <div class="message bot">
                    ${currentBot.welcome}
                </div>
                <div style="margin-top: 1rem;">
                    ${currentBot.quickActions.map(action => `
                        <button class="quick-action" onclick="sendQuickMessage('${action}')">
                            ${action}
                        </button>
                    `).join('')}
                </div>
            `;
            
            showNotification('Test mode activated', 'info');
        }

        function sendPreviewMessage() {
            const input = document.getElementById('previewInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            const messages = document.getElementById('previewMessages');
            
            // Add user message
            const userMsg = document.createElement('div');
            userMsg.className = 'message user';
            userMsg.textContent = message;
            messages.appendChild(userMsg);
            
            // Add bot response
            setTimeout(() => {
                const botMsg = document.createElement('div');
                botMsg.className = 'message bot';
                botMsg.textContent = getBotResponse(message);
                messages.appendChild(botMsg);
                messages.scrollTop = messages.scrollHeight;
            }, 500);
            
            input.value = '';
            messages.scrollTop = messages.scrollHeight;
        }

        function sendQuickMessage(action) {
            const messages = document.getElementById('previewMessages');
            
            // Add user message
            const userMsg = document.createElement('div');
            userMsg.className = 'message user';
            userMsg.textContent = action;
            messages.appendChild(userMsg);
            
            // Add bot response
            setTimeout(() => {
                const botMsg = document.createElement('div');
                botMsg.className = 'message bot';
                const responseKey = action.toLowerCase().replace(/\s+/g, '');
                botMsg.textContent = currentBot.responses[responseKey] || "I'll help you with that!";
                messages.appendChild(botMsg);
                messages.scrollTop = messages.scrollHeight;
            }, 500);
            
            messages.scrollTop = messages.scrollHeight;
        }

        function getBotResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            for (const [key, response] of Object.entries(currentBot.responses)) {
                if (lowerMessage.includes(key)) {
                    return response;
                }
            }
            
            return "Thank you for your message! How else can I help you?";
        }

        function togglePreview() {
            const preview = document.getElementById('botPreview');
            const toggle = document.getElementById('previewToggle');
            
            if (preview.classList.contains('minimized')) {
                preview.classList.remove('minimized');
                toggle.className = 'fas fa-minimize';
            } else {
                preview.classList.add('minimized');
                toggle.className = 'fas fa-maximize';
            }
        }

        function saveBot() {
            // Save bot configuration
            localStorage.setItem('botflo_bot_' + currentBot.type, JSON.stringify(currentBot));
            showNotification('Bot saved successfully!', 'success');
        }

        function exportBot() {
            // Generate bot code
            const botCode = generateBotCode(currentBot);
            
            // Create and download file
            const blob = new Blob([botCode], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentBot.name.toLowerCase().replace(/\s+/g, '-')}-bot.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Bot exported successfully!', 'success');
        }

        function generateBotCode(bot) {
            return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${bot.name}</title>
    <style>
        /* Bot styles */
        .chatbot-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            z-index: 10000;
        }
        .bot-header {
            background: linear-gradient(135deg, ${bot.style.primaryColor}, ${bot.style.accentColor});
            color: white;
            padding: 15px;
            border-radius: 15px 15px 0 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .bot-icon {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        .bot-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #f9fafb;
        }
        .message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 15px;
            max-width: 80%;
        }
        .message.bot {
            background: ${bot.style.primaryColor};
            color: white;
        }
        .message.user {
            background: white;
            color: #374151;
            margin-left: auto;
            border: 1px solid #e5e7eb;
        }
        .bot-input {
            padding: 15px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 10px;
        }
        .bot-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #e5e7eb;
            border-radius: 20px;
            outline: none;
        }
        .bot-input button {
            background: ${bot.style.primaryColor};
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
        }
        .quick-actions {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        .quick-action {
            padding: 5px 10px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="chatbot-widget">
        <div class="bot-header">
            <div class="bot-icon">${bot.icon}</div>
            <div>
                <div style="font-weight: 600;">${bot.name}</div>
                <div style="font-size: 12px; opacity: 0.9;">Online ‚Ä¢ Powered by BotFlo.ai</div>
            </div>
        </div>
        <div class="bot-messages" id="messages">
            <div class="message bot">
                ${bot.welcome}
            </div>
            <div class="quick-actions">
                ${bot.quickActions.map(action => `
                    <div class="quick-action" onclick="sendMessage('${action}')">${action}</div>
                `).join('')}
            </div>
        </div>
        <div class="bot-input">
            <input type="text" placeholder="Type a message..." id="userInput" onkeypress="if(event.key==='Enter') sendUserMessage()">
            <button onclick="sendUserMessage()">‚ñ∂</button>
        </div>
    </div>

    <script>
        const botResponses = ${JSON.stringify(bot.responses)};
        
        function sendMessage(message) {
            addMessage(message, 'user');
            setTimeout(() => {
                const response = getBotResponse(message);
                addMessage(response, 'bot');
            }, 500);
        }
        
        function sendUserMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            if (message) {
                sendMessage(message);
                input.value = '';
            }
        }
        
        function addMessage(text, sender) {
            const messages = document.getElementById('messages');
            const div = document.createElement('div');
            div.className = 'message ' + sender;
            div.textContent = text;
            messages.appendChild(div);
            messages.scrollTop = messages.scrollHeight;
        }
        
        function getBotResponse(message) {
            const lowerMessage = message.toLowerCase();
            for (const [key, response] of Object.entries(botResponses)) {
                if (lowerMessage.includes(key)) {
                    return response;
                }
            }
            return "Thank you for your message! How else can I help you?";
        }
    </script>
</body>
</html>`;
        }

        function goBack() {
            window.location.href = '/botflo-marketplace.html';
        }

        function showNotification(message, type = 'success') {
            // Remove existing notifications
            document.querySelectorAll('.notification').forEach(n => n.remove());
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Initialize default content
        document.addEventListener('DOMContentLoaded', function() {
            loadQuickActionContent('basic');
        });

        // ===== ADVANCED FEATURES =====

        // AI Functions
        function toggleAI(enabled) {
            currentBot.settings.aiEnabled = enabled;
            showNotification(enabled ? 'AI enabled' : 'AI disabled', 'success');
            updateAnalytics();
        }

        function toggleNLP(enabled) {
            currentBot.settings.enableNLP = enabled;
            showNotification(enabled ? 'NLP enabled' : 'NLP disabled', 'success');
        }

        function toggleSentiment(enabled) {
            currentBot.settings.sentimentAnalysis = enabled;
            showNotification(enabled ? 'Sentiment analysis enabled' : 'Sentiment analysis disabled', 'success');
        }

        function trainBot() {
            const modal = document.getElementById('aiTrainingModal');
            modal.classList.add('active');
        }

        function startTraining() {
            const progressBar = document.getElementById('trainingProgressBar');
            const statusText = document.getElementById('trainingStatusText');
            const log = document.getElementById('trainingLog');
            
            let progress = 0;
            statusText.textContent = 'Training in progress...';
            log.innerHTML = 'Starting AI training...\n';
            
            const interval = setInterval(() => {
                progress += Math.random() * 10;
                progressBar.style.width = Math.min(progress, 100) + '%';
                
                if (progress >= 100) {
                    clearInterval(interval);
                    statusText.textContent = 'Training completed!';
                    log.innerHTML += 'Training completed successfully!\nModel accuracy: 94.2%\nReady for deployment.';
                    showNotification('AI training completed!', 'success');
                }
            }, 500);
        }

        function resetTraining() {
            document.getElementById('trainingProgressBar').style.width = '0%';
            document.getElementById('trainingStatusText').textContent = 'Ready to train';
            document.getElementById('trainingLog').innerHTML = 'Waiting for training to start...';
        }

        // Integration Functions
        function openIntegrationModal(type) {
            const modal = document.getElementById('integrationModal');
            const title = document.getElementById('integrationModalTitle');
            const content = document.getElementById('integrationModalContent');
            
            title.textContent = `${type.charAt(0).toUpperCase() + type.slice(1)} Integration`;
            
            let modalContent = '';
            switch(type) {
                case 'slack':
                    modalContent = `
                        <div class="integration-form">
                            <div class="form-group">
                                <label class="form-label">Webhook URL</label>
                                <input type="url" class="form-input" placeholder="https://hooks.slack.com/services/..." value="${currentBot.integrations.slack.webhook}">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Channel</label>
                                <input type="text" class="form-input" placeholder="#general" value="${currentBot.integrations.slack.channel}">
                            </div>
                            <button class="btn btn-primary" onclick="saveIntegration('slack')">Save Integration</button>
                        </div>
                    `;
                    break;
                case 'email':
                    modalContent = `
                        <div class="integration-form">
                            <div class="form-group">
                                <label class="form-label">SMTP Server</label>
                                <input type="text" class="form-input" placeholder="smtp.gmail.com" value="${currentBot.integrations.email.smtp}">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Notification Email</label>
                                <input type="email" class="form-input" placeholder="admin@company.com">
                            </div>
                            <button class="btn btn-primary" onclick="saveIntegration('email')">Save Integration</button>
                        </div>
                    `;
                    break;
                case 'webhook':
                    modalContent = `
                        <div class="integration-form">
                            <div class="form-group">
                                <label class="form-label">Webhook URL</label>
                                <input type="url" class="form-input" placeholder="https://api.yoursite.com/webhook" value="${currentBot.integrations.webhook.url}">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Method</label>
                                <select class="form-select">
                                    <option value="POST">POST</option>
                                    <option value="PUT">PUT</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" onclick="saveIntegration('webhook')">Save Integration</button>
                        </div>
                    `;
                    break;
                case 'analytics':
                    modalContent = `
                        <div class="integration-form">
                            <div class="form-group">
                                <label class="form-label">Google Analytics ID</label>
                                <input type="text" class="form-input" placeholder="GA-XXXXX-X" value="${currentBot.integrations.analytics.trackingId}">
                            </div>
                            <label class="checkbox-label">
                                <input type="checkbox" ${currentBot.integrations.analytics.enabled ? 'checked' : ''}>
                                <span>Enable Analytics Tracking</span>
                            </label>
                            <button class="btn btn-primary" onclick="saveIntegration('analytics')">Save Integration</button>
                        </div>
                    `;
                    break;
            }
            
            content.innerHTML = modalContent;
            modal.classList.add('active');
        }

        function saveIntegration(type) {
            showNotification(`${type} integration saved!`, 'success');
            closeIntegrationModal();
        }

        function closeIntegrationModal() {
            document.getElementById('integrationModal').classList.remove('active');
        }

        function toggleIntegration(type, enabled) {
            currentBot.integrations[type].enabled = enabled;
            showNotification(`${type} integration ${enabled ? 'enabled' : 'disabled'}`, 'success');
        }

        // Analytics Functions
        function refreshAnalytics() {
            // Simulate analytics data
            currentBot.analytics.totalConversations = Math.floor(Math.random() * 1000) + 100;
            currentBot.analytics.avgSessionLength = Math.floor(Math.random() * 10) + 2;
            currentBot.analytics.userSatisfaction = Math.floor(Math.random() * 30) + 70;
            
            updateAnalyticsDisplay();
            showNotification('Analytics refreshed', 'success');
        }

        function updateAnalyticsDisplay() {
            // Update sidebar analytics
            document.getElementById('totalConversations').textContent = currentBot.analytics.totalConversations;
            document.getElementById('avgSession').textContent = currentBot.analytics.avgSessionLength + 'm';
            document.getElementById('satisfaction').textContent = currentBot.analytics.userSatisfaction + '%';
            
            // Update tab analytics if visible
            const analyticsConversations = document.getElementById('analyticsConversations');
            if (analyticsConversations) {
                analyticsConversations.textContent = currentBot.analytics.totalConversations;
                document.getElementById('analyticsSessionLength').textContent = currentBot.analytics.avgSessionLength + 'm';
                document.getElementById('analyticsSuccessRate').textContent = Math.floor(Math.random() * 20) + 80 + '%';
                document.getElementById('analyticsSatisfaction').textContent = currentBot.analytics.userSatisfaction + '%';
            }
        }

        function viewDetailedAnalytics() {
            const modal = document.getElementById('analyticsModal');
            modal.classList.add('active');
            updateAnalyticsDisplay();
        }

        function exportAnalytics() {
            const data = {
                botName: currentBot.name,
                analytics: currentBot.analytics,
                exportedAt: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentBot.name}-analytics.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('Analytics exported', 'success');
        }

        // Testing & Deployment Functions
        function validateBot() {
            const results = document.getElementById('testResults');
            const output = document.getElementById('testOutput');
            
            results.style.display = 'block';
            
            let validationHTML = '';
            const validations = [
                { test: 'Bot name configured', passed: currentBot.name !== 'Custom Bot' },
                { test: 'Welcome message set', passed: currentBot.welcome.length > 10 },
                { test: 'Quick actions configured', passed: currentBot.quickActions.length > 0 },
                { test: 'Responses configured', passed: Object.keys(currentBot.responses).length > 0 },
                { test: 'Visual nodes present', passed: currentBot.nodes.length > 0 }
            ];
            
            validations.forEach(validation => {
                const className = validation.passed ? 'success' : 'error';
                const icon = validation.passed ? 'check' : 'times';
                validationHTML += `
                    <div class="test-result ${className}">
                        <i class="fas fa-${icon}"></i> ${validation.test}
                    </div>
                `;
            });
            
            output.innerHTML = validationHTML;
            showNotification('Bot validation completed', 'info');
        }

        function deployBot() {
            const environment = document.getElementById('deployEnvironment').value;
            showNotification(`Deploying to ${environment}...`, 'info');
            
            setTimeout(() => {
                showNotification(`Bot deployed to ${environment} successfully!`, 'success');
                updateAnalytics();
            }, 3000);
        }

        function generateEmbedCode() {
            const embedCode = `
<!-- BotFlo.ai Chat Widget -->
<div id="botflo-widget"></div>
<script>
  (function() {
    var script = document.createElement('script');
    script.src = 'https://cdn.botflo.ai/widget.js';
    script.async = true;
    script.onload = function() {
      BotFlo.init({
        botId: '${currentBot.type}-${Date.now()}',
        name: '${currentBot.name}',
        welcome: '${currentBot.welcome}',
        style: ${JSON.stringify(currentBot.style)}
      });
    };
    document.head.appendChild(script);
  })();
</script>`;
            
            const modal = document.getElementById('embedModal');
            document.getElementById('embedCode').textContent = embedCode.trim();
            modal.classList.add('active');
        }

        function copyEmbedCode() {
            const embedCode = document.getElementById('embedCode').textContent;
            navigator.clipboard.writeText(embedCode).then(() => {
                showNotification('Embed code copied to clipboard!', 'success');
            });
        }

        function previewBot() {
            testBot();
        }

        // Import/Export Functions
        function exportBot() {
            const botData = {
                ...currentBot,
                exportedAt: new Date().toISOString(),
                version: '1.0'
            };
            
            const blob = new Blob([JSON.stringify(botData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentBot.name.replace(/\s+/g, '-').toLowerCase()}-bot.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('Bot configuration exported!', 'success');
        }

        function importBot() {
            document.getElementById('importFile').click();
        }

        function handleBotImport(input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedBot = JSON.parse(e.target.result);
                    
                    // Validate imported data
                    if (importedBot.name && importedBot.welcome && importedBot.responses) {
                        currentBot = { ...currentBot, ...importedBot };
                        updatePreview();
                        updateBotName();
                        updateAnalyticsDisplay();
                        showNotification('Bot imported successfully!', 'success');
                    } else {
                        showNotification('Invalid bot file format', 'error');
                    }
                } catch (error) {
                    showNotification('Error importing bot file', 'error');
                }
            };
            reader.readAsText(file);
        }

        // Enhanced Node Functions
        function addNode(type) {
            const node = {
                id: 'node_' + Date.now(),
                type: type,
                x: Math.random() * 300 + 100,
                y: Math.random() * 200 + 100,
                content: getDefaultNodeContent(type),
                config: getDefaultNodeConfig(type)
            };
            
            currentBot.nodes.push(node);
            renderNode(node);
            showNotification(`${type} node added`, 'success');
        }

        function getDefaultNodeContent(type) {
            const defaults = {
                message: 'New message',
                question: 'Ask a question',
                action: 'Perform action',
                condition: 'Check condition',
                ai: 'AI-powered response',
                webhook: 'Call webhook'
            };
            return defaults[type] || 'New node';
        }

        function getDefaultNodeConfig(type) {
            const configs = {
                ai: { model: 'gpt-3.5-turbo', temperature: 0.7 },
                webhook: { url: '', method: 'POST', headers: {} },
                condition: { operator: 'equals', value: '' }
            };
            return configs[type] || {};
        }

        // Enhanced Tab Switching
        function switchTab(tabName) {
            // Remove active class from all tabs and content
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.style.display = 'none');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Show corresponding content
            const tabContent = document.getElementById(tabName + '-tab');
            if (tabContent) {
                tabContent.style.display = 'block';
                
                // Initialize tab-specific content
                initializeTabContent(tabName);
            }
        }

        function initializeTabContent(tabName) {
            switch(tabName) {
                case 'analytics':
                    updateAnalyticsDisplay();
                    break;
                case 'integrations':
                    loadIntegrationsState();
                    break;
                case 'settings':
                    loadBotSettings();
                    break;
            }
        }

        function loadIntegrationsState() {
            // Update integration checkboxes based on current state
            const slackEnabled = document.getElementById('slackEnabled');
            const emailEnabled = document.getElementById('emailEnabled');
            const webhookEnabled = document.getElementById('webhookEnabled');
            
            if (slackEnabled) slackEnabled.checked = currentBot.integrations.slack.enabled;
            if (emailEnabled) emailEnabled.checked = currentBot.integrations.email.enabled;
            if (webhookEnabled) webhookEnabled.checked = currentBot.integrations.webhook.enabled;
        }

        // Modal Management
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Initialize analytics on load
        function updateAnalytics() {
            updateAnalyticsDisplay();
        }

        // Auto-save functionality
        setInterval(() => {
            if (currentBot.settings.autoSave) {
                localStorage.setItem('botflo_current_bot', JSON.stringify(currentBot));
            }
        }, 30000); // Auto-save every 30 seconds

        // Load saved bot on startup
        function loadSavedBot() {
            const saved = localStorage.getItem('botflo_current_bot');
            if (saved) {
                try {
                    const savedBot = JSON.parse(saved);
                    currentBot = { ...currentBot, ...savedBot };
                    updatePreview();
                    updateBotName();
                    updateAnalyticsDisplay();
                } catch (error) {
                    console.warn('Could not load saved bot:', error);
                }
            }
        }

        // Initialize enhanced features
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedBot();
            updateAnalyticsDisplay();
            
            // Simulate some initial analytics data
            if (currentBot.analytics.totalConversations === 0) {
                setTimeout(() => {
                    refreshAnalytics();
                }, 2000);
            }
        });
    </script>
</body>
</html>
