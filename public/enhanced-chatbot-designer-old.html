<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Surprise Granite Chatbot Designer</title>
    <!-- Comprehensive Icon Libraries -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Round|Material+Icons+Sharp|Material+Icons+Two+Tone&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/feather-icons@4.29.0/dist/feather.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.css" rel="stylesheet">
    
    <!-- Advanced Google Fonts Collection -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,300;1,400;1,500;1,600;1,700;1,800&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Nunito:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Source+Sans+Pro:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700;1,900&family=Work+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;0,800;0,900;1,400;1,500;1,600;1,700;1,800;1,900&family=Oswald:wght@200;300;400;500;600;700&family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    
    <!-- Animation & Effects Libraries -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/hover.css/2.3.1/css/hover-min.css" rel="stylesheet">
    
    <!-- Additional UI Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Top Menu Bar */
        .top-menu {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: #2c3e50;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: 600;
        }

        .menu-actions {
            display: flex;
            gap: 15px;
        }

        .menu-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .menu-btn:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }

        .menu-btn.secondary {
            background: #95a5a6;
        }

        .menu-btn.secondary:hover {
            background: #7f8c8d;
        }

        .menu-btn.danger {
            background: #e74c3c;
        }

        .menu-btn.danger:hover {
            background: #c0392b;
        }

        .controls {
            width: 420px;
            background: white;
            padding: 20px;
            overflow-y: auto;
            border-right: 1px solid #ddd;
            height: calc(100vh - 60px);
            margin-top: 60px;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 100;
        }

        .workspace {
            flex: 1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
            overflow: hidden;
            margin-top: 60px;
            margin-left: 420px; /* Make room for fixed controls sidebar */
        }



        .chatbot-preview {
            background: white;
            border-radius: 15px;
            padding: 0;
            margin-top: 15px;
            height: 400px;
            color: #333;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .chatbot-preview .chat-container {
            height: 100%;
            border-radius: 15px;
            overflow: hidden;
        }

        /* Draggable Chatbot Modal */
        .chatbot-modal {
            display: none !important;
        }

        .chatbot-modal:hover {
            border-color: #3498db;
            box-shadow: 0 25px 80px rgba(0,0,0,0.2);
        }

        .chatbot-modal.dragging {
            cursor: grabbing;
            transform: scale(1.02);
            z-index: 200;
            box-shadow: 0 30px 100px rgba(0,0,0,0.3);
            border-color: #f1c40f;
        }

        .chatbot-modal.minimized {
            height: 50px;
            overflow: hidden;
        }

        .chatbot-modal.maximized {
            width: 90vw !important;
            height: 80vh !important;
            top: 10vh !important;
            left: 5vw !important;
            transform: none !important;
        }

        .modal-drag-handle {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            color: white;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: move;
            font-size: 12px;
            font-weight: 600;
            border-radius: 20px 20px 0 0;
            z-index: 10;
        }

        .modal-drag-handle:hover {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }

        .modal-title {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .modal-controls {
            display: flex;
            gap: 6px;
        }

        .modal-control-btn {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .modal-control-btn:hover {
            transform: scale(1.2);
        }

        .modal-control-btn.close { 
            background: #e74c3c; 
        }
        .modal-control-btn.close:hover { 
            background: #c0392b; 
        }

        .modal-control-btn.minimize { 
            background: #f39c12; 
        }
        .modal-control-btn.minimize:hover { 
            background: #e67e22; 
        }

        .modal-control-btn.maximize { 
            background: #27ae60; 
        }
        .modal-control-btn.maximize:hover { 
            background: #229954; 
        }

        /* Resize Handles */
        .resize-handle {
            position: absolute;
            background: transparent;
        }

        .resize-handle.se {
            bottom: 0;
            right: 0;
            width: 20px;
            height: 20px;
            cursor: se-resize;
        }

        .resize-handle.se::after {
            content: '';
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 16px;
            height: 16px;
            background: linear-gradient(135deg, transparent 40%, #bdc3c7 50%, transparent 60%);
        }

        /* Grid and Snap Features */
        .workspace.show-grid {
            background-image: 
                linear-gradient(rgba(0,0,0,0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,0,0,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .snap-indicator {
            position: absolute;
            border: 2px dashed #3498db;
            background: rgba(52, 152, 219, 0.1);
            display: none;
            pointer-events: none;
            z-index: 50;
        }

        /* Advanced Position Controls */
        .position-controls {
            position: fixed;
            top: 70px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            z-index: 500;
            display: none;
        }

        .position-controls.show {
            display: block;
        }

        .position-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .position-btn {
            width: 40px;
            height: 40px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .position-btn:hover {
            border-color: #3498db;
            background: #f8f9fa;
        }

        .position-btn.active {
            border-color: #3498db;
            background: #3498db;
            color: white;
        }

        /* Code Modal */
        .code-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .code-modal.show {
            display: flex;
        }

        .code-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .code-header {
            background: #2c3e50;
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .code-tabs {
            display: flex;
            background: #34495e;
            overflow-x: auto;
        }

        .code-tab {
            padding: 10px 20px;
            background: #34495e;
            color: white;
            border: none;
            cursor: pointer;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .code-tab.active {
            background: #3498db;
            border-bottom-color: #f1c40f;
        }

        .code-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .code-snippet {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.5;
            overflow-x: auto;
            position: relative;
            margin-bottom: 15px;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #3498db;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .copy-btn:hover {
            background: #2980b9;
        }

        .snippet-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .snippet-description {
            color: #7f8c8d;
            margin-bottom: 15px;
            font-size: 14px;
        }

        /* Script Editor Styles */
        #scriptEditor {
            width: 100%;
            height: 400px;
            background: #2c3e50;
            color: #ecf0f1;
            border: none;
            padding: 20px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: none;
            outline: none;
            border-radius: 8px;
        }

        /* API Configuration Styles */
        .api-config-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .api-config-section h4 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 16px;
        }

        /* Notification Styles */
        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            background: #3498db;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            z-index: 2000;
            display: none;
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Enhanced Control Styles */
        .control-item input[type="range"] + span {
            min-width: 50px;
            text-align: center;
            font-weight: 600;
            color: #3498db;
        }

        .control-group {
            margin-bottom: 15px;
            background: #f9f9f9;
            border-radius: 8px;
            overflow: hidden;
        }

        .control-group h3 {
            margin: 0;
            color: #1f4e79;
            font-size: 16px;
            padding: 12px 15px;
            background: #f0f0f0;
            cursor: pointer;
            user-select: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s ease;
        }

        .control-group h3:hover {
            background: #e8e8e8;
        }

        .control-group h3::after {
            content: 'â–¼';
            font-size: 12px;
            transition: transform 0.2s ease;
        }

        .control-group.collapsed h3::after {
            transform: rotate(-90deg);
        }

        .control-content {
            padding: 15px;
            transition: max-height 0.3s ease, padding 0.3s ease;
            max-height: 1000px;
            overflow: hidden;
        }

        .control-group.collapsed .control-content {
            max-height: 0;
            padding: 0 15px;
        }

        .control-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .control-item label {
            font-size: 14px;
            color: #555;
        }

        input[type="color"] {
            width: 40px;
            height: 30px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        input[type="range"] {
            width: 120px;
        }

        input[type="number"], select {
            width: 80px;
            padding: 4px 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #1f4e79;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .preset-btn {
            padding: 10px 14px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s ease;
            text-align: center;
        }

        .preset-btn:hover {
            background: #f0f0f0;
            border-color: #ccc;
            transform: translateY(-1px);
        }

        .action-buttons {
            position: fixed;
            bottom: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .action-btn {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            color: white;
        }

        .save-btn { background: #10b981; }
        .export-btn { background: #3b82f6; }
        .reset-btn { background: #ef4444; }

        /* Chatbot Styles */
        .chat-container {
            background: var(--container-bg, white);
            border-radius: 0 0 var(--container-radius, 20px) var(--container-radius, 20px);
            overflow: hidden;
            width: 100%;
            height: calc(100% - 40px);
            display: flex;
            flex-direction: column;
            border: var(--container-border, none);
            font-family: var(--font-family, 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif);
            letter-spacing: var(--letter-spacing, 0px);
            transition: all 0.3s ease;
            position: relative;
        }

        .chat-container.glow {
            box-shadow: var(--container-shadow, 0 20px 60px rgba(0,0,0,0.15)), 0 0 30px var(--header-color, #1f4e79);
        }

        .chat-header {
            background: var(--header-color, #1f4e79);
            color: var(--header-text-color, white);
            padding: var(--header-padding, 20px);
            display: flex;
            align-items: center;
            gap: 15px;
            border-radius: var(--header-radius, 0);
            justify-content: var(--header-alignment, flex-start);
            line-height: var(--header-line-height, 1.2);
            position: relative;
        }

        .chat-header.gradient {
            background: linear-gradient(var(--gradient-direction, 45deg), var(--header-color, #1f4e79), var(--header-gradient-end, #34495e));
        }

        .avatar {
            width: var(--avatar-size, 50px);
            height: var(--avatar-size, 50px);
            border-radius: var(--avatar-radius, 50%);
            background: var(--avatar-color, #f1c40f);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--avatar-font-size, 20px);
            font-weight: bold;
            color: var(--avatar-text-color, #1f4e79);
            border: var(--avatar-border, none);
            margin: var(--avatar-margin, 0px);
        }

        .header-info h3 {
            margin: 0;
            font-size: var(--header-font-size, 18px);
            font-weight: var(--header-font-weight, 600);
            text-transform: var(--header-transform, none);
            text-shadow: var(--text-shadow, none);
        }

        .header-info p {
            margin: 0;
            font-size: var(--header-subtitle-size, 14px);
            opacity: var(--header-subtitle-opacity, 0.9);
        }

        .status-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            width: var(--status-size, 12px);
            height: var(--status-size, 12px);
            background: var(--status-color, #10b981);
            border-radius: 50%;
            animation: var(--status-animation, pulse 2s infinite);
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }

        .chat-messages {
            flex: 1;
            padding: var(--messages-padding, 20px);
            overflow-y: auto;
            background: var(--messages-bg, #f8f9fa);
            display: flex;
            flex-direction: column;
            gap: var(--messages-gap, 15px);
            scroll-behavior: var(--scroll-behavior, auto);
        }

        .message {
            display: flex;
            align-items: var(--avatar-position, flex-start);
            gap: var(--message-gap, 10px);
            animation: var(--message-animation, slideIn 0.3s ease-out);
            margin-bottom: var(--message-margin-bottom, 10px);
        }

        .message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: var(--message-avatar-size, 35px);
            height: var(--message-avatar-size, 35px);
            border-radius: var(--message-avatar-radius, 50%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--message-avatar-font, 14px);
            font-weight: bold;
            flex-shrink: 0;
        }

        .bot-avatar {
            background: var(--bot-avatar-bg, var(--header-color, #1f4e79));
            color: var(--bot-avatar-text, white);
        }

        .user-avatar {
            background: var(--user-avatar-bg, var(--avatar-color, #f1c40f));
            color: var(--user-avatar-text, #1f4e79);
        }

        .message-content {
            max-width: var(--message-max-width, 80%);
            padding: var(--message-padding, 12px) var(--message-padding-h, 16px);
            border-radius: var(--message-radius, 18px);
            font-size: var(--message-font-size, 14px);
            line-height: var(--message-line-height, 1.5);
            font-weight: var(--message-font-weight, 400);
        }

        .message-content.with-shadow {
            box-shadow: 0 var(--message-shadow-intensity, 3px) calc(var(--message-shadow-intensity, 3px) * 2) rgba(0,0,0,0.1);
        }

        .bot-message {
            background: var(--bot-message-color, white);
            color: var(--bot-message-text, #333);
            border-bottom-left-radius: var(--bot-message-corner, 6px);
            border: var(--bot-message-border, none);
        }

        .user-message {
            background: var(--user-message-color, #1f4e79);
            color: var(--user-message-text, white);
            border-bottom-right-radius: var(--user-message-corner, 6px);
            border: var(--user-message-border, none);
        }

        .chat-input {
            padding: var(--input-container-padding, 20px);
            background: var(--input-container-bg, white);
            border-top: var(--input-container-border, 1px solid #e0e0e0);
            display: flex;
            gap: var(--input-gap, 10px);
            align-items: flex-end;
            border-radius: var(--input-container-radius, 0);
        }

        .input-field {
            flex: 1;
            padding: var(--input-padding, 12px) var(--input-padding-h, 16px);
            border: var(--input-border, 2px solid #e0e0e0);
            border-radius: var(--input-radius, 25px);
            font-size: var(--input-font-size, 14px);
            line-height: var(--input-line-height, 1.4);
            resize: none;
            outline: none;
            min-height: var(--input-height, 45px);
            font-family: inherit;
            vertical-align: top;
            background: var(--input-bg, white);
            color: var(--input-text-color, #333);
            font-weight: var(--input-font-weight, 400);
            transition: all 0.3s ease;
        }

        .input-field:focus {
            border-color: var(--input-focus-color, #1f4e79);
            box-shadow: var(--input-focus-shadow, 0 0 0 3px rgba(31, 78, 121, 0.1));
        }

        .input-field::placeholder {
            color: var(--input-placeholder-color, #999);
            font-style: var(--input-placeholder-style, normal);
        }

        .send-btn {
            width: var(--send-btn-size, 45px);
            height: var(--send-btn-size, 45px);
            border: var(--send-btn-border, none);
            border-radius: var(--send-btn-radius, 50%);
            background: var(--send-btn-color, #f1c40f);
            color: var(--send-btn-text, #1f4e79);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--send-btn-icon-size, 16px);
            flex-shrink: 0;
            transition: var(--send-btn-transition, all 0.3s ease);
        }

        .send-btn:hover {
            transform: var(--send-btn-hover-transform, scale(1.05));
            box-shadow: var(--send-btn-hover-shadow, 0 4px 12px rgba(0,0,0,0.2));
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: #10b981;
            color: white;
            border-radius: 6px;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 10000;
        }

        .notification.show {
            transform: translateX(0);
        }

        /* Resting Chat Modal */
        .chat-modal {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: var(--modal-width, 350px);
            height: var(--modal-height, 500px);
            background: var(--container-bg, white);
            border-radius: var(--container-radius, 20px);
            box-shadow: var(--container-shadow, 0 20px 60px rgba(0,0,0,0.15));
            display: none;
            flex-direction: column;
            overflow: hidden;
            z-index: 1000;
            animation: slideUp 0.3s ease-out;
        }

        .chat-modal.active {
            display: flex;
        }

        .chat-modal.minimized {
            height: auto;
            max-height: 60px;
        }

        .chat-modal.minimized .chat-messages,
        .chat-modal.minimized .chat-input {
            display: none;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Chat Trigger Button */
        .chat-trigger {
            position: absolute;
            bottom: -30px;
            right: 20px;
            width: var(--trigger-size, 60px);
            height: var(--trigger-size, 60px);
            background: var(--trigger-color, #1f4e79);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            z-index: 10;
            color: white;
            font-size: var(--trigger-icon-size, 24px);
            border: none;
        }

        .chat-trigger:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(0,0,0,0.3);
        }

        .chat-trigger.pulse {
            animation: triggerPulse 2s infinite;
        }

        @keyframes triggerPulse {
            0% { box-shadow: 0 4px 20px rgba(0,0,0,0.2), 0 0 0 0 var(--trigger-color, #1f4e79); }
            50% { box-shadow: 0 4px 20px rgba(0,0,0,0.2), 0 0 0 10px transparent; }
            100% { box-shadow: 0 4px 20px rgba(0,0,0,0.2), 0 0 0 0 transparent; }
        }

        /* Enhanced Icons */
        .icon-selector {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            margin-top: 10px;
            max-height: 120px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 8px;
        }

        .icon-option {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s ease;
        }

        .icon-option:hover {
            background: #f0f0f0;
            border-color: #1f4e79;
        }

        .icon-option.selected {
            background: #1f4e79;
            color: white;
            border-color: #1f4e79;
        }

        /* Quick Responses */
        .quick-responses {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 10px var(--messages-padding, 20px);
            background: var(--messages-bg, #f8f9fa);
            border-top: 1px solid #e0e0e0;
            display: var(--show-quick-responses, none);
        }

        .quick-response {
            padding: 6px 12px;
            background: var(--quick-response-bg, white);
            border: 1px solid var(--quick-response-border, #ddd);
            border-radius: var(--quick-response-radius, 15px);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--quick-response-text, #333);
        }

        .quick-response:hover {
            background: var(--header-color, #1f4e79);
            color: white;
            transform: translateY(-1px);
        }

        /* Typing Indicator Enhanced */
        .typing-indicator {
            display: none;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            background: var(--bot-message-color, white);
            border-radius: 18px;
            margin-bottom: 10px;
            max-width: 80px;
            animation: var(--typing-animation, fadeInUp 0.3s ease);
        }

        .typing-indicator.show {
            display: flex;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: var(--typing-dot-color, #999);
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        /* Welcome Message */
        .welcome-message {
            position: absolute;
            bottom: 80px;
            right: 20px;
            background: var(--welcome-bg, white);
            padding: 15px 20px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            max-width: 250px;
            font-size: 14px;
            color: var(--welcome-text, #333);
            border: 1px solid #e0e0e0;
            display: var(--show-welcome, none);
            animation: fadeInRight 0.5s ease;
        }

        .welcome-message::after {
            content: '';
            position: absolute;
            bottom: -6px;
            right: 20px;
            width: 12px;
            height: 12px;
            background: var(--welcome-bg, white);
            border-right: 1px solid #e0e0e0;
            border-bottom: 1px solid #e0e0e0;
            transform: rotate(45deg);
        }

        .welcome-close {
            position: absolute;
            top: 5px;
            right: 8px;
            cursor: pointer;
            font-size: 16px;
            color: #999;
        }

        /* Sound Wave Animation */
        .sound-wave {
            display: inline-flex;
            align-items: end;
            gap: 2px;
            height: 16px;
        }

        .sound-bar {
            width: 3px;
            background: var(--sound-wave-color, #1f4e79);
            border-radius: 1px;
            animation: soundWave 1s infinite ease-in-out;
        }

        .sound-bar:nth-child(1) { animation-delay: 0s; }
        .sound-bar:nth-child(2) { animation-delay: 0.1s; }
        .sound-bar:nth-child(3) { animation-delay: 0.2s; }
        .sound-bar:nth-child(4) { animation-delay: 0.3s; }

        @keyframes soundWave {
            0%, 100% { height: 4px; }
            50% { height: 16px; }
        }

        /* Enhanced Status Indicators */
        .status-indicator.recording {
            background: #ef4444;
            animation: recordingPulse 1s infinite;
        }

        .status-indicator.processing {
            background: #f59e0b;
            animation: spin 2s linear infinite;
        }

        @keyframes recordingPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Message Reactions */
        .message-reactions {
            display: flex;
            gap: 4px;
            margin-top: 4px;
            font-size: 12px;
        }

        .reaction {
            padding: 2px 6px;
            background: rgba(0,0,0,0.05);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .reaction:hover {
            background: rgba(0,0,0,0.1);
            transform: scale(1.1);
        }

        /* Unread Message Badge */
        .unread-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            min-width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-5px); }
            60% { transform: translateY(-3px); }
        }

        /* File Upload Area */
        .file-upload-area {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin: 10px 0;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-upload-area:hover {
            border-color: var(--header-color, #1f4e79);
            background: rgba(31, 78, 121, 0.05);
        }

        .file-upload-area.dragover {
            border-color: var(--header-color, #1f4e79);
            background: rgba(31, 78, 121, 0.1);
        }

        /* Typing Indicator */
        .typing-indicator {
            display: none;
            padding: 15px 20px;
            background: #f5f5f5;
            border-radius: 18px;
            margin: 10px 0;
            max-width: 80px;
            animation: fadeIn 0.3s ease;
        }

        .typing-indicator.show {
            display: block;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #999;
            border-radius: 50%;
            animation: typingDots 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingDots {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.4;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        /* Enhanced Message Styles */
        .message.typing {
            background: transparent;
            padding: 5px 0;
        }

        .message.system {
            background: #f8f9fa;
            color: #6c757d;
            font-style: italic;
            text-align: center;
            border-radius: 15px;
            margin: 10px 0;
            padding: 8px 15px;
            font-size: 12px;
        }

        .message.error {
            background: #fee;
            color: #c33;
            border-left: 4px solid #c33;
        }

        .message.success {
            background: #efe;
            color: #373;
            border-left: 4px solid #373;
        }

        /* Floating Action Buttons */
        .floating-actions {
            position: absolute;
            bottom: 80px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .floating-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--header-color, #1f4e79);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
            opacity: 0.8;
        }

        .floating-btn:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        /* Conversation Starters */
        .conversation-starters {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0;
            padding: 0 20px;
        }

        .starter-btn {
            background: transparent;
            border: 2px solid var(--header-color, #1f4e79);
            color: var(--header-color, #1f4e79);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .starter-btn:hover {
            background: var(--header-color, #1f4e79);
            color: white;
            transform: translateY(-2px);
        }

        /* Breadcrumb Navigation */
        .chat-breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: rgba(0,0,0,0.05);
            font-size: 12px;
            color: #666;
        }

        .breadcrumb-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .breadcrumb-separator {
            color: #999;
        }

        /* Chat Feedback */
        .message-feedback {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .message:hover .message-feedback {
            opacity: 1;
        }

        .feedback-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            color: #999;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .feedback-btn:hover {
            background: rgba(0,0,0,0.05);
            color: #666;
        }

        /* Message Time Stamps */
        .message-time {
            font-size: 10px;
            color: #999;
            margin-top: 4px;
            display: none;
        }

        .message:hover .message-time {
            display: block;
        }

        /* Emoji Reactions Panel */
        .emoji-picker {
            position: absolute;
            bottom: 100%;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 12px;
            padding: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: none;
            z-index: 1000;
        }

        .emoji-picker.show {
            display: block;
            animation: fadeInUp 0.3s ease;
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
        }

        .emoji-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: background 0.2s ease;
        }

        .emoji-btn:hover {
            background: rgba(0,0,0,0.05);
        }

        /* Progressive Enhancement Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInFromBottom {
            from {
                opacity: 0;
                transform: translateY(100%);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes wobble {
            0% { transform: translateX(0%); }
            15% { transform: translateX(-25%) rotate(-5deg); }
            30% { transform: translateX(20%) rotate(3deg); }
            45% { transform: translateX(-15%) rotate(-3deg); }
            60% { transform: translateX(10%) rotate(2deg); }
            75% { transform: translateX(-5%) rotate(-1deg); }
            100% { transform: translateX(0%); }
        }

        /* Enhanced Hover Effects */
        .message:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .chat-trigger:hover {
            animation: heartbeat 1s infinite;
        }

        /* Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            .chatbot-preview {
                background: #1a1a1a;
            }
            
            .chat-modal {
                background: #2d2d2d;
                color: #e0e0e0;
            }
            
            .message.bot {
                background: #404040;
                color: #e0e0e0;
            }
            
            .message.user {
                background: var(--header-color, #1f4e79);
                color: white;
            }
            
            .typing-indicator {
                background: #404040;
            }
            
            .typing-dot {
                background: #ccc;
            }
        }

        /* Accessibility Enhancements */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus Indicators */
        .chat-input:focus,
        .send-btn:focus,
        .chat-trigger:focus {
            outline: 2px solid var(--header-color, #1f4e79);
            outline-offset: 2px;
        }

        /* High Contrast Mode */
        @media (prefers-contrast: high) {
            .message {
                border: 2px solid;
            }
            
            .chat-trigger {
                border: 3px solid;
            }
        }

        /* Reduced Motion Support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Mobile Responsiveness */
        @media (max-width: 1024px) {
            .controls {
                width: 350px;
            }
            
            .workspace {
                margin-left: 350px;
            }
            
            .top-menu .logo span {
                display: none;
            }
            
            .menu-actions {
                gap: 10px;
            }
            
            .menu-btn {
                padding: 6px 12px;
                font-size: 12px;
            }
        }

        @media (max-width: 768px) {
            #toggleControlsBtn {
                display: flex !important;
            }
            
            .controls {
                width: 100%;
                position: relative;
                left: auto;
                top: auto;
                height: auto;
                max-height: 40vh;
                border-right: none;
                border-bottom: 1px solid #ddd;
                margin-top: 0;
                transition: max-height 0.3s ease;
            }
            
            .controls.collapsed {
                max-height: 0;
                overflow: hidden;
                padding: 0 20px;
            }
            
            .workspace {
                margin-left: 0;
                margin-top: 0;
                height: 60vh;
                transition: height 0.3s ease;
            }
            
            .workspace.expanded {
                height: calc(100vh - 60px);
            }
            
            .top-menu {
                position: relative;
                height: auto;
                padding: 10px;
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .logo {
                font-size: 16px;
            }
            
            .menu-actions {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .menu-btn {
                padding: 8px 12px;
                font-size: 11px;
            }
            
            .chat-modal {
                width: calc(100vw - 20px);
                height: calc(60vh - 40px);
                bottom: 10px;
                right: 10px;
                left: 10px;
            }
            
            .chat-trigger {
                bottom: 15px;
                right: 15px;
            }
            
            .welcome-message {
                right: 15px;
                bottom: 85px;
                max-width: calc(100vw - 100px);
            }
            
            .control-group {
                margin-bottom: 15px;
            }
            
            .control-content {
                max-height: 200px;
                overflow-y: auto;
            }
            
            .preset-buttons {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .preset-btn {
                padding: 8px 12px;
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            .controls {
                padding: 15px;
                max-height: 35vh;
            }
            
            .workspace {
                height: 65vh;
            }
            
            .top-menu {
                padding: 8px;
            }
            
            .logo {
                font-size: 14px;
            }
            
            .menu-btn {
                padding: 6px 10px;
                font-size: 10px;
            }
            
            .control-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .control-item input,
            .control-item select {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Top Menu Bar -->
    <div class="top-menu">
        <div class="logo">
            <i class="fas fa-palette"></i>
            <span>Surprise Granite Chatbot Designer</span>
        </div>
        <div class="menu-actions">
            <button class="menu-btn" onclick="toggleControls()" id="toggleControlsBtn" style="display: none;">
                <i class="fas fa-cog"></i>
                <span>Controls</span>
            </button>
            <button class="menu-btn" onclick="showCodeModal()">
                <i class="fas fa-code"></i>
                Get Code
            </button>
            <button class="menu-btn" onclick="saveDesign()">
                <i class="fas fa-save"></i>
                Save
            </button>
            <button class="menu-btn" onclick="exportChatbot()">
                <i class="fas fa-download"></i>
                Export
            </button>
            <button class="menu-btn secondary" onclick="resetToDefaults()">
                <i class="fas fa-undo"></i>
                Reset
            </button>
            <button class="menu-btn danger" onclick="clearWorkspace()">
                <i class="fas fa-trash"></i>
                Clear
            </button>
        </div>
    </div>

    <div class="controls" id="controlsPanel">
        <div class="demo-welcome" style="background: #e8f4f8; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #2196F3;">
            <h4 style="margin: 0 0 8px 0; color: #1976D2;">ðŸŽ‰ Welcome to the Live Demo!</h4>
            <p style="margin: 0; font-size: 13px; color: #555;">
                This is a fully functional chatbot designer. Use the controls below to customize your chatbot's appearance and behavior. 
                Your changes appear instantly in the preview on the right! Try changing colors, messages, and styles.
            </p>
        </div>
        
        <h1 style="margin-bottom: 20px; color: #1f4e79;">ðŸŽ¨ Enhanced Chatbot Designer</h1>
        
        <div class="preset-buttons">
            <button class="preset-btn" onclick="applyPreset('professional')">Professional</button>
            <button class="preset-btn" onclick="applyPreset('modern')">Modern</button>
            <button class="preset-btn" onclick="applyPreset('classic')">Classic</button>
            <button class="preset-btn" onclick="applyPreset('minimal')">Minimal</button>
            <button class="preset-btn" onclick="applyPreset('dark')">Dark Mode</button>
            <button class="preset-btn" onclick="applyPreset('neon')">Neon</button>
            <button class="preset-btn" onclick="applyPreset('elegant')">Elegant</button>
            <button class="preset-btn" onclick="applyPreset('playful')">Playful</button>
        </div>

        <div class="control-group">
            <h3>ðŸŽ¨ Colors</h3>
            <div class="control-content">
                <div class="control-item">
                    <label>Header</label>
                    <input type="color" id="headerColor" value="#1f4e79" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Header Text</label>
                    <input type="color" id="headerTextColor" value="#ffffff" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Avatar</label>
                    <input type="color" id="avatarColor" value="#f1c40f" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Avatar Text</label>
                    <input type="color" id="avatarTextColor" value="#1f4e79" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Bot Message</label>
                    <input type="color" id="botMessageColor" value="#ffffff" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Bot Text</label>
                    <input type="color" id="botMessageText" value="#333333" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>User Message</label>
                    <input type="color" id="userMessageColor" value="#1f4e79" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>User Text</label>
                    <input type="color" id="userMessageText" value="#ffffff" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Send Button</label>
                    <input type="color" id="sendBtnColor" value="#f1c40f" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Send Icon</label>
                    <input type="color" id="sendBtnText" value="#1f4e79" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Messages Background</label>
                    <input type="color" id="messagesBg" value="#f8f9fa" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Container Background</label>
                    <input type="color" id="containerBg" value="#ffffff" onchange="updateStyle()">
                </div>
            </div>
        </div>

        <div class="control-group">
            <h3>ðŸ“ Container & Layout</h3>
            <div class="control-content">
                <div class="control-item">
                    <label>Container Width</label>
                    <input type="range" id="containerWidth" min="300" max="600" value="450" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Container Height</label>
                    <input type="range" id="containerHeight" min="400" max="800" value="600" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Container Radius</label>
                    <input type="range" id="containerRadius" min="0" max="30" value="20" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Shadow Intensity</label>
                    <input type="range" id="shadowIntensity" min="0" max="100" value="15" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Header Padding</label>
                    <input type="range" id="headerPadding" min="10" max="30" value="20" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Messages Padding</label>
                    <input type="range" id="messagesPadding" min="10" max="30" value="20" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Messages Gap</label>
                    <input type="range" id="messagesGap" min="5" max="25" value="15" onchange="updateStyle()">
                </div>
            </div>
        </div>

        <div class="control-group">
            <h3>ðŸ‘¤ Avatar & Header</h3>
            <div class="control-content">
                <div class="control-item">
                    <label>Avatar Size</label>
                    <input type="range" id="avatarSize" min="30" max="80" value="50" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Avatar Shape</label>
                    <select id="avatarShape" onchange="updateStyle()">
                        <option value="50%">Circle</option>
                        <option value="15%">Rounded Square</option>
                        <option value="0%">Square</option>
                    </select>
                </div>
                <div class="control-item">
                    <label>Header Font Size</label>
                    <input type="range" id="headerFontSize" min="12" max="28" value="18" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Header Font Weight</label>
                    <select id="headerFontWeight" onchange="updateStyle()">
                        <option value="400">Normal</option>
                        <option value="500">Medium</option>
                        <option value="600" selected>Semi-Bold</option>
                        <option value="700">Bold</option>
                    </select>
                </div>
                <div class="control-item">
                    <label>Subtitle Size</label>
                    <input type="range" id="subtitleSize" min="10" max="18" value="14" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Subtitle Opacity</label>
                    <input type="range" id="subtitleOpacity" min="0.3" max="1" step="0.1" value="0.9" onchange="updateStyle()">
                </div>
            </div>
        </div>

        <div class="control-group">
            <h3>ðŸ’¬ Message Styling</h3>
            <div class="control-content">
                <div class="control-item">
                    <label>Message Font Size</label>
                    <input type="range" id="messageFontSize" min="11" max="20" value="14" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Message Radius</label>
                    <input type="range" id="messageRadius" min="5" max="30" value="18" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Message Padding</label>
                    <input type="range" id="messagePadding" min="6" max="24" value="12" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Message Max Width</label>
                    <input type="range" id="messageMaxWidth" min="60" max="95" value="80" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Message Gap</label>
                    <input type="range" id="messageGap" min="5" max="20" value="10" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Avatar Size (Messages)</label>
                    <input type="range" id="messageAvatarSize" min="25" max="50" value="35" onchange="updateStyle()">
                </div>
            </div>
        </div>

        <div class="control-group">
            <h3>ðŸ“ Input Field</h3>
            <div class="control-content">
                <div class="control-item">
                    <label>Border Radius</label>
                    <input type="range" id="inputRadius" min="0" max="35" value="25" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Padding</label>
                    <input type="range" id="inputPadding" min="6" max="24" value="12" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Font Size</label>
                    <input type="range" id="inputFontSize" min="11" max="20" value="14" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Min Height</label>
                    <input type="range" id="inputHeight" min="30" max="70" value="45" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Border Color</label>
                    <input type="color" id="inputBorderColor" value="#e0e0e0" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Focus Color</label>
                    <input type="color" id="inputFocusColor" value="#1f4e79" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Background</label>
                    <input type="color" id="inputBg" value="#ffffff" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Text Color</label>
                    <input type="color" id="inputTextColor" value="#333333" onchange="updateStyle()">
                </div>
            </div>
        </div>

        <div class="control-group">
            <h3>ðŸš€ Send Button</h3>
            <div class="control-content">
                <div class="control-item">
                    <label>Button Size</label>
                    <input type="range" id="sendBtnSize" min="35" max="65" value="45" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Icon Size</label>
                    <input type="range" id="sendBtnIconSize" min="12" max="24" value="16" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Border Radius</label>
                    <input type="range" id="sendBtnRadius" min="0" max="50" value="50" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Hover Scale</label>
                    <input type="range" id="sendBtnHoverScale" min="1.0" max="1.3" step="0.05" value="1.05" onchange="updateStyle()">
                </div>
            </div>
        </div>

        <div class="control-group">
            <h3>ðŸŽ­ Effects & Animation</h3>
            <div class="control-content">
                <div class="control-item">
                    <label>Status Indicator</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="showStatus" checked onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Status Color</label>
                    <input type="color" id="statusColor" value="#10b981" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Message Animation</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="messageAnimation" checked onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Hover Effects</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="hoverEffects" checked onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Container Glow</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="containerGlow" onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Header Gradient</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="headerGradient" onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Gradient End Color</label>
                    <input type="color" id="headerGradientEnd" value="#34495e" onchange="updateStyle()">
                </div>
            </div>
        </div>

        <div class="control-group">
            <h3>ðŸŽ¨ Advanced Styling</h3>
            <div class="control-content">
                <div class="control-item">
                    <label>Container Border</label>
                    <input type="range" id="containerBorder" min="0" max="5" value="0" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Header Radius</label>
                    <input type="range" id="headerRadius" min="0" max="25" value="0" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Bot Corner Radius</label>
                    <input type="range" id="botCorner" min="0" max="20" value="6" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>User Corner Radius</label>
                    <input type="range" id="userCorner" min="0" max="20" value="6" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Input Gap</label>
                    <input type="range" id="inputGap" min="5" max="20" value="10" onchange="updateStyle()">
                </div>
            </div>
        </div>

        <div class="control-group">
            <h3>ðŸš€ Modal & Trigger</h3>
            <div class="control-content">
                <div class="control-item">
                    <label>Show as Modal</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="showAsModal" onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Modal Width</label>
                    <input type="range" id="modalWidth" min="300" max="500" value="350" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Modal Height</label>
                    <input type="range" id="modalHeight" min="400" max="700" value="500" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Trigger Size</label>
                    <input type="range" id="triggerSize" min="50" max="80" value="60" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Trigger Color</label>
                    <input type="color" id="triggerColor" value="#1f4e79" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Trigger Icon</label>
                    <select id="triggerIcon" onchange="updateStyle()">
                        <option value="fa-comments">ðŸ’¬ Chat Bubble</option>
                        <option value="fa-headset">ðŸŽ§ Support Headset</option>
                        <option value="fa-robot">ðŸ¤– AI Robot</option>
                        <option value="fa-question-circle">â“ Help Circle</option>
                        <option value="fa-phone">ðŸ“ž Phone Call</option>
                        <option value="fa-envelope">âœ‰ï¸ Email Message</option>
                        <option value="fa-user-tie">ðŸ‘” Professional</option>
                        <option value="fa-home">ðŸ  Home Services</option>
                        <option value="fa-tools">ðŸ”§ Tools & Services</option>
                        <option value="fa-gem">ðŸ’Ž Premium</option>
                        <option value="fa-star">â­ Star Rating</option>
                        <option value="fa-heart">â¤ï¸ Friendly Support</option>
                        <option value="fa-lightbulb">ðŸ’¡ Ideas & Tips</option>
                        <option value="fa-shield-alt">ðŸ›¡ï¸ Trusted Service</option>
                        <option value="fa-thumbs-up">ðŸ‘ Positive Experience</option>
                        <option value="fa-magic">âœ¨ Magic Touch</option>
                        <option value="fa-cog">âš™ï¸ Settings</option>
                        <option value="fa-rocket">ðŸš€ Fast Service</option>
                        <option value="fa-leaf">ðŸŒ¿ Eco-Friendly</option>
                        <option value="fa-clock">â° Quick Response</option>
                    </select>
                </div>
                <div class="control-item">
                    <label>Trigger Pulse</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="triggerPulse" checked onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </div>

        <div class="control-group">
            <h3>ðŸŽ­ Avatar & Icons</h3>
            <div class="control-content">
                <div class="control-item">
                    <label>Avatar Icon</label>
                    <select id="avatarIcon" onchange="updateStyle()">
                        <option value="ðŸ ">ðŸ  House (Home Services)</option>
                        <option value="ðŸ¤–">ðŸ¤– AI Robot</option>
                        <option value="ðŸ‘¨â€ðŸ’¼">ðŸ‘¨â€ðŸ’¼ Professional Man</option>
                        <option value="ðŸ‘©â€ðŸ’¼">ðŸ‘©â€ðŸ’¼ Professional Woman</option>
                        <option value="ðŸŽ¯">ðŸŽ¯ Target Goals</option>
                        <option value="ðŸ’Ž">ðŸ’Ž Premium Diamond</option>
                        <option value="â­">â­ Star Quality</option>
                        <option value="ðŸ”§">ðŸ”§ Tools & Repair</option>
                        <option value="ðŸ—ï¸">ðŸ—ï¸ Construction</option>
                        <option value="ðŸŽ¨">ðŸŽ¨ Design & Art</option>
                        <option value="ðŸ“">ðŸ“ Architecture</option>
                        <option value="âš¡">âš¡ Fast Service</option>
                        <option value="ðŸ› ï¸">ðŸ› ï¸ Handyman</option>
                        <option value="ðŸ†">ðŸ† Award Winning</option>
                        <option value="ðŸ’°">ðŸ’° Value & Savings</option>
                        <option value="ðŸŒŸ">ðŸŒŸ Premium Service</option>
                        <option value="ðŸŽª">ðŸŽª Fun & Creative</option>
                        <option value="ðŸ”®">ðŸ”® Future Vision</option>
                        <option value="ðŸŽ­">ðŸŽ­ Personalized</option>
                        <option value="ðŸš€">ðŸš€ Innovation</option>
                        <option value="ðŸŒˆ">ðŸŒˆ Colorful Options</option>
                        <option value="ðŸ’¡">ðŸ’¡ Smart Solutions</option>
                        <option value="ðŸ›¡ï¸">ðŸ›¡ï¸ Trusted & Secure</option>
                        <option value="custom">ðŸŽ¨ Custom Icon</option>
                    </select>
                </div>
                <div class="control-item" id="customIconSection" style="display: none;">
                    <label>Custom Icon</label>
                    <input type="text" id="customIcon" placeholder="Enter emoji or icon" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>User Avatar Icon</label>
                    <select id="userAvatarIcon" onchange="updateStyle()">
                        <option value="ðŸ‘¤">ðŸ‘¤ Generic User</option>
                        <option value="ðŸ‘¨">ðŸ‘¨ Man</option>
                        <option value="ðŸ‘©">ðŸ‘© Woman</option>
                        <option value="ðŸ™‹">ðŸ™‹ Person Raising Hand</option>
                        <option value="ðŸ˜Š">ðŸ˜Š Happy Customer</option>
                        <option value="ðŸ§‘â€ðŸ’»">ðŸ§‘â€ðŸ’» Tech Savvy</option>
                        <option value="ðŸ’¼">ðŸ’¼ Business Person</option>
                        <option value="ðŸ‘¨â€ðŸ­">ðŸ‘¨â€ðŸ­ Homeowner</option>
                        <option value="ðŸ‘©â€ðŸ­">ðŸ‘©â€ðŸ­ Homeowner</option>
                        <option value="ðŸ¡">ðŸ¡ Family Home</option>
                        <option value="ðŸ’‘">ðŸ’‘ Couple</option>
                        <option value="ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦">ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦ Family</option>
                        <option value="ðŸ§‘â€ðŸŽ¨">ðŸ§‘â€ðŸŽ¨ Creative Type</option>
                        <option value="ðŸ‘¨â€ðŸ”§">ðŸ‘¨â€ðŸ”§ DIY Enthusiast</option>
                        <option value="ðŸ‘©â€ðŸ”§">ðŸ‘©â€ðŸ”§ DIY Enthusiast</option>
                        <option value="ðŸŽ¯">ðŸŽ¯ Goal Oriented</option>
                        <option value="ï¿½">ï¿½ Idea Person</option>
                        <option value="âš¡">âš¡ Quick Responder</option>
                        <option value="ðŸŒŸ">ðŸŒŸ VIP Customer</option>
                        <option value="ðŸ¤">ðŸ¤ Partnership</option>
                    </select>
                </div>
                <div class="control-item">
                    <label>Icon Style</label>
                    <select id="iconStyle" onchange="updateStyle()">
                        <option value="emoji">ðŸŽ­ Emoji Style</option>
                        <option value="fontawesome">ðŸ“¦ Font Awesome</option>
                        <option value="material">ðŸŽ¨ Material Design</option>
                        <option value="bootstrap">ðŸ…±ï¸ Bootstrap Icons</option>
                        <option value="feather">ðŸª¶ Feather Icons</option>
                        <option value="heroicons">ðŸ¦¸ Hero Icons</option>
                        <option value="lucide">ðŸ’« Lucide Icons</option>
                        <option value="ionicons">âš¡ Ion Icons</option>
                    </select>
                </div>
                <div class="control-item">
                    <label>Icon Animation</label>
                    <select id="iconAnimation" onchange="updateStyle()">
                        <option value="none">None</option>
                        <option value="bounce">ðŸ€ Bounce</option>
                        <option value="pulse">ðŸ’“ Pulse</option>
                        <option value="rotate">ðŸŒ€ Rotate</option>
                        <option value="shake">ðŸ“³ Shake</option>
                        <option value="wobble">ðŸŽ¯ Wobble</option>
                        <option value="heartbeat">ðŸ’– Heartbeat</option>
                        <option value="flash">âš¡ Flash</option>
                        <option value="rubberBand">ðŸŽª Rubber Band</option>
                    </select>
                </div>
                <div class="control-item">
                    <label>Icon Size Multiplier</label>
                    <input type="range" id="iconSizeMultiplier" min="0.8" max="2.0" step="0.1" value="1.0" onchange="updateStyle()">
                </div>
            </div>
        </div>

        <div class="control-group">
            <h3>ðŸŽ­ Interactive Animations</h3>
            <div class="control-content">
                <div class="control-item">
                    <label>Typing Indicator</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="showTypingIndicator" checked onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Message Hover Effects</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="messageHoverEffects" checked onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Floating Action Buttons</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="showFloatingActions" onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Conversation Starters</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="showConversationStarters" checked onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Message Timestamps</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="showTimestamps" onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Emoji Reactions</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="showEmojiReactions" onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Message Feedback</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="showMessageFeedback" onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Chat Breadcrumbs</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="showBreadcrumbs" onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Entrance Animation</label>
                    <select id="entranceAnimation" onchange="updateStyle()">
                        <option value="fadeIn">ðŸ’« Fade In</option>
                        <option value="slideInUp">â¬†ï¸ Slide Up</option>
                        <option value="slideInRight">âž¡ï¸ Slide Right</option>
                        <option value="slideInLeft">â¬…ï¸ Slide Left</option>
                        <option value="zoomIn">ðŸ” Zoom In</option>
                        <option value="bounceIn">ðŸ€ Bounce In</option>
                        <option value="flipInX">ðŸ”„ Flip In X</option>
                        <option value="rollIn">ðŸŒ€ Roll In</option>
                        <option value="lightSpeedIn">âš¡ Light Speed</option>
                    </select>
                </div>
                <div class="control-item">
                    <label>Animation Duration</label>
                    <input type="range" id="animationDuration" min="0.3" max="2.0" step="0.1" value="0.5" onchange="updateStyle()">
                </div>
            </div>
        </div>

        <div class="control-group">
            <h3>ï¿½ Workspace Controls</h3>
            <div class="control-content">
                <div class="control-item">
                    <label>Show Grid</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="showGrid" onchange="toggleGrid()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Snap to Grid</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="snapToGrid" onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Position Presets</label>
                    <button class="action-btn" onclick="togglePositionControls()">
                        ðŸ“ Show Position Panel
                    </button>
                </div>
                <div class="control-item">
                    <label>Chatbot X Position</label>
                    <input type="range" id="chatbotX" min="0" max="100" value="10" onchange="updateChatbotPosition()">
                    <span id="chatbotXValue">10%</span>
                </div>
                <div class="control-item">
                    <label>Chatbot Y Position</label>
                    <input type="range" id="chatbotY" min="0" max="100" value="10" onchange="updateChatbotPosition()">
                    <span id="chatbotYValue">10%</span>
                </div>
                <div class="control-item">
                    <label>Lock Position</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="lockPosition" onchange="toggleLockPosition()">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </div>

        <div class="control-group">
            <h3>âš™ï¸ Advanced Functions</h3>
            <div class="control-content">
                <div class="control-item">
                    <label>Auto-Open Chat</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="autoOpenChat" onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Auto-Open Delay (ms)</label>
                    <input type="range" id="autoOpenDelay" min="1000" max="10000" value="3000" onchange="updateStyle()">
                    <span id="autoOpenDelayValue">3000ms</span>
                </div>
                <div class="control-item">
                    <label>Typing Speed (ms)</label>
                    <input type="range" id="typingSpeed" min="50" max="200" value="100" onchange="updateStyle()">
                    <span id="typingSpeedValue">100ms</span>
                </div>
                <div class="control-item">
                    <label>Sound Effects</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="soundEffects" onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Message History</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="saveHistory" checked onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Local Storage</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="useLocalStorage" checked onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </div>

        <div class="control-group">
            <h3>ðŸ¤– AI & Scripting</h3>
            <div class="control-content">
                <div class="control-item">
                    <label>AI Responses</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="enableAI" onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Response Template</label>
                    <select id="responseTemplate" onchange="updateStyle()">
                        <option value="friendly">ï¿½ Friendly</option>
                        <option value="professional">ðŸ’¼ Professional</option>
                        <option value="helpful">ðŸ¤ Helpful</option>
                        <option value="casual">ï¿½ Casual</option>
                        <option value="formal">ðŸŽ© Formal</option>
                    </select>
                </div>
                <div class="control-item">
                    <label>Auto-Suggest</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="autoSuggest" onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Custom JavaScript</label>
                    <button class="action-btn" onclick="openScriptEditor()">
                        ðŸ“ Edit Scripts
                    </button>
                </div>
                <div class="control-item">
                    <label>API Integration</label>
                    <button class="action-btn" onclick="openAPIConfig()">
                        ï¿½ Configure API
                    </button>
                </div>
                <div class="control-item">
                    <label>Webhook URL</label>
                    <input type="text" id="webhookUrl" placeholder="https://your-api.com/webhook" onchange="updateStyle()">
                </div>
            </div>
        </div>

        <div class="control-group">
            <h3>ðŸ“Š Analytics & Tracking</h3>
            <div class="control-content">
                <div class="control-item">
                    <label>Google Analytics</label>
                    <input type="text" id="googleAnalytics" placeholder="GA-XXXXXXXXX" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Track Interactions</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="trackInteractions" onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Session Recording</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="sessionRecording" onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Conversion Tracking</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="conversionTracking" onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </div>

        <div class="control-group">
            <h3>ðŸŽ¨ Advanced Styling</h3>
            <div class="control-content">
                <div class="control-item">
                    <label>Glass Effect</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="glassEffect" onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Blur Intensity</label>
                    <input type="range" id="blurIntensity" min="0" max="20" value="10" onchange="updateStyle()">
                    <span id="blurIntensityValue">10px</span>
                </div>
                <div class="control-item">
                    <label>Particle Effects</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="particleEffects" onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>3D Transforms</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="enable3D" onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Perspective (px)</label>
                    <input type="range" id="perspective3D" min="500" max="2000" value="1000" onchange="updateStyle()">
                    <span id="perspective3DValue">1000px</span>
                </div>
                <div class="control-item">
                    <label>Rotation X</label>
                    <input type="range" id="rotationX" min="-30" max="30" value="0" onchange="updateStyle()">
                    <span id="rotationXValue">0Â°</span>
                </div>
                <div class="control-item">
                    <label>Rotation Y</label>
                    <input type="range" id="rotationY" min="-30" max="30" value="0" onchange="updateStyle()">
                    <span id="rotationYValue">0Â°</span>
                </div>
            </div>
        </div>

        <div class="control-group">
            <h3>ðŸ’¬ Interactive Features</h3>
            <div class="control-content">
                <div class="control-item">
                    <label>Quick Responses</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="showQuickResponses" onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Welcome Message</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="showWelcome" onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Welcome Text</label>
                    <input type="text" id="welcomeText" value="ðŸ‘‹ Hi! Need help with countertops?" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Sound Wave Effect</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="showSoundWave" onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Message Reactions</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="showReactions" onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Unread Badge</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="showUnreadBadge" onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>File Upload</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="enableFileUpload" onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </div>

        <div class="control-group">
            <h3>ðŸŽ¨ Typing & Status</h3>
            <div class="control-content">
                <div class="control-item">
                    <label>Enhanced Typing</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="enhancedTyping" checked onchange="updateStyle()">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="control-item">
                    <label>Typing Dot Color</label>
                    <input type="color" id="typingDotColor" value="#999999" onchange="updateStyle()">
                </div>
                <div class="control-item">
                    <label>Status Mode</label>
                    <select id="statusMode" onchange="updateStyle()">
                        <option value="online">ðŸŸ¢ Online</option>
                        <option value="busy">ðŸ”´ Busy</option>
                        <option value="away">ðŸŸ¡ Away</option>
                        <option value="recording">ðŸ”´ Recording</option>
                        <option value="processing">ðŸŸ¡ Processing</option>
                    </select>
                </div>
                <div class="control-item">
                    <label>Sound Wave Color</label>
                    <input type="color" id="soundWaveColor" value="#1f4e79" onchange="updateStyle()">
                </div>
            </div>
        </div>
    </div>

    <!-- Workspace -->
    <div class="workspace" id="workspace">
        <!-- Position Controls Panel -->
        <div class="position-controls" id="positionControls">
            <h4>ðŸ“ Position Presets</h4>
            <div class="position-grid">
                <button class="position-btn" onclick="setPosition('top-left')" title="Top Left">â†–ï¸</button>
                <button class="position-btn" onclick="setPosition('top-center')" title="Top Center">â¬†ï¸</button>
                <button class="position-btn" onclick="setPosition('top-right')" title="Top Right">â†—ï¸</button>
                <button class="position-btn" onclick="setPosition('center-left')" title="Center Left">â¬…ï¸</button>
                <button class="position-btn" onclick="setPosition('center')" title="Center">ðŸŽ¯</button>
                <button class="position-btn" onclick="setPosition('center-right')" title="Center Right">âž¡ï¸</button>
                <button class="position-btn" onclick="setPosition('bottom-left')" title="Bottom Left">â†™ï¸</button>
                <button class="position-btn" onclick="setPosition('bottom-center')" title="Bottom Center">â¬‡ï¸</button>
                <button class="position-btn" onclick="setPosition('bottom-right')" title="Bottom Right">â†˜ï¸</button>
            </div>
            <div style="display: flex; gap: 8px;">
                <button class="action-btn" onclick="centerChatbot()">ðŸŽ¯ Center</button>
                <button class="action-btn" onclick="resetPosition()">ðŸ”„ Reset</button>
            </div>
        </div>

        <!-- Snap Indicator -->
        <div class="snap-indicator" id="snapIndicator"></div>


    </div>

        <!-- Draggable Chatbot Modal -->
        <div class="chatbot-modal" id="chatbotModal">
            <!-- Drag Handle -->
            <div class="modal-drag-handle" id="modalDragHandle">
                <div class="modal-title">
                    <i class="fas fa-robot"></i>
                    <span>Live Preview</span>
                </div>
                <div class="modal-controls">
                    <button class="modal-control-btn minimize" onclick="minimizeChatbot()" title="Minimize"></button>
                    <button class="modal-control-btn maximize" onclick="maximizeChatbot()" title="Maximize"></button>
                    <button class="modal-control-btn close" onclick="closeChatbot()" title="Close"></button>
                </div>
            </div>

            <!-- Resize Handle -->
            <div class="resize-handle se" id="resizeHandle"></div>

            <!-- Chat Trigger Button -->
            <div class="chat-trigger" id="chatTrigger">
                <i class="fas fa-comments" id="triggerIconElement"></i>
                <div class="unread-badge" id="unreadBadge" style="display: none;">3</div>
            </div>

            <!-- Welcome Message -->
            <div class="welcome-message" id="welcomeMessage" style="display: none;">
                <div class="welcome-close" onclick="closeWelcome()">Ã—</div>
                <span id="welcomeText">ðŸ‘‹ Hi! Need help with countertops?</span>
            </div>

            <!-- Chat Modal -->
            <div class="chat-modal" id="chatModal" style="display: block;">
                <div class="chat-container" id="chatContainer">
                <!-- Chat Breadcrumb -->
                <div class="chat-breadcrumb" id="chatBreadcrumb" style="display: none;">
                    <div class="breadcrumb-item">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </div>
                    <span class="breadcrumb-separator">â€º</span>
                    <div class="breadcrumb-item">
                        <span>Countertops</span>
                    </div>
                </div>

                <div class="chat-header">
                    <div class="avatar">ðŸ </div>
                    <div class="header-info">
                        <h3>Surprise Granite AI</h3>
                        <p>Your Remodeling Expert</p>
                    </div>
                    <div class="status-indicator" id="statusIndicator"></div>
                    <div class="sound-wave" id="soundWave" style="display: none;">
                        <div class="sound-bar"></div>
                        <div class="sound-bar"></div>
                        <div class="sound-bar"></div>
                        <div class="sound-bar"></div>
                    </div>
                </div>

                <!-- Conversation Starters -->
                <div class="conversation-starters" id="conversationStarters" style="display: none;">
                    <button class="starter-btn" onclick="selectStarter('I need countertop pricing')">ðŸ’° Get Pricing</button>
                    <button class="starter-btn" onclick="selectStarter('What materials do you offer?')">ðŸª¨ Materials</button>
                    <button class="starter-btn" onclick="selectStarter('Schedule a consultation')">ðŸ“… Schedule</button>
                    <button class="starter-btn" onclick="selectStarter('View our gallery')">ðŸ–¼ï¸ Gallery</button>
                </div>

                <div class="chat-messages">
                    <div class="message">
                        <div class="message-avatar bot-avatar">ðŸ </div>
                        <div class="message-content bot-message">
                            Hi there! ðŸ‘‹ I'm here to help you with your countertop project. What can I help you with today?
                            <div class="message-time" style="display: none;">2:45 PM</div>
                            <div class="message-feedback" style="display: none;">
                                <button class="feedback-btn" title="Helpful">ðŸ‘</button>
                                <button class="feedback-btn" title="Not Helpful">ðŸ‘Ž</button>
                                <button class="feedback-btn" title="Add Reaction">ðŸ˜Š</button>
                            </div>
                            <div class="message-reactions" style="display: none;">
                                <span class="reaction">ðŸ‘ 2</span>
                                <span class="reaction">ðŸ˜Š 1</span>
                            </div>
                        </div>
                    </div>
                    <div class="message user">
                        <div class="message-avatar user-avatar">ðŸ‘¤</div>
                        <div class="message-content user-message">
                            I'm looking for kitchen countertop pricing
                            <div class="message-time" style="display: none;">2:46 PM</div>
                        </div>
                    </div>

                    <!-- Typing Indicator -->
                    <div class="typing-indicator" id="typingIndicator">
                        <div class="message-avatar bot-avatar">ðŸ </div>
                        <div class="typing-dots">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>

                    <div class="message">
                        <div class="message-avatar bot-avatar">ðŸ </div>
                        <div class="message-content bot-message">
                            Perfect! Let me help you get a quick price estimate for your kitchen countertops. What's the approximate square footage?
                            <div class="message-time" style="display: none;">2:47 PM</div>
                            <div class="message-feedback" style="display: none;">
                                <button class="feedback-btn" title="Helpful">ðŸ‘</button>
                                <button class="feedback-btn" title="Not Helpful">ðŸ‘Ž</button>
                                <button class="feedback-btn" title="Add Reaction">ðŸ˜Š</button>
                            </div>
                        </div>
                    </div>

                    <!-- System Message Example -->
                    <div class="message system" style="display: none;">
                        Agent is typing...
                    </div>
                </div>

                <!-- File Upload Area -->
                <div class="file-upload-area" id="fileUploadArea" style="display: none;">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 24px; color: #999; margin-bottom: 8px;"></i>
                    <p>Drop files here or click to upload</p>
                    <small>Supports images, PDFs, and documents</small>
                </div>

                <!-- Quick Responses -->
                <div class="quick-responses" id="quickResponses" style="display: none;">
                    <button class="quick-response-btn" onclick="selectQuickResponse('50-100 sq ft')">50-100 sq ft</button>
                    <button class="quick-response-btn" onclick="selectQuickResponse('100-150 sq ft')">100-150 sq ft</button>
                    <button class="quick-response-btn" onclick="selectQuickResponse('150+ sq ft')">150+ sq ft</button>
                    <button class="quick-response-btn" onclick="selectQuickResponse('Not sure')">Not sure</button>
                </div>

                <div class="chat-input">
                    <textarea class="input-field" placeholder="Type your message here..." rows="1"></textarea>
                    <button class="send-btn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>

            <!-- Floating Action Buttons -->
            <div class="floating-actions" id="floatingActions" style="display: none;">
                <button class="floating-btn" title="Call Us">
                    <i class="fas fa-phone"></i>
                </button>
                <button class="floating-btn" title="Email">
                    <i class="fas fa-envelope"></i>
                </button>
                <button class="floating-btn" title="Gallery">
                    <i class="fas fa-images"></i>
                </button>
            </div>

            <!-- Emoji Picker -->
            <div class="emoji-picker" id="emojiPicker">
                <div class="emoji-grid">
                    <button class="emoji-btn" onclick="addEmoji('ðŸ˜Š')">ðŸ˜Š</button>
                    <button class="emoji-btn" onclick="addEmoji('ðŸ‘')">ðŸ‘</button>
                    <button class="emoji-btn" onclick="addEmoji('â¤ï¸')">â¤ï¸</button>
                    <button class="emoji-btn" onclick="addEmoji('ðŸŽ‰')">ðŸŽ‰</button>
                    <button class="emoji-btn" onclick="addEmoji('ðŸ¤”')">ðŸ¤”</button>
                    <button class="emoji-btn" onclick="addEmoji('ðŸ‘')">ðŸ‘</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Code Generation Modal -->
    <div class="code-modal" id="codeModal">
        <div class="code-content">
            <div class="code-header">
                <h3><i class="fas fa-code"></i> Chatbot Code Snippets</h3>
                <button class="menu-btn danger" onclick="closeCodeModal()">
                    <i class="fas fa-times"></i>
                    Close
                </button>
            </div>
            <div class="code-tabs">
                <button class="code-tab active" onclick="showCodeTab('html')">Complete HTML</button>
                <button class="code-tab" onclick="showCodeTab('embed')">Website Embed</button>
                <button class="code-tab" onclick="showCodeTab('wordpress')">WordPress</button>
                <button class="code-tab" onclick="showCodeTab('react')">React Component</button>
                <button class="code-tab" onclick="showCodeTab('js')">JavaScript Plugin</button>
                <button class="code-tab" onclick="showCodeTab('css')">CSS Only</button>
            </div>
            <div class="code-body">
                <div id="codeTabContent">
                    <!-- Code content will be dynamically generated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Script Editor Modal -->
    <div class="code-modal" id="scriptModal">
        <div class="code-content">
            <div class="code-header">
                <h3><i class="fas fa-edit"></i> Custom JavaScript Editor</h3>
                <div style="display: flex; gap: 10px;">
                    <button class="menu-btn" onclick="saveScript()">
                        <i class="fas fa-save"></i>
                        Save Script
                    </button>
                    <button class="menu-btn secondary" onclick="resetScript()">
                        <i class="fas fa-undo"></i>
                        Reset
                    </button>
                    <button class="menu-btn danger" onclick="closeScriptEditor()">
                        <i class="fas fa-times"></i>
                        Close
                    </button>
                </div>
            </div>
            <div class="code-tabs">
                <button class="code-tab active" onclick="showScriptTab('init')">Initialization</button>
                <button class="code-tab" onclick="showScriptTab('events')">Event Handlers</button>
                <button class="code-tab" onclick="showScriptTab('responses')">Auto Responses</button>
                <button class="code-tab" onclick="showScriptTab('custom')">Custom Functions</button>
            </div>
            <div class="code-body">
                <div id="scriptTabContent">
                    <textarea id="scriptEditor" placeholder="// Write your custom JavaScript here..."></textarea>
                </div>
            </div>
        </div>
    </div>

    <!-- API Configuration Modal -->
    <div class="code-modal" id="apiModal">
        <div class="code-content">
            <div class="code-header">
                <h3><i class="fas fa-cog"></i> API Configuration</h3>
                <button class="menu-btn danger" onclick="closeAPIConfig()">
                    <i class="fas fa-times"></i>
                    Close
                </button>
            </div>
            <div class="code-body" style="padding: 30px;">
                <div class="api-config-section">
                    <h4>ðŸ”— Webhook Configuration</h4>
                    <div class="control-item">
                        <label>Webhook URL</label>
                        <input type="text" id="apiWebhookUrl" placeholder="https://your-api.com/webhook" style="width: 100%;">
                    </div>
                    <div class="control-item">
                        <label>HTTP Method</label>
                        <select id="apiMethod" style="width: 100%;">
                            <option value="POST">POST</option>
                            <option value="GET">GET</option>
                            <option value="PUT">PUT</option>
                        </select>
                    </div>
                    <div class="control-item">
                        <label>Authentication Type</label>
                        <select id="apiAuth" style="width: 100%;">
                            <option value="none">None</option>
                            <option value="bearer">Bearer Token</option>
                            <option value="api-key">API Key</option>
                            <option value="basic">Basic Auth</option>
                        </select>
                    </div>
                    <div class="control-item">
                        <label>API Key / Token</label>
                        <input type="password" id="apiToken" placeholder="Your API key or token" style="width: 100%;">
                    </div>
                </div>

                <div class="api-config-section">
                    <h4>ðŸ“Š Third-Party Integrations</h4>
                    <div class="control-item">
                        <label>Google Analytics ID</label>
                        <input type="text" id="apiGoogleAnalytics" placeholder="GA-XXXXXXXXX" style="width: 100%;">
                    </div>
                    <div class="control-item">
                        <label>Facebook Pixel ID</label>
                        <input type="text" id="apiFacebookPixel" placeholder="Facebook Pixel ID" style="width: 100%;">
                    </div>
                    <div class="control-item">
                        <label>Hotjar Site ID</label>
                        <input type="text" id="apiHotjar" placeholder="Hotjar Site ID" style="width: 100%;">
                    </div>
                </div>

                <div class="api-config-section">
                    <h4>ðŸ¤– AI Service Configuration</h4>
                    <div class="control-item">
                        <label>AI Service</label>
                        <select id="aiService" style="width: 100%;">
                            <option value="openai">OpenAI GPT</option>
                            <option value="anthropic">Anthropic Claude</option>
                            <option value="google">Google Bard</option>
                            <option value="custom">Custom API</option>
                        </select>
                    </div>
                    <div class="control-item">
                        <label>AI API Key</label>
                        <input type="password" id="aiApiKey" placeholder="AI service API key" style="width: 100%;">
                    </div>
                    <div class="control-item">
                        <label>Model</label>
                        <input type="text" id="aiModel" placeholder="gpt-3.5-turbo" style="width: 100%;">
                    </div>
                </div>

                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button class="menu-btn" onclick="testAPI()">
                        <i class="fas fa-flask"></i>
                        Test Connection
                    </button>
                    <button class="menu-btn" onclick="saveAPIConfig()">
                        <i class="fas fa-save"></i>
                        Save Configuration
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification">Design saved!</div>

    <script>
        function updateStyle() {
            const container = document.getElementById('chatContainer');
            const header = container.querySelector('.chat-header');
            
            const getValue = (id, defaultVal = '') => {
                const element = document.getElementById(id);
                return element ? element.value : defaultVal;
            };

            const getChecked = (id) => {
                const element = document.getElementById(id);
                return element ? element.checked : false;
            };

            // Colors
            container.style.setProperty('--header-color', getValue('headerColor', '#1f4e79'));
            container.style.setProperty('--header-text-color', getValue('headerTextColor', '#ffffff'));
            container.style.setProperty('--avatar-color', getValue('avatarColor', '#f1c40f'));
            container.style.setProperty('--avatar-text-color', getValue('avatarTextColor', '#1f4e79'));
            container.style.setProperty('--bot-message-color', getValue('botMessageColor', '#ffffff'));
            container.style.setProperty('--bot-message-text', getValue('botMessageText', '#333333'));
            container.style.setProperty('--user-message-color', getValue('userMessageColor', '#1f4e79'));
            container.style.setProperty('--user-message-text', getValue('userMessageText', '#ffffff'));
            container.style.setProperty('--send-btn-color', getValue('sendBtnColor', '#f1c40f'));
            container.style.setProperty('--send-btn-text', getValue('sendBtnText', '#1f4e79'));
            container.style.setProperty('--messages-bg', getValue('messagesBg', '#f8f9fa'));
            container.style.setProperty('--container-bg', getValue('containerBg', '#ffffff'));

            // Container & Layout
            container.style.setProperty('--container-width', getValue('containerWidth', '450') + 'px');
            container.style.setProperty('--container-height', getValue('containerHeight', '600') + 'px');
            container.style.setProperty('--container-radius', getValue('containerRadius', '20') + 'px');
            container.style.setProperty('--container-shadow', `0 20px 60px rgba(0,0,0,${getValue('shadowIntensity', '15') / 100})`);
            container.style.setProperty('--header-padding', getValue('headerPadding', '20') + 'px');
            container.style.setProperty('--messages-padding', getValue('messagesPadding', '20') + 'px');
            container.style.setProperty('--messages-gap', getValue('messagesGap', '15') + 'px');

            // Avatar & Header
            container.style.setProperty('--avatar-size', getValue('avatarSize', '50') + 'px');
            container.style.setProperty('--avatar-radius', getValue('avatarShape', '50%'));
            container.style.setProperty('--header-font-size', getValue('headerFontSize', '18') + 'px');
            container.style.setProperty('--header-font-weight', getValue('headerFontWeight', '600'));
            container.style.setProperty('--header-subtitle-size', getValue('subtitleSize', '14') + 'px');
            container.style.setProperty('--header-subtitle-opacity', getValue('subtitleOpacity', '0.9'));

            // Message Styling
            container.style.setProperty('--message-font-size', getValue('messageFontSize', '14') + 'px');
            container.style.setProperty('--message-radius', getValue('messageRadius', '18') + 'px');
            container.style.setProperty('--message-padding', getValue('messagePadding', '12') + 'px');
            container.style.setProperty('--message-max-width', getValue('messageMaxWidth', '80') + '%');
            container.style.setProperty('--message-gap', getValue('messageGap', '10') + 'px');
            container.style.setProperty('--message-avatar-size', getValue('messageAvatarSize', '35') + 'px');

            // Input Field
            container.style.setProperty('--input-radius', getValue('inputRadius', '25') + 'px');
            container.style.setProperty('--input-padding', getValue('inputPadding', '12') + 'px');
            container.style.setProperty('--input-font-size', getValue('inputFontSize', '14') + 'px');
            container.style.setProperty('--input-height', getValue('inputHeight', '45') + 'px');
            container.style.setProperty('--input-border', '2px solid ' + getValue('inputBorderColor', '#e0e0e0'));
            container.style.setProperty('--input-focus-color', getValue('inputFocusColor', '#1f4e79'));
            container.style.setProperty('--input-bg', getValue('inputBg', '#ffffff'));
            container.style.setProperty('--input-text-color', getValue('inputTextColor', '#333333'));

            // Send Button
            container.style.setProperty('--send-btn-size', getValue('sendBtnSize', '45') + 'px');
            container.style.setProperty('--send-btn-icon-size', getValue('sendBtnIconSize', '16') + 'px');
            container.style.setProperty('--send-btn-radius', getValue('sendBtnRadius', '50') + '%');
            container.style.setProperty('--send-btn-hover-transform', 'scale(' + getValue('sendBtnHoverScale', '1.05') + ')');

            // Effects & Animation
            const statusIndicator = document.getElementById('statusIndicator');
            if (statusIndicator) {
                statusIndicator.style.display = getChecked('showStatus') ? 'block' : 'none';
            }
            container.style.setProperty('--status-color', getValue('statusColor', '#10b981'));
            container.style.setProperty('--message-animation', getChecked('messageAnimation') ? 'slideIn 0.3s ease-out' : 'none');
            container.style.setProperty('--send-btn-hover-shadow', getChecked('hoverEffects') ? '0 4px 12px rgba(0,0,0,0.2)' : 'none');

            // Container Glow
            if (getChecked('containerGlow')) {
                container.classList.add('glow');
            } else {
                container.classList.remove('glow');
            }

            // Header Gradient
            if (getChecked('headerGradient')) {
                header.classList.add('gradient');
                container.style.setProperty('--header-gradient-end', getValue('headerGradientEnd', '#34495e'));
                container.style.setProperty('--gradient-direction', '45deg');
            } else {
                header.classList.remove('gradient');
            }

            // Advanced Styling
            container.style.setProperty('--container-border', getValue('containerBorder', '0') + 'px solid #ddd');
            container.style.setProperty('--header-radius', getValue('headerRadius', '0') + 'px');
            container.style.setProperty('--bot-message-corner', getValue('botCorner', '6') + 'px');
            container.style.setProperty('--user-message-corner', getValue('userCorner', '6') + 'px');
            container.style.setProperty('--input-gap', getValue('inputGap', '10') + 'px');

            // Glass Effect
            if (getChecked('glassEffect')) {
                const blurIntensity = getValue('blurIntensity', '10');
                container.style.setProperty('backdrop-filter', `blur(${blurIntensity}px)`);
                container.style.setProperty('background', 'rgba(255, 255, 255, 0.9)');
                document.getElementById('blurIntensityValue').textContent = blurIntensity + 'px';
            } else {
                container.style.removeProperty('backdrop-filter');
            }

            // 3D Transforms
            if (getChecked('enable3D')) {
                const perspective = getValue('perspective3D', '1000');
                const rotationX = getValue('rotationX', '0');
                const rotationY = getValue('rotationY', '0');
                
                container.style.setProperty('perspective', perspective + 'px');
                container.style.setProperty('transform-style', 'preserve-3d');
                container.style.setProperty('transform', 
                    `${container.style.transform || ''} rotateX(${rotationX}deg) rotateY(${rotationY}deg)`);
                
                document.getElementById('perspective3DValue').textContent = perspective + 'px';
                document.getElementById('rotationXValue').textContent = rotationX + 'Â°';
                document.getElementById('rotationYValue').textContent = rotationY + 'Â°';
            } else {
                container.style.removeProperty('perspective');
                container.style.removeProperty('transform-style');
            }

            // Update value displays
            ['autoOpenDelay', 'typingSpeed'].forEach(id => {
                const element = document.getElementById(id);
                const valueElement = document.getElementById(id + 'Value');
                if (element && valueElement) {
                    valueElement.textContent = element.value + (id.includes('Delay') || id.includes('Speed') ? 'ms' : '');
                }
            });

            // Update avatar icons
            updateAvatarIcons();
            updateInteractiveFeatures();
            updateAnimationSettings();
            updateAdvancedFeatures();
        }

        function updateAdvancedFeatures() {
            const getChecked = (id) => {
                const element = document.getElementById(id);
                return element ? element.checked : false;
            };

            const getValue = (id, defaultVal = '') => {
                const element = document.getElementById(id);
                return element ? element.value : defaultVal;
            };

            // Auto-open chat functionality
            if (getChecked('autoOpenChat')) {
                const delay = getValue('autoOpenDelay', '3000');
                setTimeout(() => {
                    const chatModal = document.getElementById('chatModal');
                    if (chatModal && chatModal.style.display === 'none') {
                        chatModal.style.display = 'block';
                        showNotification('Chat auto-opened!');
                    }
                }, parseInt(delay));
            }

            // Particle effects
            if (getChecked('particleEffects')) {
                addParticleEffect();
            } else {
                removeParticleEffect();
            }

            // Update chatbot configuration object
            window.chatbotConfig = {
                autoOpenChat: getChecked('autoOpenChat'),
                autoOpenDelay: parseInt(getValue('autoOpenDelay', '3000')),
                typingSpeed: parseInt(getValue('typingSpeed', '100')),
                soundEffects: getChecked('soundEffects'),
                saveHistory: getChecked('saveHistory'),
                useLocalStorage: getChecked('useLocalStorage'),
                enableAI: getChecked('enableAI'),
                responseTemplate: getValue('responseTemplate', 'friendly'),
                autoSuggest: getChecked('autoSuggest'),
                trackInteractions: getChecked('trackInteractions'),
                sessionRecording: getChecked('sessionRecording'),
                conversionTracking: getChecked('conversionTracking')
            };
        }

        function addParticleEffect() {
            // Simple particle effect implementation
            const workspace = document.getElementById('workspace');
            
            if (!document.getElementById('particles')) {
                const particles = document.createElement('div');
                particles.id = 'particles';
                particles.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    pointer-events: none;
                    z-index: 1;
                `;
                
                for (let i = 0; i < 20; i++) {
                    const particle = document.createElement('div');
                    particle.style.cssText = `
                        position: absolute;
                        width: 4px;
                        height: 4px;
                        background: rgba(52, 152, 219, 0.6);
                        border-radius: 50%;
                        animation: float ${2 + Math.random() * 3}s infinite ease-in-out;
                        left: ${Math.random() * 100}%;
                        top: ${Math.random() * 100}%;
                        animation-delay: ${Math.random() * 2}s;
                    `;
                    particles.appendChild(particle);
                }
                
                workspace.appendChild(particles);
                
                // Add floating animation if not already exists
                if (!document.getElementById('floatAnimation')) {
                    const style = document.createElement('style');
                    style.id = 'floatAnimation';
                    style.textContent = `
                        @keyframes float {
                            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.6; }
                            50% { transform: translateY(-20px) rotate(180deg); opacity: 1; }
                        }
                    `;
                    document.head.appendChild(style);
                }
            }
        }

        function removeParticleEffect() {
            const particles = document.getElementById('particles');
            if (particles) {
                particles.remove();
            }
        }

        // Enhanced notification system
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            
            // Add different colors for different types
            switch(type) {
                case 'success':
                    notification.style.background = '#27ae60';
                    break;
                case 'error':
                    notification.style.background = '#e74c3c';
                    break;
                case 'warning':
                    notification.style.background = '#f39c12';
                    break;
                default:
                    notification.style.background = '#3498db';
            }
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // Modal control functions disabled (modal removed)
        function minimizeChatbot() {
            // Modal removed - function disabled
            return;
        }

        function maximizeChatbot() {
            // Modal removed - function disabled
            return;
        }

        function closeChatbot() {
            // Modal removed - function disabled
            return;
        }

        function clearWorkspace() {
            if (confirm('Are you sure you want to clear the workspace? This will reset all settings.')) {
                resetToDefaults();
                resetPosition();
                const modal = document.getElementById('chatbotModal');
                modal.style.display = 'block';
                modal.classList.remove('minimized', 'maximized');
                removeParticleEffect();
                showNotification('Workspace cleared!', 'success');
            }
        }

        function updateAvatarIcons() {
            const getValue = (id, defaultVal = '') => {
                const element = document.getElementById(id);
                return element ? element.value : defaultVal;
            };

            const avatarIcon = getValue('avatarIcon', 'ðŸ ');
            const userAvatarIcon = getValue('userAvatarIcon', 'ðŸ‘¤');
            const triggerIcon = getValue('triggerIcon', 'fa-comments');
            
            // Update bot avatars
            document.querySelectorAll('.bot-avatar').forEach(el => {
                el.textContent = avatarIcon === 'custom' ? getValue('customIcon', 'ðŸ ') : avatarIcon;
            });
            
            // Update user avatars
            document.querySelectorAll('.user-avatar').forEach(el => {
                el.textContent = userAvatarIcon;
            });
            
            // Update main avatar
            const mainAvatar = document.querySelector('.avatar');
            if (mainAvatar) {
                mainAvatar.textContent = avatarIcon === 'custom' ? getValue('customIcon', 'ðŸ ') : avatarIcon;
            }

            // Update trigger icon
            const triggerIconElement = document.getElementById('triggerIconElement');
            if (triggerIconElement) {
                triggerIconElement.className = `fas ${triggerIcon}`;
            }

            // Show/hide custom icon input
            const customIconSection = document.getElementById('customIconSection');
            if (customIconSection) {
                customIconSection.style.display = avatarIcon === 'custom' ? 'block' : 'none';
            }
        }

        function updateInteractiveFeatures() {
            const getChecked = (id) => {
                const element = document.getElementById(id);
                return element ? element.checked : false;
            };

            const getValue = (id, defaultVal = '') => {
                const element = document.getElementById(id);
                return element ? element.value : defaultVal;
            };

            // Toggle interactive elements
            toggleElement('quickResponses', getChecked('showQuickResponses'));
            toggleElement('welcomeMessage', getChecked('showWelcome'));
            toggleElement('soundWave', getChecked('showSoundWave'));
            toggleElement('unreadBadge', getChecked('showUnreadBadge'));
            toggleElement('fileUploadArea', getChecked('showFileUpload'));
            toggleElement('typingIndicator', getChecked('showTypingIndicator'));
            toggleElement('conversationStarters', getChecked('showConversationStarters'));
            toggleElement('floatingActions', getChecked('showFloatingActions'));
            toggleElement('chatBreadcrumb', getChecked('showBreadcrumbs'));

            // Toggle message features
            toggleElements('.message-feedback', getChecked('showMessageFeedback'));
            toggleElements('.message-reactions', getChecked('showEmojiReactions'));
            toggleElements('.message-time', getChecked('showTimestamps'));

            // Update welcome text
            const welcomeText = getValue('welcomeText', 'ðŸ‘‹ Hi! Need help with countertops?');
            const welcomeElement = document.getElementById('welcomeText');
            if (welcomeElement) {
                welcomeElement.textContent = welcomeText;
            }

            // Apply trigger pulse
            const chatTrigger = document.getElementById('chatTrigger');
            if (chatTrigger) {
                if (getChecked('triggerPulse')) {
                    chatTrigger.classList.add('pulse');
                } else {
                    chatTrigger.classList.remove('pulse');
                }
            }
        }

        function updateAnimationSettings() {
            const getValue = (id, defaultVal = '') => {
                const element = document.getElementById(id);
                return element ? element.value : defaultVal;
            };

            const getChecked = (id) => {
                const element = document.getElementById(id);
                return element ? element.checked : false;
            };

            const container = document.getElementById('chatContainer');
            const iconAnimation = getValue('iconAnimation', 'none');
            const entranceAnimation = getValue('entranceAnimation', 'fadeIn');
            const animationDuration = getValue('animationDuration', '0.5');
            
            // Apply icon animations
            document.querySelectorAll('.avatar, .message-avatar').forEach(el => {
                if (iconAnimation !== 'none') {
                    el.style.animation = `${iconAnimation} 2s infinite`;
                } else {
                    el.style.animation = '';
                }
            });

            // Apply entrance animation
            container.style.animation = `${entranceAnimation} ${animationDuration}s ease`;
            
            // Apply hover effects
            if (getChecked('messageHoverEffects')) {
                container.classList.add('hover-effects-enabled');
            } else {
                container.classList.remove('hover-effects-enabled');
            }

            // Apply theme and accessibility settings
            applyThemeSettings();
            applyAccessibilitySettings();
        }

        function toggleElement(id, show) {
            const element = document.getElementById(id);
            if (element) {
                element.style.display = show ? 'block' : 'none';
            }
        }

        function toggleElements(selector, show) {
            document.querySelectorAll(selector).forEach(el => {
                el.style.display = show ? 'block' : 'none';
            });
        }

        function applyThemeSettings() {
            const getValue = (id, defaultVal = '') => {
                const element = document.getElementById(id);
                return element ? element.value : defaultVal;
            };

            const container = document.getElementById('chatContainer');
            const chatTheme = getValue('chatTheme', 'modern');
            const messageStyle = getValue('messageStyle', 'standard');
            const customClasses = getValue('customCssClasses', '');

            // Apply theme class
            container.className = `chat-container theme-${chatTheme} style-${messageStyle} ${customClasses}`.trim();
        }

        function applyAccessibilitySettings() {
            const getChecked = (id) => {
                const element = document.getElementById(id);
                return element ? element.checked : false;
            };

            const container = document.getElementById('chatContainer');

            if (getChecked('darkModeSupport')) {
                container.classList.add('dark-mode-support');
            } else {
                container.classList.remove('dark-mode-support');
            }

            if (getChecked('highContrastMode')) {
                container.classList.add('high-contrast');
            } else {
                container.classList.remove('high-contrast');
            }

            if (getChecked('reducedMotion')) {
                container.classList.add('reduced-motion');
            } else {
                container.classList.remove('reduced-motion');
            }
        }

        // Interactive element functions
        function selectStarter(text) {
            const inputField = document.querySelector('.input-field');
            if (inputField) {
                inputField.value = text;
                inputField.focus();
            }
        }

        function selectQuickResponse(text) {
            const inputField = document.querySelector('.input-field');
            if (inputField) {
                inputField.value = text;
                inputField.focus();
            }
        }

        function closeWelcome() {
            const welcomeMessage = document.getElementById('welcomeMessage');
            if (welcomeMessage) {
                welcomeMessage.style.display = 'none';
            }
        }

        function addEmoji(emoji) {
            const inputField = document.querySelector('.input-field');
            if (inputField) {
                inputField.value += emoji;
                inputField.focus();
            }
            const emojiPicker = document.getElementById('emojiPicker');
            if (emojiPicker) {
                emojiPicker.classList.remove('show');
            }
        }

        function toggleEmojiPicker() {
            const emojiPicker = document.getElementById('emojiPicker');
            if (emojiPicker) {
                emojiPicker.classList.toggle('show');
            }
        }

        // Initialize all interactive features when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize collapsible control groups
            document.querySelectorAll('.control-group h3').forEach(header => {
                header.addEventListener('click', function() {
                    const group = this.parentElement;
                    group.classList.toggle('collapsed');
                });
            });

            // Initialize live preview
            updateStyle();
            
            // Load saved design if exists
            const saved = localStorage.getItem('chatbotDesign');
            if (saved) {
                try {
                    const design = JSON.parse(saved);
                    Object.keys(design).forEach(key => {
                        const element = document.getElementById(key);
                        if (element) {
                            if (element.type === 'checkbox') {
                                element.checked = design[key];
                            } else {
                                element.value = design[key];
                            }
                        }
                    });
                    updateStyle();
                } catch (e) {
                    console.warn('Could not load saved design:', e);
                }
            }
        });

        // Enhanced dragging functionality for chatbot modal
        function initializeDragging() {
            const modal = document.getElementById('chatbotModal');
            const dragHandle = document.getElementById('modalDragHandle');
            let isDragging = false;
            let currentX;
            let currentY;
            let initialX;
            let initialY;
            let xOffset = 50;
            let yOffset = 50;

            function dragStart(e) {
                const lockPosition = document.getElementById('lockPosition');
                if (lockPosition && lockPosition.checked) return;

                if (e.type === "touchstart") {
                    initialX = e.touches[0].clientX - xOffset;
                    initialY = e.touches[0].clientY - yOffset;
                } else {
                    initialX = e.clientX - xOffset;
                    initialY = e.clientY - yOffset;
                }

                if (e.target === dragHandle || dragHandle.contains(e.target)) {
                    isDragging = true;
                    modal.classList.add('dragging');
                    dragHandle.style.cursor = 'grabbing';
                }
            }

            function dragEnd(e) {
                initialX = currentX;
                initialY = currentY;
                isDragging = false;
                modal.classList.remove('dragging');
                dragHandle.style.cursor = 'move';
                
                // Update position sliders
                updatePositionSliders();
            }

            function drag(e) {
                if (isDragging) {
                    e.preventDefault();
                    
                    if (e.type === "touchmove") {
                        currentX = e.touches[0].clientX - initialX;
                        currentY = e.touches[0].clientY - initialY;
                    } else {
                        currentX = e.clientX - initialX;
                        currentY = e.clientY - initialY;
                    }

                    xOffset = currentX;
                    yOffset = currentY;

                    // Keep modal within workspace bounds
                    const workspace = document.getElementById('workspace');
                    const workspaceRect = workspace.getBoundingClientRect();
                    const modalRect = modal.getBoundingClientRect();

                    const maxX = workspaceRect.width - modal.offsetWidth;
                    const maxY = workspaceRect.height - modal.offsetHeight;

                    xOffset = Math.max(0, Math.min(maxX, xOffset));
                    yOffset = Math.max(0, Math.min(maxY, yOffset));

                    // Snap to grid if enabled
                    if (document.getElementById('snapToGrid')?.checked) {
                        const gridSize = 20;
                        xOffset = Math.round(xOffset / gridSize) * gridSize;
                        yOffset = Math.round(yOffset / gridSize) * gridSize;
                        showSnapIndicator(xOffset, yOffset);
                    }

                    setTranslate(xOffset, yOffset, modal);
                }
            }

            function setTranslate(xPos, yPos, el) {
                el.style.transform = `translate3d(${xPos}px, ${yPos}px, 0)`;
                el.style.left = '0px';
                el.style.top = '0px';
            }

            // Mouse events
            dragHandle.addEventListener('mousedown', dragStart, false);
            document.addEventListener('mouseup', dragEnd, false);
            document.addEventListener('mousemove', drag, false);

            // Touch events
            dragHandle.addEventListener('touchstart', dragStart, false);
            document.addEventListener('touchend', dragEnd, false);
            document.addEventListener('touchmove', drag, false);
        }

        // Initialize resizing functionality
        function initializeResizing() {
            const modal = document.getElementById('chatbotModal');
            const resizeHandle = document.getElementById('resizeHandle');
            let isResizing = false;

            resizeHandle.addEventListener('mousedown', (e) => {
                isResizing = true;
                document.addEventListener('mousemove', handleResize);
                document.addEventListener('mouseup', stopResize);
                e.preventDefault();
            });

            function handleResize(e) {
                if (!isResizing) return;
                
                const rect = modal.getBoundingClientRect();
                const newWidth = e.clientX - rect.left;
                const newHeight = e.clientY - rect.top;
                
                modal.style.width = Math.max(300, Math.min(800, newWidth)) + 'px';
                modal.style.height = Math.max(400, Math.min(800, newHeight)) + 'px';
            }

            function stopResize() {
                isResizing = false;
                document.removeEventListener('mousemove', handleResize);
                document.removeEventListener('mouseup', stopResize);
            }
        }

        // Position control functions
        function togglePositionControls() {
            const panel = document.getElementById('positionControls');
            panel.classList.toggle('show');
        }

        function setPosition(position) {
            const modal = document.getElementById('chatbotModal');
            const workspace = document.getElementById('workspace');
            const workspaceRect = workspace.getBoundingClientRect();
            const modalWidth = modal.offsetWidth;
            const modalHeight = modal.offsetHeight;
            
            let x, y;
            
            switch(position) {
                case 'top-left':
                    x = 20; y = 20;
                    break;
                case 'top-center':
                    x = (workspaceRect.width - modalWidth) / 2; y = 20;
                    break;
                case 'top-right':
                    x = workspaceRect.width - modalWidth - 20; y = 20;
                    break;
                case 'center-left':
                    x = 20; y = (workspaceRect.height - modalHeight) / 2;
                    break;
                case 'center':
                    x = (workspaceRect.width - modalWidth) / 2; 
                    y = (workspaceRect.height - modalHeight) / 2;
                    break;
                case 'center-right':
                    x = workspaceRect.width - modalWidth - 20; 
                    y = (workspaceRect.height - modalHeight) / 2;
                    break;
                case 'bottom-left':
                    x = 20; y = workspaceRect.height - modalHeight - 20;
                    break;
                case 'bottom-center':
                    x = (workspaceRect.width - modalWidth) / 2; 
                    y = workspaceRect.height - modalHeight - 20;
                    break;
                case 'bottom-right':
                    x = workspaceRect.width - modalWidth - 20; 
                    y = workspaceRect.height - modalHeight - 20;
                    break;
            }
            
            modal.style.transform = `translate3d(${x}px, ${y}px, 0)`;
            updatePositionSliders();
            
            // Highlight the selected position button
            document.querySelectorAll('.position-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function centerChatbot() {
            // Modal removed - function disabled
            return;
        }

        function resetPosition() {
            const modal = document.getElementById('chatbotModal');
            modal.style.transform = 'translate3d(50px, 50px, 0)';
            modal.style.width = '450px';
            modal.style.height = '600px';
            updatePositionSliders();
        }

        function updateChatbotPosition() {
            // Modal removed - function disabled
            return;
        }

        function updatePositionSliders() {
            const modal = document.getElementById('chatbotModal');
            const workspace = document.getElementById('workspace');
            const workspaceRect = workspace.getBoundingClientRect();
            
            const transform = modal.style.transform;
            const matches = transform.match(/translate3d\((.+)px, (.+)px, (.+)px\)/);
            
            if (matches) {
                const x = parseFloat(matches[1]);
                const y = parseFloat(matches[2]);
                
                const xPercent = (x / (workspaceRect.width - modal.offsetWidth)) * 100;
                const yPercent = (y / (workspaceRect.height - modal.offsetHeight)) * 100;
                
                document.getElementById('chatbotX').value = Math.max(0, Math.min(100, xPercent));
                document.getElementById('chatbotY').value = Math.max(0, Math.min(100, yPercent));
                
                document.getElementById('chatbotXValue').textContent = Math.round(xPercent) + '%';
                document.getElementById('chatbotYValue').textContent = Math.round(yPercent) + '%';
            }
        }

        function toggleLockPosition() {
            const lockPosition = document.getElementById('lockPosition');
            const dragHandle = document.getElementById('modalDragHandle');
            
            if (lockPosition.checked) {
                dragHandle.style.cursor = 'default';
                dragHandle.title = 'Position Locked';
            } else {
                dragHandle.style.cursor = 'move';
                dragHandle.title = 'Drag to move';
            }
        }

        function toggleGrid() {
            const workspace = document.getElementById('workspace');
            const showGrid = document.getElementById('showGrid');
            
            if (showGrid.checked) {
                workspace.classList.add('show-grid');
            } else {
                workspace.classList.remove('show-grid');
            }
        }

        function showSnapIndicator(x, y) {
            const indicator = document.getElementById('snapIndicator');
            indicator.style.left = x + 'px';
            indicator.style.top = y + 'px';
            indicator.style.width = '20px';
            indicator.style.height = '20px';
            indicator.style.display = 'block';
            
            setTimeout(() => {
                indicator.style.display = 'none';
            }, 200);
        }

        // Script Editor functionality
        function initializeScriptEditor() {
            // Initialize with default scripts
            window.customScripts = {
                init: `// Initialization script
// This runs when the chatbot loads
console.log('Chatbot initialized');

// Auto-open chat after delay
if (chatbotConfig.autoOpenChat) {
    setTimeout(() => {
        openChat();
    }, chatbotConfig.autoOpenDelay || 3000);
}`,
                events: `// Event handlers
// Handle message send
function onMessageSend(message) {
    console.log('Message sent:', message);
    
    // Track with analytics
    if (typeof gtag !== 'undefined') {
        gtag('event', 'message_sent', {
            'message_length': message.length
        });
    }
    
    return message;
}

// Handle message receive
function onMessageReceive(message) {
    console.log('Message received:', message);
    return message;
}`,
                responses: `// Auto-response patterns
const autoResponses = {
    greeting: [
        'Hi there! ðŸ‘‹',
        'Hello! How can I help you today?',
        'Welcome to Surprise Granite!'
    ],
    pricing: [
        'Our countertop pricing starts at $45/sq ft.',
        'For a detailed quote, please tell me your square footage.',
        'We offer competitive pricing with premium quality.'
    ],
    contact: [
        'You can reach us at (555) 123-4567',
        'Visit us at surprisegranite.com',
        'We\'d love to schedule a consultation!'
    ]
};

function getAutoResponse(message) {
    const lowerMessage = message.toLowerCase();
    
    if (lowerMessage.includes('hello') || lowerMessage.includes('hi')) {
        return getRandomResponse(autoResponses.greeting);
    }
    if (lowerMessage.includes('price') || lowerMessage.includes('cost')) {
        return getRandomResponse(autoResponses.pricing);
    }
    if (lowerMessage.includes('contact') || lowerMessage.includes('phone')) {
        return getRandomResponse(autoResponses.contact);
    }
    
    return null;
}

function getRandomResponse(responses) {
    return responses[Math.floor(Math.random() * responses.length)];
}`,
                custom: `// Custom functions
function playNotificationSound() {
    if (chatbotConfig.soundEffects) {
        // Create a simple beep sound
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = 800;
        oscillator.type = 'sine';
        
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.1);
    }
}

function saveToLocalStorage(key, value) {
    if (chatbotConfig.useLocalStorage) {
        try {
            localStorage.setItem('chatbot_' + key, JSON.stringify(value));
        } catch (e) {
            console.warn('Could not save to localStorage:', e);
        }
    }
}

function loadFromLocalStorage(key) {
    if (chatbotConfig.useLocalStorage) {
        try {
            const value = localStorage.getItem('chatbot_' + key);
            return value ? JSON.parse(value) : null;
        } catch (e) {
            console.warn('Could not load from localStorage:', e);
            return null;
        }
    }
    return null;
}`
            };
        }

        function openScriptEditor() {
            const modal = document.getElementById('scriptModal');
            modal.classList.add('show');
            showScriptTab('init');
        }

        function closeScriptEditor() {
            const modal = document.getElementById('scriptModal');
            modal.classList.remove('show');
        }

        function showScriptTab(tabType) {
            // Update active tab
            document.querySelectorAll('#scriptModal .code-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            const editor = document.getElementById('scriptEditor');
            editor.value = window.customScripts[tabType] || '';
            editor.setAttribute('data-tab', tabType);
        }

        function saveScript() {
            const editor = document.getElementById('scriptEditor');
            const tabType = editor.getAttribute('data-tab');
            window.customScripts[tabType] = editor.value;
            showNotification('Script saved!');
        }

        function resetScript() {
            const editor = document.getElementById('scriptEditor');
            const tabType = editor.getAttribute('data-tab');
            initializeScriptEditor(); // Reset to defaults
            editor.value = window.customScripts[tabType];
            showNotification('Script reset to default!');
        }

        // API Configuration
        function openAPIConfig() {
            const modal = document.getElementById('apiModal');
            modal.classList.add('show');
        }

        function closeAPIConfig() {
            const modal = document.getElementById('apiModal');
            modal.classList.remove('show');
        }

        function saveAPIConfig() {
            const config = {
                webhookUrl: document.getElementById('apiWebhookUrl').value,
                method: document.getElementById('apiMethod').value,
                auth: document.getElementById('apiAuth').value,
                token: document.getElementById('apiToken').value,
                googleAnalytics: document.getElementById('apiGoogleAnalytics').value,
                facebookPixel: document.getElementById('apiFacebookPixel').value,
                hotjar: document.getElementById('apiHotjar').value,
                aiService: document.getElementById('aiService').value,
                aiApiKey: document.getElementById('aiApiKey').value,
                aiModel: document.getElementById('aiModel').value
            };
            
            window.apiConfig = config;
            showNotification('API configuration saved!');
        }

        function testAPI() {
            const webhookUrl = document.getElementById('apiWebhookUrl').value;
            
            if (!webhookUrl) {
                showNotification('Please enter a webhook URL first.', 'error');
                return;
            }
            
            fetch(webhookUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ test: true, message: 'API test from Surprise Granite Chatbot' })
            })
            .then(response => {
                if (response.ok) {
                    showNotification('API connection successful! âœ…', 'success');
                } else {
                    showNotification('API connection failed. Check your URL and settings.', 'error');
                }
            })
            .catch(error => {
                showNotification('API test failed: ' + error.message, 'error');
            });
        }

        function initializeInteractiveFeatures() {
            // Auto-show typing indicator demo
            setTimeout(() => {
                const showTypingCheckbox = document.getElementById('showTypingIndicator');
                if (showTypingCheckbox && showTypingCheckbox.checked) {
                    const typingIndicator = document.getElementById('typingIndicator');
                    if (typingIndicator) {
                        typingIndicator.classList.add('show');
                        setTimeout(() => {
                            typingIndicator.classList.remove('show');
                        }, 3000);
                    }
                }
            }, 2000);

            // Initialize file upload area
            const fileUploadArea = document.getElementById('fileUploadArea');
            if (fileUploadArea) {
                fileUploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    fileUploadArea.classList.add('dragover');
                });

                fileUploadArea.addEventListener('dragleave', () => {
                    fileUploadArea.classList.remove('dragover');
                });

                fileUploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    fileUploadArea.classList.remove('dragover');
                    console.log('Files dropped:', e.dataTransfer.files);
                });

                fileUploadArea.addEventListener('click', () => {
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.multiple = true;
                    input.accept = 'image/*,application/pdf,.doc,.docx';
                    input.click();
                });
            }

            // Initialize chat trigger functionality
            const chatTrigger = document.getElementById('chatTrigger');
            const chatModal = document.getElementById('chatModal');
            if (chatTrigger && chatModal) {
                chatTrigger.addEventListener('click', () => {
                    const isVisible = chatModal.style.display !== 'none';
                    chatModal.style.display = isVisible ? 'none' : 'block';
                    
                    // Hide unread badge when opening chat
                    if (!isVisible) {
                        const unreadBadge = document.getElementById('unreadBadge');
                        if (unreadBadge) {
                            unreadBadge.style.display = 'none';
                        }
                    }
                });
            }

            // Initialize input auto-resize
            const inputField = document.querySelector('.input-field');
            if (inputField) {
                inputField.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = this.scrollHeight + 'px';
                });
            }
        }

        // Modal control functions
        function minimizeChatbot() {
            const modal = document.getElementById('chatbotModal');
            const chatModal = document.getElementById('chatModal');
            
            if (modal.classList.contains('minimized')) {
                modal.classList.remove('minimized');
                chatModal.style.display = 'block';
                modal.style.height = '600px';
            } else {
                modal.classList.add('minimized');
                chatModal.style.display = 'none';
                modal.style.height = '50px';
            }
        }

        function maximizeChatbot() {
            const modal = document.getElementById('chatbotModal');
            
            if (modal.classList.contains('maximized')) {
                modal.classList.remove('maximized');
                modal.style.width = '450px';
                modal.style.height = '600px';
                modal.style.top = '50px';
                modal.style.left = '50px';
                modal.style.transform = 'none';
            } else {
                modal.classList.add('maximized');
                modal.style.width = '90%';
                modal.style.height = 'calc(100vh - 120px)';
                modal.style.top = '50%';
                modal.style.left = '50%';
                modal.style.transform = 'translate(-50%, -50%)';
            }
        }

        function closeChatbot() {
            const modal = document.getElementById('chatbotModal');
            modal.style.display = 'none';
        }

        function clearWorkspace() {
            if (confirm('Are you sure you want to clear the workspace? This will reset all settings.')) {
                resetToDefaults();
                // Modal removed - no longer showing modal
                showNotification('Workspace cleared!');
            }
        }

        // Mobile controls toggle function
        function toggleControls() {
            const controls = document.getElementById('controlsPanel');
            const workspace = document.querySelector('.workspace');
            const btn = document.getElementById('toggleControlsBtn');
            
            controls.classList.toggle('collapsed');
            workspace.classList.toggle('expanded');
            
            const icon = btn.querySelector('i');
            const text = btn.querySelector('span');
            
            if (controls.classList.contains('collapsed')) {
                icon.className = 'fas fa-eye';
                text.textContent = 'Show Controls';
            } else {
                icon.className = 'fas fa-cog';
                text.textContent = 'Controls';
            }
        }

        // Code generation functions
        function showCodeModal() {
            const modal = document.getElementById('codeModal');
            modal.classList.add('show');
            showCodeTab('html');
        }

        function closeCodeModal() {
            const modal = document.getElementById('codeModal');
            modal.classList.remove('show');
        }

        function showCodeTab(tabType) {
            // Update active tab
            document.querySelectorAll('.code-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            const content = document.getElementById('codeTabContent');
            
            switch(tabType) {
                case 'html':
                    content.innerHTML = generateCompleteHTMLCode();
                    break;
                case 'embed':
                    content.innerHTML = generateEmbedCode();
                    break;
                case 'wordpress':
                    content.innerHTML = generateWordPressCode();
                    break;
                case 'react':
                    content.innerHTML = generateReactCode();
                    break;
                case 'js':
                    content.innerHTML = generateJavaScriptCode();
                    break;
                case 'css':
                    content.innerHTML = generateCSSCode();
                    break;
            }
        }

        function generateCompleteHTMLCode() {
            const design = getCurrentDesign();
            const html = generateChatbotHTML(design);
            
            return `
                <div class="snippet-title">Complete HTML File</div>
                <div class="snippet-description">Download this as a complete HTML file that you can host anywhere.</div>
                <div class="code-snippet">
                    <button class="copy-btn" onclick="copyToClipboard(this.nextElementSibling.textContent)">Copy</button>
                    <pre>${escapeHtml(html)}</pre>
                </div>
            `;
        }

        function generateEmbedCode() {
            return `
                <div class="snippet-title">Website Embed Code</div>
                <div class="snippet-description">Add this to any website to embed your chatbot.</div>
                <div class="code-snippet">
                    <button class="copy-btn" onclick="copyToClipboard(this.nextElementSibling.textContent)">Copy</button>
                    <pre>&lt;!-- Surprise Granite Chatbot --&gt;
&lt;script&gt;
(function() {
    var chatbot = document.createElement('div');
    chatbot.id = 'surprise-granite-chatbot';
    chatbot.innerHTML = '${escapeHtml(generateEmbedHTML())}';
    document.body.appendChild(chatbot);
})();
&lt;/script&gt;
&lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"&gt;</pre>
                </div>
            `;
        }

        function generateWordPressCode() {
            return `
                <div class="snippet-title">WordPress Integration</div>
                <div class="snippet-description">Add this to your WordPress theme's functions.php or use a code snippet plugin.</div>
                <div class="code-snippet">
                    <button class="copy-btn" onclick="copyToClipboard(this.nextElementSibling.textContent)">Copy</button>
                    <pre>// Add to functions.php
function add_surprise_granite_chatbot() {
    echo '&lt;div id="surprise-granite-chatbot"&gt;${escapeHtml(generateEmbedHTML())}&lt;/div&gt;';
}
add_action('wp_footer', 'add_surprise_granite_chatbot');

// Enqueue Font Awesome
function chatbot_enqueue_scripts() {
    wp_enqueue_style('font-awesome', 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css');
}
add_action('wp_enqueue_scripts', 'chatbot_enqueue_scripts');</pre>
                </div>
                
                <div class="snippet-title">WordPress Shortcode</div>
                <div class="snippet-description">Use [surprise_granite_chatbot] anywhere in your content.</div>
                <div class="code-snippet">
                    <button class="copy-btn" onclick="copyToClipboard(this.nextElementSibling.textContent)">Copy</button>
                    <pre>function surprise_granite_chatbot_shortcode() {
    return '&lt;div id="surprise-granite-chatbot"&gt;${escapeHtml(generateEmbedHTML())}&lt;/div&gt;';
}
add_shortcode('surprise_granite_chatbot', 'surprise_granite_chatbot_shortcode');</pre>
                </div>
            `;
        }

        function generateReactCode() {
            return `
                <div class="snippet-title">React Component</div>
                <div class="snippet-description">Use this as a React component in your application.</div>
                <div class="code-snippet">
                    <button class="copy-btn" onclick="copyToClipboard(this.nextElementSibling.textContent)">Copy</button>
                    <pre>import React, { useState } from 'react';
import './SurpriseGraniteChatbot.css'; // Include the CSS

const SurpriseGraniteChatbot = () => {
    const [isOpen, setIsOpen] = useState(false);
    const [messages, setMessages] = useState([
        { type: 'bot', text: 'Hi! I\\'m here to help with your countertop project.' }
    ]);

    return (
        &lt;div className="chatbot-container"&gt;
            {/* Trigger Button */}
            &lt;button 
                className="chat-trigger" 
                onClick={() => setIsOpen(!isOpen)}
            &gt;
                &lt;i className="fas fa-comments"&gt;&lt;/i&gt;
            &lt;/button&gt;

            {/* Chat Modal */}
            {isOpen && (
                &lt;div className="chat-modal"&gt;
                    &lt;div className="chat-header"&gt;
                        &lt;h3&gt;Surprise Granite AI&lt;/h3&gt;
                        &lt;button onClick={() => setIsOpen(false)}&gt;Ã—&lt;/button&gt;
                    &lt;/div&gt;
                    &lt;div className="chat-messages"&gt;
                        {messages.map((msg, idx) => (
                            &lt;div key={idx} className={\`message \${msg.type}\`}&gt;
                                {msg.text}
                            &lt;/div&gt;
                        ))}
                    &lt;/div&gt;
                &lt;/div&gt;
            )}
        &lt;/div&gt;
    );
};

export default SurpriseGraniteChatbot;</pre>
                </div>
            `;
        }

        function generateJavaScriptCode() {
            return `
                <div class="snippet-title">JavaScript Plugin</div>
                <div class="snippet-description">Initialize the chatbot with custom options.</div>
                <div class="code-snippet">
                    <button class="copy-btn" onclick="copyToClipboard(this.nextElementSibling.textContent)">Copy</button>
                    <pre>// Initialize Surprise Granite Chatbot
class SurpriseGraniteChatbot {
    constructor(options = {}) {
        this.options = {
            position: options.position || 'bottom-right',
            theme: options.theme || 'professional',
            triggerText: options.triggerText || 'Chat with us',
            ...options
        };
        this.init();
    }

    init() {
        this.createChatbot();
        this.bindEvents();
    }

    createChatbot() {
        const container = document.createElement('div');
        container.innerHTML = \`${escapeHtml(generateEmbedHTML())}\`;
        document.body.appendChild(container);
    }

    bindEvents() {
        // Add your event handlers here
        document.querySelector('.chat-trigger').addEventListener('click', () => {
            this.toggleChat();
        });
    }

    toggleChat() {
        const modal = document.querySelector('.chat-modal');
        modal.style.display = modal.style.display === 'none' ? 'block' : 'none';
    }
}

// Usage
const chatbot = new SurpriseGraniteChatbot({
    theme: 'professional',
    position: 'bottom-right'
});</pre>
                </div>
            `;
        }

        function generateCSSCode() {
            const design = getCurrentDesign();
            return `
                <div class="snippet-title">CSS Styles</div>
                <div class="snippet-description">Custom CSS for your chatbot design.</div>
                <div class="code-snippet">
                    <button class="copy-btn" onclick="copyToClipboard(this.nextElementSibling.textContent)">Copy</button>
                    <pre>${generateCSSFromDesign(design)}</pre>
                </div>
            `;
        }

        function getCurrentDesign() {
            const design = {};
            document.querySelectorAll('input, select, textarea').forEach(input => {
                if (input.type === 'checkbox') {
                    design[input.id] = input.checked;
                } else {
                    design[input.id] = input.value;
                }
            });
            return design;
        }

        function generateEmbedHTML() {
            // Generate minimal HTML for embedding
            return `<div class="chat-trigger"><i class="fas fa-comments"></i></div>
<div class="chat-modal" style="display:none;">
    <div class="chat-header">
        <h3>Surprise Granite AI</h3>
        <button onclick="this.closest('.chat-modal').style.display='none'">Ã—</button>
    </div>
    <div class="chat-messages">
        <div class="message bot">Hi! How can I help with your countertop project?</div>
    </div>
    <div class="chat-input">
        <input type="text" placeholder="Type your message...">
        <button><i class="fas fa-paper-plane"></i></button>
    </div>
</div>`;
        }

        function generateCSSFromDesign(design) {
            return `.chat-trigger {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 60px;
    height: 60px;
    background: ${design.headerColor || '#1f4e79'};
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    cursor: pointer;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    z-index: 1000;
}

.chat-modal {
    position: fixed;
    bottom: 100px;
    right: 20px;
    width: ${design.containerWidth || '450'}px;
    height: ${design.containerHeight || '600'}px;
    background: white;
    border-radius: ${design.containerRadius || '20'}px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.15);
    z-index: 1000;
}

.chat-header {
    background: ${design.headerColor || '#1f4e79'};
    color: white;
    padding: 20px;
    border-radius: ${design.containerRadius || '20'}px ${design.containerRadius || '20'}px 0 0;
}

.message.bot {
    background: ${design.botMessageColor || '#f5f5f5'};
    color: ${design.botMessageText || '#333'};
}

.message.user {
    background: ${design.userMessageColor || '#1f4e79'};
    color: ${design.userMessageText || 'white'};
}`;
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('Code copied to clipboard!');
            });
        }

        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        function applyPreset(preset) {
            const presets = {
                professional: {
                    headerColor: '#1f4e79',
                    avatarColor: '#f1c40f',
                    botMessageColor: '#ffffff',
                    userMessageColor: '#1f4e79',
                    sendBtnColor: '#f1c40f',
                    containerRadius: 20,
                    shadowIntensity: 15,
                    headerGradient: false,
                    containerGlow: false
                },
                modern: {
                    headerColor: '#667eea',
                    avatarColor: '#764ba2',
                    botMessageColor: '#f8f9fa',
                    userMessageColor: '#667eea',
                    sendBtnColor: '#764ba2',
                    containerRadius: 25,
                    shadowIntensity: 25,
                    headerGradient: true,
                    headerGradientEnd: '#f093fb',
                    containerGlow: false
                },
                classic: {
                    headerColor: '#2c3e50',
                    avatarColor: '#e74c3c',
                    botMessageColor: '#ecf0f1',
                    userMessageColor: '#3498db',
                    sendBtnColor: '#e74c3c',
                    containerRadius: 15,
                    shadowIntensity: 10,
                    containerBorder: 2,
                    headerGradient: false,
                    containerGlow: false
                },
                minimal: {
                    headerColor: '#6b7280',
                    avatarColor: '#10b981',
                    botMessageColor: '#f9fafb',
                    userMessageColor: '#374151',
                    sendBtnColor: '#10b981',
                    containerRadius: 12,
                    shadowIntensity: 8,
                    showStatus: false,
                    messageAnimation: false,
                    hoverEffects: false,
                    headerGradient: false,
                    containerGlow: false
                },
                dark: {
                    headerColor: '#1f2937',
                    headerTextColor: '#f9fafb',
                    avatarColor: '#8b5cf6',
                    botMessageColor: '#374151',
                    botMessageText: '#f9fafb',
                    userMessageColor: '#8b5cf6',
                    containerBg: '#111827',
                    messagesBg: '#1f2937',
                    containerRadius: 16,
                    shadowIntensity: 30,
                    containerGlow: true,
                    headerGradient: true,
                    headerGradientEnd: '#4c1d95'
                },
                neon: {
                    headerColor: '#06ffa5',
                    headerTextColor: '#000000',
                    avatarColor: '#ff006e',
                    avatarTextColor: '#ffffff',
                    botMessageColor: '#000000',
                    botMessageText: '#06ffa5',
                    userMessageColor: '#ff006e',
                    containerBg: '#0a0a0a',
                    messagesBg: '#111111',
                    containerRadius: 20,
                    shadowIntensity: 40,
                    containerGlow: true,
                    headerGradient: false
                },
                elegant: {
                    headerColor: '#8b4513',
                    headerTextColor: '#f5f5dc',
                    avatarColor: '#daa520',
                    avatarTextColor: '#8b4513',
                    botMessageColor: '#faf0e6',
                    botMessageText: '#654321',
                    userMessageColor: '#8b4513',
                    containerBg: '#fffef7',
                    messagesBg: '#f9f7ed',
                    containerRadius: 18,
                    shadowIntensity: 12,
                    headerGradient: false,
                    containerGlow: false
                },
                playful: {
                    headerColor: '#ff6b6b',
                    avatarColor: '#4ecdc4',
                    botMessageColor: '#ffe66d',
                    userMessageColor: '#ff6b6b',
                    sendBtnColor: '#4ecdc4',
                    containerBg: '#ffffff',
                    messagesBg: '#ffeaa7',
                    containerRadius: 25,
                    shadowIntensity: 20,
                    containerGlow: true,
                    headerGradient: true,
                    headerGradientEnd: '#ff9ff3'
                }
            };

            const config = presets[preset];
            if (!config) return;

            Object.keys(config).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    if (element.type === 'checkbox') {
                        element.checked = config[key];
                    } else {
                        element.value = config[key];
                    }
                }
            });

            updateStyle();
            showNotification(preset.charAt(0).toUpperCase() + preset.slice(1) + ' preset applied!');
        }

        function saveDesign() {
            const design = {};
            document.querySelectorAll('input, select').forEach(input => {
                if (input.type === 'checkbox') {
                    design[input.id] = input.checked;
                } else {
                    design[input.id] = input.value;
                }
            });
            localStorage.setItem('chatbotDesign', JSON.stringify(design));
            showNotification('Design saved successfully!');
        }

        function resetToDefaults() {
            applyPreset('professional');
        }

        function exportChatbot() {
            const design = {};
            document.querySelectorAll('input, select').forEach(input => {
                if (input.type === 'checkbox') {
                    design[input.id] = input.checked;
                } else {
                    design[input.id] = input.value;
                }
            });

            const html = generateChatbotHTML(design);
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'surprise-granite-chatbot-custom.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showNotification('Chatbot exported! Check your downloads.');
        }

        function generateChatbotHTML(design) {
            const getVal = (key, def) => design[key] || def;
            
            return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Surprise Granite AI Assistant</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: linear-gradient(135deg, ${getVal('headerColor', '#1f4e79')} 0%, #34495e 100%); 
            min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; 
        }
        .chat-container { 
            background: ${getVal('containerBg', 'white')}; 
            border-radius: ${getVal('containerRadius', '20')}px; 
            box-shadow: 0 20px 60px rgba(0,0,0,${getVal('shadowIntensity', '15') / 100})${design.containerGlow ? `, 0 0 30px ${getVal('headerColor', '#1f4e79')}` : ''}; 
            overflow: hidden; width: 100%; max-width: ${getVal('containerWidth', '450')}px; 
            height: ${getVal('containerHeight', '700')}px; display: flex; flex-direction: column;
            border: ${getVal('containerBorder', '0')}px solid #ddd;
        }
        .chat-header { 
            ${design.headerGradient ? 
                `background: linear-gradient(45deg, ${getVal('headerColor', '#1f4e79')}, ${getVal('headerGradientEnd', '#34495e')});` :
                `background: ${getVal('headerColor', '#1f4e79')};`
            }
            color: ${getVal('headerTextColor', 'white')}; padding: ${getVal('headerPadding', '20')}px; 
            display: flex; align-items: center; gap: 15px; position: relative;
            border-radius: ${getVal('headerRadius', '0')}px ${getVal('headerRadius', '0')}px 0 0;
        }
        .avatar { 
            width: ${getVal('avatarSize', '50')}px; height: ${getVal('avatarSize', '50')}px; 
            border-radius: ${getVal('avatarShape', '50%')}; background: ${getVal('avatarColor', '#f1c40f')}; 
            display: flex; align-items: center; justify-content: center; 
            font-size: ${Math.round(getVal('avatarSize', 50) * 0.4)}px; font-weight: bold; 
            color: ${getVal('avatarTextColor', '#1f4e79')}; 
        }
        .header-info h3 { margin: 0; font-size: ${getVal('headerFontSize', '18')}px; font-weight: ${getVal('headerFontWeight', '600')}; }
        .header-info p { margin: 0; font-size: ${getVal('subtitleSize', '14')}px; opacity: ${getVal('subtitleOpacity', '0.9')}; }
        ${design.showStatus ? `
        .status-indicator {
            position: absolute; top: ${getVal('headerPadding', '20')}px; right: ${getVal('headerPadding', '20')}px;
            width: 12px; height: 12px; background: ${getVal('statusColor', '#10b981')}; border-radius: 50%;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }` : ''}
        .chat-messages { 
            flex: 1; padding: ${getVal('messagesPadding', '20')}px; overflow-y: auto; 
            background: ${getVal('messagesBg', '#f8f9fa')}; display: flex; flex-direction: column; 
            gap: ${getVal('messagesGap', '15')}px; 
        }
        .message { display: flex; align-items: flex-start; gap: ${getVal('messageGap', '10')}px; }
        .message.user { flex-direction: row-reverse; }
        .message-avatar { 
            width: ${getVal('messageAvatarSize', '35')}px; height: ${getVal('messageAvatarSize', '35')}px; 
            border-radius: 50%; display: flex; align-items: center; justify-content: center; 
            font-size: ${Math.round(getVal('messageAvatarSize', 35) * 0.4)}px; font-weight: bold; flex-shrink: 0; 
        }
        .bot-avatar { background: ${getVal('headerColor', '#1f4e79')}; color: ${getVal('headerTextColor', 'white')}; }
        .user-avatar { background: ${getVal('avatarColor', '#f1c40f')}; color: ${getVal('avatarTextColor', '#1f4e79')}; }
        .message-content { 
            max-width: ${getVal('messageMaxWidth', '80')}%; padding: ${getVal('messagePadding', '12')}px 16px; 
            border-radius: ${getVal('messageRadius', '18')}px; font-size: ${getVal('messageFontSize', '14')}px; line-height: 1.5; 
        }
        .bot-message { background: ${getVal('botMessageColor', 'white')}; color: ${getVal('botMessageText', '#333')}; border-bottom-left-radius: ${getVal('botCorner', '6')}px; }
        .user-message { background: ${getVal('userMessageColor', '#1f4e79')}; color: ${getVal('userMessageText', 'white')}; border-bottom-right-radius: ${getVal('userCorner', '6')}px; }
        .chat-input { 
            padding: 20px; background: white; border-top: 1px solid #e0e0e0; 
            display: flex; gap: ${getVal('inputGap', '10')}px; align-items: flex-end; 
        }
        .input-field { 
            flex: 1; padding: ${getVal('inputPadding', '12')}px 16px; border: 2px solid ${getVal('inputBorderColor', '#e0e0e0')}; 
            border-radius: ${getVal('inputRadius', '25')}px; font-size: ${getVal('inputFontSize', '14')}px; 
            resize: none; outline: none; min-height: ${getVal('inputHeight', '45')}px; font-family: inherit; 
            background: ${getVal('inputBg', 'white')}; color: ${getVal('inputTextColor', '#333')};
        }
        .input-field:focus { border-color: ${getVal('inputFocusColor', '#1f4e79')}; }
        .send-btn { 
            width: ${getVal('sendBtnSize', '45')}px; height: ${getVal('sendBtnSize', '45')}px; border: none; 
            border-radius: ${getVal('sendBtnRadius', '50')}%; background: ${getVal('sendBtnColor', '#f1c40f')}; 
            color: ${getVal('sendBtnText', '#1f4e79')}; cursor: pointer; display: flex; align-items: center; 
            justify-content: center; font-size: ${getVal('sendBtnIconSize', '16')}px; flex-shrink: 0; 
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <div class="avatar">ðŸ </div>
            <div class="header-info">
                <h3>Surprise Granite AI</h3>
                <p>Your Remodeling Expert</p>
            </div>
            ${design.showStatus ? '<div class="status-indicator"></div>' : ''}
        </div>
        <div class="chat-messages">
            <div class="message">
                <div class="message-avatar bot-avatar">ðŸ </div>
                <div class="message-content bot-message">Hi there! ðŸ‘‹ I'm here to help with your countertop project.</div>
            </div>
        </div>
        <div class="chat-input">
            <textarea class="input-field" placeholder="Ask about countertops..." rows="1"></textarea>
            <button class="send-btn"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>
</body>
</html>`;
        }

        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Auto-resize textarea
        document.querySelector('.input-field').addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        });

        // Collapsible control groups
        document.querySelectorAll('.control-group h3').forEach(header => {
            header.addEventListener('click', function() {
                const group = this.parentElement;
                group.classList.toggle('collapsed');
            });
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('chatbotDesign');
            if (saved) {
                const design = JSON.parse(saved);
                Object.keys(design).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = design[key];
                        } else {
                            element.value = design[key];
                        }
                    }
                });
            }
            updateStyle();
        });
    </script>
</body>
</html>
